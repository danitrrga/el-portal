{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/GoalFormModal.tsx"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\nimport { Goal, GoalType, Habit } from '@/types/types';\nimport { CheckCircle2, X, Link as LinkIcon, Search, Check } from 'lucide-react';\n\ninterface GoalFormModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (\n        goal: { title: string; description: string; type: GoalType; subtasks?: string[] },\n        selectedHabit: Habit | null\n    ) => void;\n    initialGoal?: Goal;\n    currentCycleHabits: Habit[];\n    allHabits: Habit[];\n}\n\nexport const GoalFormModal: React.FC<GoalFormModalProps> = ({\n    isOpen, onClose, onSave, initialGoal, currentCycleHabits, allHabits\n}) => {\n    const [title, setTitle] = useState('');\n    const [description, setDescription] = useState('');\n    const [type, setType] = useState<GoalType>(GoalType.TASK_PROJECT);\n    const [subtasks, setSubtasks] = useState('');\n    const [selectedHabit, setSelectedHabit] = useState<Habit | null>(null);\n    const [habitTab, setHabitTab] = useState<'current' | 'database'>('current');\n    const [habitSearch, setHabitSearch] = useState('');\n\n    useEffect(() => {\n        if (initialGoal) {\n            setTitle(initialGoal.title);\n            setDescription(initialGoal.description);\n            setType(initialGoal.type);\n            // Convert subtasks array to string with indentation preservation\n            if (initialGoal.subtasks) {\n                setSubtasks(initialGoal.subtasks.map(t => {\n                    const indent = \"  \".repeat(t.level || 0);\n                    return `${indent}${t.name}`;\n                }).join('\\n'));\n            } else {\n                setSubtasks('');\n            }\n            // Link habit if ID exists\n            if (initialGoal.linked_habit_id) {\n                const found = allHabits.find(h => h.id === initialGoal.linked_habit_id);\n                if (found) setSelectedHabit(found);\n            }\n        } else {\n            // Reset for Add Mode\n            setTitle('');\n            setDescription('');\n            setType(GoalType.TASK_PROJECT);\n            setSubtasks('');\n            setSelectedHabit(null);\n        }\n    }, [initialGoal, isOpen]);\n\n    if (!isOpen) return null;\n\n    const uniqueDbHabits = Array.from(new Map(allHabits.map(h => [h.name, h])).values());\n    const displayHabits = habitTab === 'current' ? currentCycleHabits : uniqueDbHabits;\n    const filteredHabits = displayHabits.filter(h => h.name.toLowerCase().includes(habitSearch.toLowerCase()));\n\n    const handleSave = () => {\n        if (!title.trim()) return;\n        const subtaskList = type === GoalType.TASK_PROJECT ? subtasks.split('\\n').filter(s => s.trim().length > 0) : undefined;\n        onSave({ title, description, type, subtasks: subtaskList }, selectedHabit);\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        if (e.key === 'Tab') {\n            e.preventDefault();\n            const start = e.currentTarget.selectionStart;\n            const end = e.currentTarget.selectionEnd;\n            const value = e.currentTarget.value;\n            const indent = \"  \";\n            const newValue = value.substring(0, start) + indent + value.substring(end);\n            setSubtasks(newValue);\n            requestAnimationFrame(() => {\n                if (e.currentTarget) {\n                    e.currentTarget.selectionStart = e.currentTarget.selectionEnd = start + indent.length;\n                }\n            });\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\n            <div className=\"w-full max-w-xl rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col max-h-[90vh]\" onClick={(e) => e.stopPropagation()}>\n                <div className=\"p-6 border-b border-graphite-200 dark:border-graphite-800 flex justify-between items-center\">\n                    <h2 className=\"text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\n                        <CheckCircle2 size={20} className=\"text-pacific-500\" />\n                        {initialGoal ? 'Edit Goal' : 'Add New Goal'}\n                    </h2>\n                    <button onClick={onClose} className=\"text-graphite-400 hover:text-white\"><X size={20} /></button>\n                </div>\n                <div className=\"p-6 overflow-y-auto space-y-5\">\n                    <div className=\"space-y-4\">\n                        <div>\n                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Goal Title</label>\n                            <input value={title} onChange={e => setTitle(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white\" placeholder=\"e.g. Launch Marketing Campaign\" autoFocus />\n                        </div>\n                        <div>\n                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Description</label>\n                            <textarea value={description} onChange={e => setDescription(e.target.value)} rows={2} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white resize-none\" placeholder=\"What is the objective?\" />\n                        </div>\n                    </div>\n                    <div>\n                        <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-2\">Goal Type</label>\n                        <div className=\"grid grid-cols-2 gap-2 p-1 bg-graphite-100 dark:bg-graphite-800 rounded-xl\">\n                            <button onClick={() => setType(GoalType.TASK_PROJECT)} className={`py-2 rounded-lg text-sm font-bold transition-all ${type === GoalType.TASK_PROJECT ? 'bg-white dark:bg-graphite-700 text-pacific-600 dark:text-white shadow-sm' : 'text-graphite-500 hover:text-graphite-700 dark:hover:text-graphite-300'}`}>Project (Tasks)</button>\n                            <button onClick={() => setType(GoalType.CONSISTENCY_METRIC)} className={`py-2 rounded-lg text-sm font-bold transition-all ${type === GoalType.CONSISTENCY_METRIC ? 'bg-white dark:bg-graphite-700 text-pacific-600 dark:text-white shadow-sm' : 'text-graphite-500 hover:text-graphite-700 dark:hover:text-graphite-300'}`}>Habit Metric</button>\n                        </div>\n                    </div>\n                    {type === GoalType.TASK_PROJECT ? (\n                        <div className=\"animate-in fade-in slide-in-from-top-2\">\n                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Action Plan (Subtasks)</label>\n                            <textarea value={subtasks} onChange={e => setSubtasks(e.target.value)} onKeyDown={handleKeyDown} rows={6} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm font-mono focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white leading-relaxed\" placeholder=\"- Research competitors&#10;  - Analyze pricing (Indented with Tab)&#10;- Draft copy\" />\n                            <p className=\"text-[10px] text-graphite-400 mt-1 text-right\">Use Tab to indent sub-tasks</p>\n                        </div>\n                    ) : (\n                        <div className=\"animate-in fade-in slide-in-from-top-2 p-4 border border-graphite-200 dark:border-graphite-700 rounded-xl bg-graphite-50 dark:bg-graphite-800/50\">\n                            <label className=\"block text-xs font-bold text-pacific-500 uppercase mb-3 flex items-center gap-2\"><LinkIcon size={14} /> Link Habit Source</label>\n                            <div className=\"flex gap-4 mb-3 border-b border-graphite-200 dark:border-graphite-700\">\n                                <button onClick={() => setHabitTab('current')} className={`pb-2 text-xs font-bold uppercase transition-colors border-b-2 ${habitTab === 'current' ? 'border-pacific-500 text-pacific-600 dark:text-pacific-400' : 'border-transparent text-graphite-400'}`}>Current Cycle</button>\n                                <button onClick={() => setHabitTab('database')} className={`pb-2 text-xs font-bold uppercase transition-colors border-b-2 ${habitTab === 'database' ? 'border-pacific-500 text-pacific-600 dark:text-pacific-400' : 'border-transparent text-graphite-400'}`}>Database Search</button>\n                            </div>\n                            {habitTab === 'database' && (\n                                <div className=\"relative mb-3\">\n                                    <Search size={14} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-graphite-400\" />\n                                    <input value={habitSearch} onChange={e => setHabitSearch(e.target.value)} className=\"w-full bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-700 rounded-lg pl-9 pr-3 py-2 text-sm focus:outline-none focus:border-pacific-500\" placeholder=\"Search habit history...\" />\n                                </div>\n                            )}\n                            <div className=\"max-h-40 overflow-y-auto space-y-1 pr-1\">\n                                {filteredHabits.map(h => (\n                                    <button key={h.id} onClick={() => setSelectedHabit(h)} className={`w-full text-left px-3 py-2 rounded-lg text-sm transition-all flex justify-between items-center ${selectedHabit?.name === h.name ? 'bg-pacific-500 text-white shadow-md' : 'hover:bg-graphite-200 dark:hover:bg-graphite-700 text-graphite-700 dark:text-graphite-300'}`}>\n                                        <span className=\"font-medium truncate\">{h.name}</span>\n                                        {selectedHabit?.name === h.name && <Check size={14} />}\n                                    </button>\n                                ))}\n                                {filteredHabits.length === 0 && <div className=\"text-center py-4 text-xs text-graphite-400 italic\">No habits found.</div>}\n                            </div>\n                            {selectedHabit && (\n                                <div className=\"mt-3 pt-3 border-t border-graphite-200 dark:border-graphite-700 flex items-center justify-between\">\n                                    <span className=\"text-xs text-graphite-500\">Selected: <span className=\"font-bold text-graphite-900 dark:text-white\">{selectedHabit.name}</span></span>\n                                    <button onClick={() => setSelectedHabit(null)} className=\"text-xs text-red-400 hover:text-red-500\">Clear</button>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </div>\n                <div className=\"p-6 border-t border-graphite-200 dark:border-graphite-800 flex justify-end gap-3\">\n                    <button onClick={onClose} className=\"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-800 dark:hover:text-white transition-colors\">Cancel</button>\n                    <button onClick={handleSave} disabled={!title.trim() || (type === GoalType.CONSISTENCY_METRIC && !selectedHabit)} className=\"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-pacific-500 transition-colors\">\n                        {initialGoal ? 'Save Changes' : 'Create Goal'}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":["GoalFormModal","isOpen","onClose","onSave","initialGoal","currentCycleHabits","allHabits","title","setTitle","description","setDescription","type","setType","TASK_PROJECT","subtasks","setSubtasks","selectedHabit","setSelectedHabit","habitTab","setHabitTab","habitSearch","setHabitSearch","map","t","indent","repeat","level","name","join","linked_habit_id","found","find","h","id","uniqueDbHabits","Array","from","Map","values","displayHabits","filteredHabits","filter","toLowerCase","includes","handleSave","trim","subtaskList","split","s","length","undefined","handleKeyDown","e","key","preventDefault","start","currentTarget","selectionStart","end","selectionEnd","value","newValue","substring","requestAnimationFrame","className","onClick","stopPropagation","size","onChange","target","placeholder","autoFocus","rows","CONSISTENCY_METRIC","onKeyDown","disabled"],"mappings":"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"}},
    {"offset": {"line": 509, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/HabitFormModal.tsx"],"sourcesContent":["\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { Habit, HabitWeight } from '@/types/types';\nimport { CheckCircle2, X, Save, Library, Plus, Search, Tag, Trash2, ArrowRight, Settings, Edit2, ArrowLeft, AlertCircle, Check } from 'lucide-react';\n\ninterface HabitFormModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (habitData: { name: string; category: string; weight: HabitWeight }) => void;\n    initialHabit?: Habit;\n    allHabits?: Habit[];\n    onDeleteFromLibrary?: (habitId: string) => void;\n    onRenameCategory?: (oldName: string, newName: string) => Promise<void>;\n    onDeleteCategory?: (categoryName: string) => Promise<void>;\n}\n\nexport const HabitFormModal: React.FC<HabitFormModalProps> = ({\n    isOpen, onClose, onSave, initialHabit, allHabits = [], onDeleteFromLibrary, onRenameCategory, onDeleteCategory\n}) => {\n    const [activeTab, setActiveTab] = useState<'create' | 'library'>('create');\n    const [isManagingCats, setIsManagingCats] = useState(false);\n\n    // Form State\n    const [name, setName] = useState('');\n    const [category, setCategory] = useState('');\n    const [weight, setWeight] = useState<HabitWeight>(HabitWeight.MEDIUM);\n\n    // Library State\n    const [librarySearch, setLibrarySearch] = useState('');\n    const [verifyDeleteId, setVerifyDeleteId] = useState<string | null>(null);\n\n    // Category Manager State\n    const [editingCatName, setEditingCatName] = useState<string | null>(null);\n    const [tempCatName, setTempCatName] = useState('');\n    const [verifyDeleteCat, setVerifyDeleteCat] = useState<string | null>(null);\n\n    useEffect(() => {\n        if (initialHabit) {\n            setName(initialHabit.name);\n            setCategory(initialHabit.category);\n            setWeight(initialHabit.weight);\n            setActiveTab('create');\n        } else {\n            // Reset only if opening for new habit\n            if (isOpen && !initialHabit && activeTab === 'create' && name === '') {\n                setName('');\n                setCategory('');\n                setWeight(HabitWeight.MEDIUM);\n            }\n        }\n        setIsManagingCats(false);\n    }, [initialHabit, isOpen]);\n\n    // Smart Category Derivation\n    const uniqueCategories = useMemo(() => {\n        const cats = new Set(allHabits.map(h => h.category).filter(Boolean));\n        return Array.from(cats).sort();\n    }, [allHabits]);\n\n    // Smart Library Derivation\n    const libraryItems = useMemo(() => {\n        const unique = new Map<string, Habit>();\n        allHabits.forEach(h => {\n            if (!unique.has(h.name)) {\n                unique.set(h.name, h);\n            }\n        });\n        return Array.from(unique.values()).filter(h =>\n            h.name.toLowerCase().includes(librarySearch.toLowerCase()) ||\n            h.category.toLowerCase().includes(librarySearch.toLowerCase())\n        );\n    }, [allHabits, librarySearch]);\n\n    if (!isOpen) return null;\n\n    const handleSave = () => {\n        if (!name.trim() || !category.trim()) return;\n        onSave({ name, category, weight });\n    };\n\n    const handleImportFromLibrary = (habit: Habit) => {\n        setName(habit.name);\n        setCategory(habit.category);\n        setWeight(habit.weight);\n        setActiveTab('create');\n    };\n\n    const handleDeleteClick = (e: React.MouseEvent, id: string) => {\n        e.stopPropagation();\n        if (verifyDeleteId === id) {\n            if (onDeleteFromLibrary) onDeleteFromLibrary(id);\n            setVerifyDeleteId(null);\n        } else {\n            setVerifyDeleteId(id);\n            setTimeout(() => setVerifyDeleteId(null), 3000);\n        }\n    };\n\n    // --- Category Manager Handlers ---\n    const startEditCategory = (cat: string) => {\n        setEditingCatName(cat);\n        setTempCatName(cat);\n    };\n\n    const saveEditCategory = async () => {\n        if (editingCatName && tempCatName.trim() && tempCatName !== editingCatName) {\n            if (onRenameCategory) {\n                await onRenameCategory(editingCatName, tempCatName.trim());\n                // If the current form category matched the edited one, update it too\n                if (category === editingCatName) setCategory(tempCatName.trim());\n            }\n        }\n        setEditingCatName(null);\n        setTempCatName('');\n    };\n\n    const deleteCategory = async (cat: string) => {\n        if (verifyDeleteCat === cat) {\n            if (onDeleteCategory) {\n                await onDeleteCategory(cat);\n                // If form selected this category, clear it\n                if (category === cat) setCategory('');\n            }\n            setVerifyDeleteCat(null);\n        } else {\n            setVerifyDeleteCat(cat);\n            setTimeout(() => setVerifyDeleteCat(null), 3000);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\n            <div className=\"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col max-h-[85vh]\" onClick={(e) => e.stopPropagation()}>\n\n                {/* Header & Tabs */}\n                <div className=\"flex-none border-b border-graphite-200 dark:border-graphite-800\">\n                    <div className=\"p-6 pb-4 flex justify-between items-center\">\n                        <h2 className=\"text-lg font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\n                            {isManagingCats ? (\n                                <><Settings size={18} className=\"text-graphite-500\" /> Manage Categories</>\n                            ) : activeTab === 'create' ? (\n                                <><CheckCircle2 size={18} className=\"text-pacific-500\" /> {initialHabit ? 'Edit Habit' : 'Add Habit'}</>\n                            ) : (\n                                <><Library size={18} className=\"text-bali-500\" /> Habit Library</>\n                            )}\n                        </h2>\n                        <button onClick={onClose} className=\"text-graphite-400 hover:text-white\"><X size={18} /></button>\n                    </div>\n\n                    {!initialHabit && !isManagingCats && (\n                        <div className=\"px-6 flex gap-4\">\n                            <button\n                                onClick={() => setActiveTab('create')}\n                                className={`pb-3 text-xs font-bold uppercase tracking-wider transition-colors border-b-2 ${activeTab === 'create' ? 'border-pacific-500 text-pacific-600 dark:text-pacific-400' : 'border-transparent text-graphite-400 hover:text-graphite-600 dark:hover:text-graphite-300'}`}\n                            >\n                                Create New\n                            </button>\n                            <button\n                                onClick={() => setActiveTab('library')}\n                                className={`pb-3 text-xs font-bold uppercase tracking-wider transition-colors border-b-2 ${activeTab === 'library' ? 'border-bali-500 text-bali-600 dark:text-bali-400' : 'border-transparent text-graphite-400 hover:text-graphite-600 dark:hover:text-graphite-300'}`}\n                            >\n                                From History\n                            </button>\n                        </div>\n                    )}\n                </div>\n\n                {/* Content Area */}\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                    {isManagingCats ? (\n                        <div className=\"animate-in fade-in slide-in-from-right-4 space-y-4\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                                <button onClick={() => setIsManagingCats(false)} className=\"text-xs font-bold text-graphite-500 hover:text-pacific-500 flex items-center gap-1\">\n                                    <ArrowLeft size={12} /> Back to Form\n                                </button>\n                                <span className=\"text-[10px] uppercase text-graphite-400 font-bold\">{uniqueCategories.length} Categories</span>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                {uniqueCategories.map(cat => (\n                                    <div key={cat} className=\"group flex items-center justify-between p-3 rounded-xl border border-graphite-200 dark:border-graphite-800 bg-white dark:bg-graphite-800/50 hover:border-pacific-200 dark:hover:border-pacific-900 transition-all\">\n                                        {editingCatName === cat ? (\n                                            <div className=\"flex items-center gap-2 flex-1\">\n                                                <input\n                                                    value={tempCatName}\n                                                    onChange={e => setTempCatName(e.target.value)}\n                                                    className=\"flex-1 bg-graphite-50 dark:bg-graphite-900 border border-pacific-500 rounded-lg px-2 py-1 text-sm text-graphite-900 dark:text-white outline-none\"\n                                                    autoFocus\n                                                    onKeyDown={e => e.key === 'Enter' && saveEditCategory()}\n                                                />\n                                                <button onClick={saveEditCategory} className=\"p-1.5 bg-pacific-500 text-white rounded-lg\"><Check size={14} /></button>\n                                                <button onClick={() => setEditingCatName(null)} className=\"p-1.5 text-graphite-400 hover:text-white\"><X size={14} /></button>\n                                            </div>\n                                        ) : (\n                                            <>\n                                                <span className=\"text-sm font-medium text-graphite-700 dark:text-graphite-300\">{cat}</span>\n                                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                    <button onClick={() => startEditCategory(cat)} className=\"p-2 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg\"><Edit2 size={14} /></button>\n                                                    {cat !== 'Uncategorized' && (\n                                                        <button\n                                                            onClick={() => deleteCategory(cat)}\n                                                            className={`p-2 rounded-lg flex items-center gap-2 transition-all ${verifyDeleteCat === cat ? 'bg-red-500 text-white w-24 justify-center' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'}`}\n                                                        >\n                                                            <Trash2 size={14} /> {verifyDeleteCat === cat && <span className=\"text-[10px] font-bold\">Confirm</span>}\n                                                        </button>\n                                                    )}\n                                                </div>\n                                            </>\n                                        )}\n                                    </div>\n                                ))}\n                                {uniqueCategories.length === 0 && <div className=\"text-center py-8 text-graphite-400 text-sm\">No categories defined yet.</div>}\n                            </div>\n\n                            <div className=\"p-3 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100 dark:border-blue-900/30 flex gap-3 items-start\">\n                                <AlertCircle size={16} className=\"text-blue-500 mt-0.5 shrink-0\" />\n                                <div className=\"text-xs text-blue-700 dark:text-blue-300 leading-relaxed\">\n                                    <strong>Note:</strong> Renaming updates all habits history. Deleting moves associated habits to \"Uncategorized\".\n                                </div>\n                            </div>\n                        </div>\n                    ) : activeTab === 'create' ? (\n                        <div className=\"space-y-5 animate-in fade-in slide-in-from-left-4\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Habit Name</label>\n                                <input value={name} onChange={e => setName(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white transition-all\" placeholder=\"e.g. Morning Run\" autoFocus />\n                            </div>\n\n                            <div>\n                                <div className=\"flex justify-between items-center mb-1.5\">\n                                    <label className=\"block text-xs font-bold text-graphite-500 uppercase\">Category</label>\n                                    <button onClick={() => setIsManagingCats(true)} className=\"text-[10px] font-bold text-pacific-500 hover:text-pacific-600 flex items-center gap-1\"><Settings size={10} /> Manage</button>\n                                </div>\n                                <div className=\"relative\">\n                                    <Tag size={14} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-graphite-400\" />\n                                    <input value={category} onChange={e => setCategory(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl pl-9 pr-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white transition-all\" placeholder=\"e.g. Health\" />\n                                </div>\n                                {/* Category Chips */}\n                                {uniqueCategories.length > 0 && (\n                                    <div className=\"mt-2 flex flex-wrap gap-2\">\n                                        {uniqueCategories.slice(0, 8).map(cat => (\n                                            <button\n                                                key={cat}\n                                                onClick={() => setCategory(cat === category ? '' : cat)}\n                                                className={`px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide border transition-all ${category === cat ? 'bg-pacific-500 text-white border-pacific-500' : 'bg-graphite-100 dark:bg-graphite-800 text-graphite-500 border-transparent hover:bg-pacific-50 dark:hover:bg-pacific-900/20 hover:text-pacific-600 dark:hover:text-pacific-400'}`}\n                                            >\n                                                {cat}\n                                            </button>\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n\n                            <div>\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Impact Weight</label>\n                                <div className=\"grid grid-cols-3 gap-2\">\n                                    {[HabitWeight.LOW, HabitWeight.MEDIUM, HabitWeight.HIGH].map((w) => (\n                                        <button\n                                            key={w}\n                                            onClick={() => setWeight(w)}\n                                            className={`py-2.5 text-xs font-bold rounded-xl border transition-all ${weight === w ? 'bg-pacific-500 text-white border-pacific-500 shadow-md shadow-pacific-500/20' : 'bg-graphite-50 dark:bg-graphite-800 text-graphite-500 border-graphite-200 dark:border-graphite-700 hover:border-graphite-400'}`}\n                                        >\n                                            {w === HabitWeight.LOW ? 'Low (1)' : w === HabitWeight.MEDIUM ? 'Medium (2)' : 'High (4)'}\n                                        </button>\n                                    ))}\n                                </div>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"flex flex-col h-full animate-in fade-in slide-in-from-right-4\">\n                            <div className=\"relative mb-4\">\n                                <Search size={14} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-graphite-400\" />\n                                <input\n                                    value={librarySearch}\n                                    onChange={e => setLibrarySearch(e.target.value)}\n                                    className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl pl-9 pr-4 py-2 text-sm focus:outline-none focus:border-bali-500 text-graphite-900 dark:text-white\"\n                                    placeholder=\"Search history...\"\n                                    autoFocus\n                                />\n                            </div>\n                            <div className=\"flex-1 overflow-y-auto space-y-2 pr-1\">\n                                {libraryItems.length > 0 ? libraryItems.map(habit => (\n                                    <div key={habit.id} onClick={() => handleImportFromLibrary(habit)} className=\"group flex items-center justify-between p-3 rounded-xl border border-graphite-200 dark:border-graphite-800 bg-white dark:bg-graphite-800/50 hover:border-bali-500 dark:hover:border-bali-500 cursor-pointer transition-all\">\n                                        <div>\n                                            <div className=\"text-sm font-bold text-graphite-900 dark:text-white group-hover:text-bali-600 dark:group-hover:text-bali-400 transition-colors\">{habit.name}</div>\n                                            <div className=\"flex items-center gap-2 mt-1\">\n                                                <span className=\"text-[10px] font-medium bg-graphite-100 dark:bg-graphite-900 text-graphite-500 px-2 py-0.5 rounded\">{habit.category}</span>\n                                                <div className=\"flex gap-0.5\">{[...Array(habit.weight)].map((_, i) => <div key={i} className=\"h-1 w-1 rounded-full bg-bali-400\" />)}</div>\n                                            </div>\n                                        </div>\n                                        <div className=\"flex items-center gap-2\">\n                                            <button\n                                                onClick={(e) => handleDeleteClick(e, habit.id)}\n                                                className={`p-2 rounded-lg transition-all ${verifyDeleteId === habit.id ? 'bg-red-500 text-white' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 opacity-0 group-hover:opacity-100'}`}\n                                            >\n                                                <Trash2 size={14} />\n                                            </button>\n                                            <ArrowRight size={16} className=\"text-graphite-300 group-hover:text-bali-500 -translate-x-2 group-hover:translate-x-0 transition-all opacity-0 group-hover:opacity-100\" />\n                                        </div>\n                                    </div>\n                                )) : (\n                                    <div className=\"text-center py-12 text-graphite-400 text-sm\">No matching habits found in history.</div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-6 border-t border-graphite-200 dark:border-graphite-800 flex justify-end gap-3 bg-white dark:bg-graphite-900 rounded-b-2xl\">\n                    {!isManagingCats ? (\n                        <>\n                            <button onClick={onClose} className=\"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-800 dark:hover:text-white transition-colors\">Cancel</button>\n                            {activeTab === 'create' && (\n                                <button onClick={handleSave} disabled={!name.trim()} className=\"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-pacific-500 transition-colors flex items-center gap-2\">\n                                    <Save size={14} /> Save\n                                </button>\n                            )}\n                        </>\n                    ) : (\n                        <button onClick={() => setIsManagingCats(false)} className=\"px-6 py-2 bg-graphite-100 dark:bg-graphite-800 text-graphite-900 dark:text-white rounded-xl text-sm font-bold hover:bg-graphite-200 dark:hover:bg-graphite-700 transition-colors\">\n                            Done\n                        </button>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":["HabitFormModal","isOpen","onClose","onSave","initialHabit","allHabits","onDeleteFromLibrary","onRenameCategory","onDeleteCategory","activeTab","setActiveTab","isManagingCats","setIsManagingCats","name","setName","category","setCategory","weight","setWeight","MEDIUM","librarySearch","setLibrarySearch","verifyDeleteId","setVerifyDeleteId","editingCatName","setEditingCatName","tempCatName","setTempCatName","verifyDeleteCat","setVerifyDeleteCat","uniqueCategories","cats","Set","map","h","filter","Boolean","Array","from","sort","libraryItems","unique","Map","forEach","has","set","values","toLowerCase","includes","handleSave","trim","handleImportFromLibrary","habit","handleDeleteClick","e","id","stopPropagation","setTimeout","startEditCategory","cat","saveEditCategory","deleteCategory","className","onClick","size","length","value","onChange","target","autoFocus","onKeyDown","key","placeholder","slice","LOW","HIGH","w","_","i","disabled"],"mappings":"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"}},
    {"offset": {"line": 1357, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/CycleEditorModal.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Cycle, Goal, Habit, GoalType, EntityStatus, CCHItem } from '@/types/types';\r\nimport { supabaseService } from '@/lib/supabaseService';\r\nimport { Edit3, Brain, Fingerprint, Activity, Plus, Trash2, CheckCircle2, List, X, Save, Target, AlertTriangle, Calendar, Rocket, Power, AlertCircle } from 'lucide-react';\r\nimport { GoalFormModal } from './GoalFormModal';\r\nimport { HabitFormModal } from './HabitFormModal';\r\n\r\ninterface CycleEditorModalProps {\r\n    mode?: 'create' | 'edit';\r\n    cycle?: Cycle; // Optional, undefined in 'create' mode\r\n    goals: Goal[];\r\n    habits: Habit[];\r\n    allHabits: Habit[];\r\n    suggestedSprintNumber?: number; // For create mode auto-fill\r\n    onClose: () => void;\r\n    // Handler for 'edit' mode (atomic updates)\r\n    onSaveCycle?: (cycle: Cycle) => void;\r\n    onManageGoal?: (action: 'create' | 'update' | 'delete', goal: any) => void;\r\n    onManageHabit?: (action: 'create' | 'update' | 'delete', habit: any) => void;\r\n    // Handler for 'create' mode (bulk save)\r\n    onCreate?: (cycleData: any, goals: any[], habits: any[]) => void;\r\n    // Category Handlers\r\n    onRenameCategory?: (oldName: string, newName: string) => Promise<void>;\r\n    onDeleteCategory?: (categoryName: string) => Promise<void>;\r\n    // Explicit Handler for deleting habits from the library (database)\r\n    onDeleteHabitFromDB?: (habitId: string) => Promise<void>;\r\n    // Dynamic Cycle Limit\r\n    maxCycles?: number;\r\n    // Context for Smart Scheduling\r\n    versionStartDate?: string;\r\n    existingCycles?: Cycle[];\r\n}\r\n\r\n// Helper for safe date arithmetic without timezone issues\r\nconst addDaysToDate = (dateStr: string, days: number): string => {\r\n    if (!dateStr) return '';\r\n    const parts = dateStr.split('-').map(Number);\r\n    // Create date in local time (Year, Month Index, Day)\r\n    const date = new Date(parts[0], parts[1] - 1, parts[2]);\r\n    date.setDate(date.getDate() + days);\r\n\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n};\r\n\r\nexport const CycleEditorModal: React.FC<CycleEditorModalProps> = ({\r\n    mode = 'edit', cycle, goals, habits, allHabits, suggestedSprintNumber, onClose, onSaveCycle, onManageGoal, onManageHabit, onCreate, onRenameCategory, onDeleteCategory, onDeleteHabitFromDB, maxCycles = 6, versionStartDate, existingCycles\r\n}) => {\r\n    const [activeTab, setActiveTab] = useState<'strategy' | 'identity' | 'mantras' | 'goals' | 'habits'>('strategy');\r\n\r\n    // --- Cycle Config State (Create Mode) ---\r\n    const [sprintNumber, setSprintNumber] = useState(suggestedSprintNumber || 1);\r\n    const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [endDate, setEndDate] = useState(new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]);\r\n    const [isActive, setIsActive] = useState(true);\r\n    const [cycleDuration, setCycleDuration] = useState(15); // Default, updated by DB\r\n\r\n    // --- Cycle Content State ---\r\n    const [priorities, setPriorities] = useState<string[]>(['', '', '']);\r\n    const [problems, setProblems] = useState('');\r\n    const [learning, setLearning] = useState('');\r\n    const [beliefs, setBeliefs] = useState<string[]>([]);\r\n    const [characteristics, setCharacteristics] = useState<string[]>([]);\r\n    const [skills, setSkills] = useState<string[]>([]);\r\n    const [selectedMantras, setSelectedMantras] = useState<string[]>([]);\r\n\r\n    // --- Local Lists State (Buffer for Create Mode) ---\r\n    // In 'create' mode, we manipulate these arrays. In 'edit' mode, we use the props `goals` and `habits` but might optimistic update these for UI.\r\n    const [localGoals, setLocalGoals] = useState<Goal[]>([]);\r\n    const [localHabits, setLocalHabits] = useState<Habit[]>([]);\r\n\r\n    // --- Helper State ---\r\n    const [allMantras, setAllMantras] = useState<string[]>([]);\r\n    const [tempBelief, setTempBelief] = useState('');\r\n    const [tempChar, setTempChar] = useState('');\r\n    const [tempSkill, setTempSkill] = useState('');\r\n    const [newMantra, setNewMantra] = useState('');\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // --- Sub-Modals State ---\r\n    const [editingGoal, setEditingGoal] = useState<Goal | undefined>(undefined);\r\n    const [isGoalModalOpen, setIsGoalModalOpen] = useState(false);\r\n    const [editingHabit, setEditingHabit] = useState<Habit | undefined>(undefined);\r\n    const [isHabitModalOpen, setIsHabitModalOpen] = useState(false);\r\n    const [verifyDeleteId, setVerifyDeleteId] = useState<string | null>(null);\r\n\r\n    // Initialization\r\n    useEffect(() => {\r\n        supabaseService.getMantras().then(setAllMantras);\r\n\r\n        if (mode === 'edit' && cycle) {\r\n            setPriorities(cycle.focus_priorities);\r\n            setProblems(cycle.problems);\r\n            setLearning(cycle.learning_focus);\r\n            setBeliefs(cycle.cch_list.find(c => c.category === 'Beliefs')?.items || []);\r\n            setCharacteristics(cycle.cch_list.find(c => c.category === 'Characteristics')?.items || []);\r\n            setSkills(cycle.cch_list.find(c => c.category === 'Skills')?.items || []);\r\n            setSelectedMantras(cycle.mantras);\r\n            setSprintNumber(cycle.sprint_number);\r\n            setStartDate(cycle.start_date);\r\n            setEndDate(cycle.end_date);\r\n        }\r\n    }, [mode, cycle]);\r\n\r\n    // Smart Scheduling Logic\r\n    useEffect(() => {\r\n        const initScheduling = async () => {\r\n            // 1. Fetch System Settings\r\n            const settings = await supabaseService.getSystemSettings();\r\n            const duration = Math.floor(settings.days / settings.cycles);\r\n            setCycleDuration(duration);\r\n\r\n            // 2. Auto-Suggest Dates (Only in Create Mode)\r\n            if (mode === 'create' && versionStartDate) {\r\n                let suggestedStart = versionStartDate;\r\n\r\n                // If cycles exist, start after the last one\r\n                if (existingCycles && existingCycles.length > 0) {\r\n                    // Sort by end date descending\r\n                    const sorted = [...existingCycles].sort((a, b) => new Date(b.end_date).getTime() - new Date(a.end_date).getTime());\r\n                    const lastCycle = sorted[0];\r\n                    suggestedStart = addDaysToDate(lastCycle.end_date, 1);\r\n                }\r\n\r\n                setStartDate(suggestedStart);\r\n                setEndDate(addDaysToDate(suggestedStart, duration - 1));\r\n            }\r\n        };\r\n        initScheduling();\r\n    }, [mode, versionStartDate, existingCycles]);\r\n\r\n    // Sync local state with props in Edit mode\r\n    useEffect(() => {\r\n        if (mode === 'edit') {\r\n            setLocalGoals(goals);\r\n            setLocalHabits(habits);\r\n        }\r\n    }, [goals, habits, mode]);\r\n\r\n    // -- Cycle Logic Handlers --\r\n    const handleAddMantra = async () => { if (newMantra.trim()) { await supabaseService.addMantra(newMantra); setAllMantras(prev => [...prev, newMantra]); setSelectedMantras(prev => [...prev, newMantra]); setNewMantra(''); } };\r\n    const handleAddBelief = () => { if (tempBelief.trim()) { setBeliefs([...beliefs, tempBelief.trim()]); setTempBelief(''); } };\r\n    const handleAddChar = () => { if (tempChar.trim()) { setCharacteristics([...characteristics, tempChar.trim()]); setTempChar(''); } };\r\n    const handleAddSkill = () => { if (tempSkill.trim()) { setSkills([...skills, tempSkill.trim()]); setTempSkill(''); } };\r\n\r\n    const handleManualStartDateChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const newStart = e.target.value;\r\n        setStartDate(newStart);\r\n        if (newStart && cycleDuration > 0) {\r\n            setEndDate(addDaysToDate(newStart, cycleDuration - 1));\r\n        }\r\n    };\r\n\r\n    // -- Main Save Handler --\r\n    const handleFinalSave = () => {\r\n        // Validate Constraints\r\n        if (mode === 'create' && (sprintNumber < 1 || sprintNumber > maxCycles)) {\r\n            setError(`Versions are limited to exactly ${maxCycles} cycles.`);\r\n            setActiveTab('strategy');\r\n            return;\r\n        }\r\n\r\n        const cycleData = {\r\n            sprint_number: sprintNumber,\r\n            start_date: startDate,\r\n            end_date: endDate,\r\n            status: isActive ? EntityStatus.ACTIVE : undefined, // Only relevant for create usually\r\n            focus_priorities: priorities.filter(p => p.trim().length > 0),\r\n            problems,\r\n            learning_focus: learning,\r\n            mantras: selectedMantras,\r\n            cch_list: [\r\n                { category: 'Beliefs', items: beliefs },\r\n                { category: 'Characteristics', items: characteristics },\r\n                { category: 'Skills', items: skills }\r\n            ] as CCHItem[]\r\n        };\r\n\r\n        if (mode === 'create' && onCreate) {\r\n            onCreate(cycleData, localGoals, localHabits);\r\n        } else if (mode === 'edit' && onSaveCycle && cycle) {\r\n            // In edit mode, goals/habits are handled atomically by other handlers. We just save the cycle config.\r\n            onSaveCycle({ ...cycle, ...cycleData });\r\n        }\r\n    };\r\n\r\n    // -- Goal/Habit Wrapper Handlers --\r\n\r\n    const handleGoalSaveWrapper = (goalData: any, selectedHabit: any) => {\r\n        // goalData from modal: { title, description, type, subtasks (string[]) }\r\n        const newGoalObj = {\r\n            id: editingGoal?.id || `temp-g-${Date.now()}`,\r\n            ...goalData,\r\n            // If it's consistency, we need to store the habit data structure temporarily for the parent to process\r\n            linkedHabit: selectedHabit,\r\n            // In create mode, subtasks come as strings from modal, we format them for preview\r\n            subtasks: goalData.subtasks?.map((s: string) => ({ name: s, done: false }))\r\n        };\r\n\r\n        if (mode === 'create') {\r\n            if (editingGoal) {\r\n                setLocalGoals(prev => prev.map(g => g.id === editingGoal.id ? { ...g, ...newGoalObj } : g));\r\n            } else {\r\n                setLocalGoals(prev => [...prev, newGoalObj]);\r\n            }\r\n        } else {\r\n            // Edit Mode: Immediate DB Action\r\n            if (onManageGoal) {\r\n                const action = editingGoal ? 'update' : 'create';\r\n                onManageGoal(action, { ...newGoalObj, linkedHabit: selectedHabit });\r\n            }\r\n        }\r\n        setIsGoalModalOpen(false);\r\n    };\r\n\r\n    const handleHabitSaveWrapper = (habitData: any) => {\r\n        const newHabitObj = {\r\n            id: editingHabit?.id || `temp-h-${Date.now()}`,\r\n            ...habitData\r\n        };\r\n\r\n        if (mode === 'create') {\r\n            if (editingHabit) {\r\n                setLocalHabits(prev => prev.map(h => h.id === editingHabit.id ? newHabitObj : h));\r\n            } else {\r\n                setLocalHabits(prev => [...prev, newHabitObj]);\r\n            }\r\n        } else {\r\n            if (onManageHabit) {\r\n                const action = editingHabit ? 'update' : 'create';\r\n                onManageHabit(action, newHabitObj);\r\n            }\r\n        }\r\n        setIsHabitModalOpen(false);\r\n    };\r\n\r\n    // Handle deleting a habit from the library/history view in the modal\r\n    const handleDeleteFromLibrary = async (habitId: string) => {\r\n        if (onDeleteHabitFromDB) {\r\n            await onDeleteHabitFromDB(habitId);\r\n        } else if (onManageHabit) {\r\n            onManageHabit('delete', { id: habitId });\r\n        } else {\r\n            console.warn(\"Delete from library not fully supported in create mode without parent handler\");\r\n        }\r\n    };\r\n\r\n    const handleDeleteItem = (id: string, type: 'goal' | 'habit') => {\r\n        if (verifyDeleteId !== id) {\r\n            setVerifyDeleteId(id);\r\n            setTimeout(() => setVerifyDeleteId(null), 3000);\r\n            return;\r\n        }\r\n\r\n        if (mode === 'create') {\r\n            if (type === 'goal') setLocalGoals(prev => prev.filter(g => g.id !== id));\r\n            else setLocalHabits(prev => prev.filter(h => h.id !== id));\r\n        } else {\r\n            if (type === 'goal' && onManageGoal) onManageGoal('delete', { id });\r\n            if (type === 'habit' && onManageHabit) onManageHabit('delete', { id });\r\n        }\r\n        setVerifyDeleteId(null);\r\n    };\r\n\r\n    // Open Handlers\r\n    const openAddGoal = () => { setEditingGoal(undefined); setIsGoalModalOpen(true); };\r\n    const openEditGoal = (g: Goal) => { setEditingGoal(g); setIsGoalModalOpen(true); };\r\n    const openAddHabit = () => { setEditingHabit(undefined); setIsHabitModalOpen(true); };\r\n    const openEditHabit = (h: Habit) => { setEditingHabit(h); setIsHabitModalOpen(true); };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\r\n            <div className=\"w-full max-w-4xl rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col h-[85vh]\" onClick={e => e.stopPropagation()}>\r\n\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-graphite-200 dark:border-graphite-800 flex justify-between items-center bg-graphite-50 dark:bg-graphite-950/50 rounded-t-2xl\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                            {mode === 'create' ? <Rocket size={20} className=\"text-pacific-500\" /> : <Edit3 size={20} className=\"text-pacific-500\" />}\r\n                            {mode === 'create' ? 'Initialize New Cycle' : 'Cycle Editor'}\r\n                        </h2>\r\n                        <div className=\"text-xs text-graphite-500 mt-1 uppercase tracking-wider\">\r\n                            {mode === 'create' ? 'System Configuration' : `Cycle ${cycle?.sprint_number} Configuration`}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Tabs */}\r\n                    <div className=\"flex bg-white dark:bg-graphite-800 p-1 rounded-xl border border-graphite-200 dark:border-graphite-700\">\r\n                        {[\r\n                            { id: 'strategy', icon: <Target size={14} /> },\r\n                            { id: 'identity', icon: <Fingerprint size={14} /> },\r\n                            { id: 'mantras', icon: <Brain size={14} /> },\r\n                            { id: 'goals', icon: <CheckCircle2 size={14} /> },\r\n                            { id: 'habits', icon: <List size={14} /> }\r\n                        ].map(tab => (\r\n                            <button\r\n                                key={tab.id}\r\n                                onClick={() => setActiveTab(tab.id as any)}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold uppercase transition-all ${activeTab === tab.id\r\n                                    ? 'bg-pacific-500 text-white shadow-md'\r\n                                    : 'text-graphite-500 hover:text-graphite-900 dark:hover:text-graphite-white hover:bg-graphite-50 dark:hover:bg-graphite-700'\r\n                                    }`}\r\n                            >\r\n                                {tab.icon} {tab.id}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <button onClick={onClose} type=\"button\" className=\"text-graphite-400 hover:text-white transition-colors\"><X size={24} /></button>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-8 bg-graphite-50/50 dark:bg-graphite-900/50\">\r\n                    {/* STRATEGY TAB */}\r\n                    {activeTab === 'strategy' && (\r\n                        <div className=\"space-y-6 max-w-2xl mx-auto animate-in fade-in slide-in-from-right-2\">\r\n\r\n                            {/* CREATE MODE: Configuration Fields */}\r\n                            {mode === 'create' && (\r\n                                <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm space-y-4\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-2 text-pacific-500 text-xs font-bold uppercase tracking-widest\">\r\n                                            <Calendar size={14} /> Temporal Config\r\n                                        </div>\r\n                                        <div className=\"text-[10px] font-bold text-pacific-600 dark:text-pacific-400 bg-pacific-50 dark:bg-pacific-900/20 px-2 py-1 rounded\">\r\n                                            AUTO-SUGGESTED\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Start Date</label>\r\n                                            <input\r\n                                                type=\"date\"\r\n                                                value={startDate}\r\n                                                onChange={handleManualStartDateChange}\r\n                                                className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2.5 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500\"\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">End Date</label>\r\n                                            <input\r\n                                                type=\"date\"\r\n                                                value={endDate}\r\n                                                onChange={e => setEndDate(e.target.value)}\r\n                                                className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2.5 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-4 pt-2\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Cycle Number (1-{maxCycles})</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                min=\"1\"\r\n                                                max={maxCycles}\r\n                                                value={sprintNumber}\r\n                                                onChange={e => {\r\n                                                    const val = Number(e.target.value);\r\n                                                    setSprintNumber(val);\r\n                                                    if (val > maxCycles) setError(`Maximum ${maxCycles} cycles allowed per version.`);\r\n                                                    else setError(null);\r\n                                                }}\r\n                                                className={`w-full bg-graphite-50 dark:bg-graphite-950 border rounded-xl px-3 py-2.5 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500 ${error ? 'border-red-500 ring-1 ring-red-500/20' : 'border-graphite-200 dark:border-graphite-700'}`}\r\n                                            />\r\n                                            {error && <p className=\"text-red-500 text-[10px] mt-1 font-bold flex items-center gap-1\"><AlertCircle size={10} /> {error}</p>}\r\n                                        </div>\r\n                                        <div className=\"flex items-end\">\r\n                                            <button\r\n                                                onClick={() => setIsActive(!isActive)}\r\n                                                className={`w-full py-2.5 rounded-xl border flex items-center justify-center gap-2 text-sm font-bold transition-all ${isActive ? 'bg-pacific-500/10 border-pacific-500/50 text-pacific-600 dark:text-pacific-400' : 'bg-graphite-50 dark:bg-graphite-950 border-graphite-200 dark:border-graphite-700 text-graphite-500'}`}\r\n                                            >\r\n                                                <Power size={16} /> {isActive ? 'Status: Active' : 'Status: Inactive'}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-4\">Focus Priorities</label>\r\n                                <div className=\"space-y-3\">\r\n                                    {priorities.map((p, i) => (\r\n                                        <div key={i} className=\"flex gap-3\">\r\n                                            <span className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-graphite-100 dark:bg-graphite-800 font-bold text-graphite-500 border border-graphite-200 dark:border-graphite-700\">{i + 1}</span>\r\n                                            <input value={p} onChange={e => { const newP = [...priorities]; newP[i] = e.target.value; setPriorities(newP); }} className=\"flex-1 bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder={`Priority ${i + 1}`} />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-2\">Current Friction/Problems</label>\r\n                                <textarea value={problems} onChange={e => setProblems(e.target.value)} rows={3} className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl p-4 text-sm focus:outline-none focus:border-pacific-500 resize-none transition-colors\" placeholder=\"What is slowing you down?\" />\r\n                            </div>\r\n                            <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-2\">Learning Focus</label>\r\n                                <input value={learning} onChange={e => setLearning(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl p-4 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder=\"One major skill to master...\" />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* IDENTITY TAB */}\r\n                    {activeTab === 'identity' && (\r\n                        <div className=\"space-y-8 max-w-2xl mx-auto animate-in fade-in slide-in-from-right-2\">\r\n                            {[{ title: 'Core Beliefs', items: beliefs, add: handleAddBelief, val: tempBelief, set: setTempBelief, icon: <Brain size={18} /> }, { title: 'Characteristics', items: characteristics, add: handleAddChar, val: tempChar, set: setTempChar, icon: <Fingerprint size={18} /> }, { title: 'Skills Acquisition', items: skills, add: handleAddSkill, val: tempSkill, set: setTempSkill, icon: <Activity size={18} /> }].map((section, idx) => (\r\n                                <div key={idx} className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                    <h3 className=\"text-sm font-bold text-graphite-900 dark:text-white flex items-center gap-2 mb-4\">{section.icon} {section.title}</h3>\r\n                                    <div className=\"flex flex-wrap gap-2 mb-4\">\r\n                                        {section.items.map((item, i) => (\r\n                                            <span key={i} className=\"bg-graphite-100 dark:bg-graphite-800 px-3 py-1.5 rounded-lg text-xs font-medium flex items-center gap-2 border border-graphite-200 dark:border-graphite-700\">\r\n                                                {item}\r\n                                                <button onClick={() => { if (section.title === 'Core Beliefs') setBeliefs(beliefs.filter((_, j) => j !== i)); else if (section.title === 'Characteristics') setCharacteristics(characteristics.filter((_, j) => j !== i)); else setSkills(skills.filter((_, j) => j !== i)); }} className=\"text-graphite-400 hover:text-red-500\"><X size={12} /></button>\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <input value={section.val} onChange={e => section.set(e.target.value)} onKeyDown={e => e.key === 'Enter' && section.add()} className=\"flex-1 bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder={`Add ${section.title}...`} />\r\n                                        <button onClick={section.add} className=\"p-2 bg-pacific-500 text-white rounded-xl hover:bg-pacific-600 transition-colors\"><Plus size={20} /></button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* MANTRAS TAB */}\r\n                    {activeTab === 'mantras' && (\r\n                        <div className=\"space-y-4 max-w-2xl mx-auto animate-in fade-in slide-in-from-right-2 bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-3\">Select Active Mantras</label>\r\n                                <div className=\"grid grid-cols-1 gap-2 max-h-[400px] overflow-y-auto pr-2\">\r\n                                    {allMantras.map((m, i) => (\r\n                                        <div key={i} onClick={() => setSelectedMantras(prev => prev.includes(m) ? prev.filter(x => x !== m) : [...prev, m])} className={`p-3 rounded-xl border cursor-pointer transition-all flex items-center justify-between ${selectedMantras.includes(m) ? 'bg-pacific-50 border-pacific-500 text-pacific-700 dark:bg-pacific-900/20 dark:text-pacific-300' : 'bg-graphite-50 dark:bg-graphite-950 border-transparent text-graphite-600 dark:text-graphite-400 hover:bg-graphite-100 dark:hover:bg-graphite-800'}`}>\r\n                                            <span className=\"text-sm font-medium\">{m}</span>\r\n                                            {selectedMantras.includes(m) && <CheckCircle2 size={16} />}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex gap-2 pt-4 border-t border-graphite-200 dark:border-graphite-800\">\r\n                                <input value={newMantra} onChange={e => setNewMantra(e.target.value)} className=\"flex-1 bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder=\"New Mantra...\" />\r\n                                <button onClick={handleAddMantra} className=\"px-4 bg-graphite-900 dark:bg-white text-white dark:text-graphite-900 rounded-xl font-bold text-xs uppercase tracking-wider\">ADD</button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* GOALS TAB */}\r\n                    {activeTab === 'goals' && (\r\n                        <div className=\"max-w-3xl mx-auto animate-in fade-in slide-in-from-right-2 space-y-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <h3 className=\"text-sm font-bold text-graphite-500 uppercase tracking-widest\">Active Goals</h3>\r\n                                <button onClick={openAddGoal} className=\"flex items-center gap-2 px-4 py-2 bg-pacific-600 text-white rounded-xl text-xs font-bold hover:bg-pacific-500 shadow-lg shadow-pacific-500/30 transition-colors\">\r\n                                    <Plus size={16} /> Add Goal\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"space-y-3\">\r\n                                {localGoals.map((g) => (\r\n                                    <div key={g.id} className=\"p-4 bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 rounded-2xl flex justify-between items-center group hover:border-pacific-500/30 transition-all shadow-sm\">\r\n                                        <div>\r\n                                            <div className=\"font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                                                {g.title}\r\n                                                <span className={`text-[10px] uppercase px-2 py-0.5 rounded border ${g.type === GoalType.TASK_PROJECT ? 'border-purple-200 text-purple-600 dark:border-purple-900 dark:text-purple-400' : 'border-bali-200 text-bali-600 dark:border-bali-900 dark:text-bali-400'}`}>\r\n                                                    {g.type === GoalType.TASK_PROJECT ? 'Project' : 'Metric'}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"text-xs text-graphite-500 mt-1 line-clamp-1\">{g.description}</div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button onClick={() => openEditGoal(g)} className=\"p-2 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg transition-colors\"><Edit3 size={16} /></button>\r\n                                            <button\r\n                                                onClick={() => handleDeleteItem(g.id, 'goal')}\r\n                                                className={`p-2 rounded-lg transition-all flex items-center gap-2 ${verifyDeleteId === g.id ? 'bg-red-500 text-white w-24 justify-center' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'}`}\r\n                                            >\r\n                                                <Trash2 size={16} /> {verifyDeleteId === g.id && <span className=\"text-xs font-bold\">Confirm</span>}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {localGoals.length === 0 && <div className=\"text-center py-12 text-graphite-400 italic bg-graphite-50 dark:bg-graphite-950 rounded-2xl border border-dashed border-graphite-200 dark:border-graphite-800\">No goals defined.</div>}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* HABITS TAB */}\r\n                    {activeTab === 'habits' && (\r\n                        <div className=\"max-w-3xl mx-auto animate-in fade-in slide-in-from-right-2 space-y-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <h3 className=\"text-sm font-bold text-graphite-500 uppercase tracking-widest\">Cycle Habits</h3>\r\n                                <button onClick={openAddHabit} className=\"flex items-center gap-2 px-4 py-2 bg-pacific-600 text-white rounded-xl text-xs font-bold hover:bg-pacific-500 shadow-lg shadow-pacific-500/30 transition-colors\">\r\n                                    <Plus size={16} /> Add Habit\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"space-y-3\">\r\n                                {localHabits.map((h) => (\r\n                                    <div key={h.id} className=\"p-4 bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 rounded-2xl flex justify-between items-center group hover:border-pacific-500/30 transition-all shadow-sm\">\r\n                                        <div>\r\n                                            <div className=\"font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                                                {h.name}\r\n                                                {h.linked_goal_id && <span className=\"text-[10px] uppercase px-2 py-0.5 rounded bg-pacific-50 dark:bg-pacific-900/20 text-pacific-600 dark:text-pacific-400 font-bold flex items-center gap-1\"><AlertTriangle size={10} /> Linked</span>}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-graphite-500 mt-1 flex items-center gap-3\">\r\n                                                <span className=\"bg-graphite-100 dark:bg-graphite-800 px-2 py-0.5 rounded\">{h.category}</span>\r\n                                                <span>Weight: {h.weight}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button onClick={() => openEditHabit(h)} className=\"p-2 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg transition-colors\"><Edit3 size={16} /></button>\r\n                                            <button\r\n                                                onClick={() => handleDeleteItem(h.id, 'habit')}\r\n                                                className={`p-2 rounded-lg transition-all flex items-center gap-2 ${verifyDeleteId === h.id ? 'bg-red-500 text-white w-24 justify-center' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'}`}\r\n                                            >\r\n                                                <Trash2 size={16} /> {verifyDeleteId === h.id && <span className=\"text-xs font-bold\">Confirm</span>}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {localHabits.length === 0 && <div className=\"text-center py-12 text-graphite-400 italic bg-graphite-50 dark:bg-graphite-950 rounded-2xl border border-dashed border-graphite-200 dark:border-graphite-800\">No habits defined.</div>}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer Actions */}\r\n                <div className=\"p-6 border-t border-graphite-200 dark:border-graphite-800 flex justify-end gap-3 bg-white dark:bg-graphite-900 rounded-b-2xl\">\r\n                    <button onClick={onClose} className=\"px-6 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-900 dark:hover:text-white transition-colors\">Close</button>\r\n                    <button onClick={handleFinalSave} className=\"px-8 py-2 bg-graphite-900 dark:bg-white text-white dark:text-graphite-900 rounded-xl text-sm font-bold shadow-lg hover:opacity-90 transition-opacity flex items-center gap-2\">\r\n                        {mode === 'create' ? <Rocket size={16} /> : <Save size={16} />}\r\n                        {mode === 'create' ? 'Initialize Cycle' : 'Save Cycle Config'}\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Sub-Modals */}\r\n                <GoalFormModal\r\n                    isOpen={isGoalModalOpen}\r\n                    onClose={() => setIsGoalModalOpen(false)}\r\n                    onSave={handleGoalSaveWrapper}\r\n                    initialGoal={editingGoal}\r\n                    allHabits={allHabits}\r\n                    currentCycleHabits={localHabits}\r\n                />\r\n                <HabitFormModal\r\n                    isOpen={isHabitModalOpen}\r\n                    onClose={() => setIsHabitModalOpen(false)}\r\n                    onSave={handleHabitSaveWrapper}\r\n                    initialHabit={editingHabit}\r\n                    allHabits={allHabits}\r\n                    onDeleteFromLibrary={handleDeleteFromLibrary}\r\n                    onRenameCategory={onRenameCategory}\r\n                    onDeleteCategory={onDeleteCategory}\r\n                />\r\n            </div>\r\n        </div>\r\n    )\r\n};\r\n"],"names":["addDaysToDate","dateStr","days","parts","split","map","Number","date","Date","setDate","getDate","year","getFullYear","month","String","getMonth","padStart","day","CycleEditorModal","mode","cycle","goals","habits","allHabits","suggestedSprintNumber","onClose","onSaveCycle","onManageGoal","onManageHabit","onCreate","onRenameCategory","onDeleteCategory","onDeleteHabitFromDB","maxCycles","versionStartDate","existingCycles","activeTab","setActiveTab","sprintNumber","setSprintNumber","startDate","setStartDate","toISOString","endDate","setEndDate","now","isActive","setIsActive","cycleDuration","setCycleDuration","priorities","setPriorities","problems","setProblems","learning","setLearning","beliefs","setBeliefs","characteristics","setCharacteristics","skills","setSkills","selectedMantras","setSelectedMantras","localGoals","setLocalGoals","localHabits","setLocalHabits","allMantras","setAllMantras","tempBelief","setTempBelief","tempChar","setTempChar","tempSkill","setTempSkill","newMantra","setNewMantra","error","setError","editingGoal","setEditingGoal","undefined","isGoalModalOpen","setIsGoalModalOpen","editingHabit","setEditingHabit","isHabitModalOpen","setIsHabitModalOpen","verifyDeleteId","setVerifyDeleteId","getMantras","then","focus_priorities","learning_focus","cch_list","find","c","category","items","mantras","sprint_number","start_date","end_date","initScheduling","settings","getSystemSettings","duration","Math","floor","cycles","suggestedStart","length","sorted","sort","a","b","getTime","lastCycle","handleAddMantra","trim","addMantra","prev","handleAddBelief","handleAddChar","handleAddSkill","handleManualStartDateChange","e","newStart","target","value","handleFinalSave","cycleData","status","ACTIVE","filter","p","handleGoalSaveWrapper","goalData","selectedHabit","newGoalObj","id","linkedHabit","subtasks","s","name","done","g","action","handleHabitSaveWrapper","habitData","newHabitObj","h","handleDeleteFromLibrary","habitId","console","warn","handleDeleteItem","type","setTimeout","openAddGoal","openEditGoal","openAddHabit","openEditHabit","className","onClick","stopPropagation","size","icon","tab","onChange","min","max","val","i","newP","placeholder","rows","title","add","set","section","idx","item","_","j","onKeyDown","key","m","includes","x","TASK_PROJECT","description","linked_goal_id","weight","isOpen","onSave","initialGoal","currentCycleHabits","initialHabit","onDeleteFromLibrary"],"mappings":"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"}},
    {"offset": {"line": 2840, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/CustomDatePicker.tsx"],"sourcesContent":["\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Calendar, ChevronLeft, ChevronRight, X, Clock } from 'lucide-react';\n\ninterface CustomDatePickerProps {\n  label: string;\n  value: string;\n  onChange: (date: string) => void;\n}\n\nexport const CustomDatePicker: React.FC<CustomDatePickerProps> = ({ label, value, onChange }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  // Default to today if no value, otherwise parse the YYYY-MM-DD string\n  const [viewDate, setViewDate] = useState(() => {\n      if (value) {\n          // Parse \"YYYY-MM-DD\" explicitly to avoid timezone shifts\n          const parts = value.split('-').map(Number);\n          if (parts.length === 3 && !isNaN(parts[0])) {\n             return new Date(parts[0], parts[1] - 1, parts[2]);\n          }\n      }\n      return new Date();\n  });\n  \n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Sync view if value changes externally, but only if widely different to allow browsing\n  useEffect(() => {\n      if (value) {\n          const parts = value.split('-').map(Number);\n          const date = new Date(parts[0], parts[1] - 1, parts[2]);\n          if (!isNaN(date.getTime())) {\n              if (date.getMonth() !== viewDate.getMonth() || date.getFullYear() !== viewDate.getFullYear()) {\n                 setViewDate(date);\n              }\n          }\n      }\n  }, [value]);\n\n  const formatDate = (dateStr: string) => {\n    if (!dateStr) return 'Select Date';\n    const parts = dateStr.split('-').map(Number);\n    const date = new Date(parts[0], parts[1] - 1, parts[2]);\n    if (isNaN(date.getTime())) return 'Select Date';\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\n  };\n\n  const changeMonth = (offset: number) => {\n    const newDate = new Date(viewDate);\n    newDate.setMonth(newDate.getMonth() + offset);\n    setViewDate(newDate);\n  };\n\n  const handleDayClick = (day: number, type: 'prev' | 'current' | 'next') => {\n    const year = viewDate.getFullYear();\n    const month = viewDate.getMonth();\n    \n    let targetDate: Date;\n    if (type === 'prev') {\n        targetDate = new Date(year, month - 1, day);\n    } else if (type === 'next') {\n        targetDate = new Date(year, month + 1, day);\n    } else {\n        targetDate = new Date(year, month, day);\n    }\n\n    // Format to YYYY-MM-DD manually\n    const y = targetDate.getFullYear();\n    const m = String(targetDate.getMonth() + 1).padStart(2, '0');\n    const d = String(targetDate.getDate()).padStart(2, '0');\n    \n    onChange(`${y}-${m}-${d}`);\n    setIsOpen(false);\n    setViewDate(targetDate);\n  };\n\n  const handleToday = () => {\n      const today = new Date();\n      const y = today.getFullYear();\n      const m = String(today.getMonth() + 1).padStart(2, '0');\n      const d = String(today.getDate()).padStart(2, '0');\n      onChange(`${y}-${m}-${d}`);\n      setViewDate(today);\n      setIsOpen(false);\n  };\n\n  const handleClear = () => {\n      onChange('');\n      setIsOpen(false);\n  };\n\n  // Grid Generation Logic\n  const generateGrid = () => {\n      const year = viewDate.getFullYear();\n      const month = viewDate.getMonth();\n      \n      const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0-6\n      const daysInMonth = new Date(year, month + 1, 0).getDate();\n      const daysInPrevMonth = new Date(year, month, 0).getDate();\n      \n      const days = [];\n      \n      // Prev Month Padding\n      for (let i = firstDayOfMonth - 1; i >= 0; i--) {\n          days.push({ day: daysInPrevMonth - i, type: 'prev' as const });\n      }\n      \n      // Current Month\n      for (let i = 1; i <= daysInMonth; i++) {\n          days.push({ day: i, type: 'current' as const });\n      }\n      \n      // Next Month Padding (Fill to 42 cells for 6 rows)\n      const remaining = 42 - days.length;\n      for (let i = 1; i <= remaining; i++) {\n          days.push({ day: i, type: 'next' as const });\n      }\n      \n      return days;\n  };\n\n  const grid = generateGrid();\n  const monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n  \n  const isSelected = (day: number, type: string) => {\n      if (!value) return false;\n      const parts = value.split('-').map(Number);\n      const selected = new Date(parts[0], parts[1] - 1, parts[2]);\n      if (isNaN(selected.getTime())) return false;\n      \n      // Calculate the actual date of the cell\n      const year = viewDate.getFullYear();\n      const month = viewDate.getMonth();\n      let checkDate: Date;\n      \n      if (type === 'prev') checkDate = new Date(year, month - 1, day);\n      else if (type === 'next') checkDate = new Date(year, month + 1, day);\n      else checkDate = new Date(year, month, day);\n\n      return checkDate.getTime() === selected.getTime();\n  };\n\n  const isToday = (day: number, type: string) => {\n      const today = new Date();\n      // Normalize today\n      today.setHours(0,0,0,0);\n      \n      const year = viewDate.getFullYear();\n      const month = viewDate.getMonth();\n      let checkDate: Date;\n      \n      if (type === 'prev') checkDate = new Date(year, month - 1, day);\n      else if (type === 'next') checkDate = new Date(year, month + 1, day);\n      else checkDate = new Date(year, month, day);\n\n      return checkDate.getTime() === today.getTime();\n  };\n\n  return (\n    <div className=\"relative\" ref={containerRef}>\n      <label className=\"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide\">{label}</label>\n      <button\n        type=\"button\"\n        onClick={() => setIsOpen(!isOpen)}\n        className={`w-full flex items-center justify-between rounded-xl bg-graphite-50 dark:bg-graphite-800 border p-3 text-sm transition-all\n          ${isOpen ? 'border-pacific-500 ring-2 ring-pacific-500/20' : 'border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/50'}\n          ${value ? 'text-graphite-900 dark:text-white' : 'text-graphite-400'}\n        `}\n      >\n        <span className=\"font-medium\">{formatDate(value)}</span>\n        <Calendar size={16} className=\"text-pacific-500\" />\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute top-full left-0 mt-2 w-full min-w-[300px] bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-700 rounded-xl shadow-2xl z-50 p-4 animate-in fade-in zoom-in-95 duration-200\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-4\">\n            <button type=\"button\" onClick={() => changeMonth(-1)} className=\"p-1 hover:bg-graphite-100 dark:hover:bg-graphite-800 rounded-lg text-graphite-500 dark:text-graphite-400 transition-colors\">\n              <ChevronLeft size={20} />\n            </button>\n            <span className=\"text-sm font-bold text-graphite-900 dark:text-white\">\n              {monthNames[viewDate.getMonth()]} {viewDate.getFullYear()}\n            </span>\n            <button type=\"button\" onClick={() => changeMonth(1)} className=\"p-1 hover:bg-graphite-100 dark:hover:bg-graphite-800 rounded-lg text-graphite-500 dark:text-graphite-400 transition-colors\">\n              <ChevronRight size={20} />\n            </button>\n          </div>\n\n          {/* Weekdays */}\n          <div className=\"grid grid-cols-7 gap-1 mb-2\">\n            {['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(d => (\n              <div key={d} className=\"text-center text-[10px] font-bold text-graphite-400 uppercase\">\n                {d}\n              </div>\n            ))}\n          </div>\n\n          {/* Days Grid */}\n          <div className=\"grid grid-cols-7 gap-1\">\n            {grid.map((cell, i) => (\n              <button\n                key={i}\n                type=\"button\"\n                onClick={() => handleDayClick(cell.day, cell.type)}\n                className={`\n                  aspect-square flex items-center justify-center rounded-lg text-sm font-medium transition-all\n                  ${isSelected(cell.day, cell.type) \n                    ? 'bg-pacific-500 text-white shadow-lg shadow-pacific-500/30' \n                    : isToday(cell.day, cell.type)\n                        ? 'text-pacific-500 font-bold bg-pacific-50 dark:bg-pacific-900/10 hover:bg-pacific-100 dark:hover:bg-pacific-900/30'\n                        : cell.type === 'current'\n                            ? 'text-graphite-700 dark:text-graphite-300 hover:bg-graphite-100 dark:hover:bg-graphite-800'\n                            : 'text-graphite-400/30 dark:text-graphite-600/30 hover:bg-graphite-50 dark:hover:bg-graphite-800/50'\n                  }\n                `}\n              >\n                {cell.day}\n              </button>\n            ))}\n          </div>\n\n          {/* Footer Actions */}\n          <div className=\"mt-3 pt-3 border-t border-graphite-100 dark:border-graphite-800 flex items-center justify-between px-1\">\n             <button\n               type=\"button\"\n               onClick={handleClear}\n               className=\"flex items-center gap-1.5 text-xs font-bold text-graphite-400 hover:text-red-500 transition-colors\"\n             >\n               <X size={14} /> Clear\n             </button>\n             <button\n               type=\"button\"\n               onClick={handleToday}\n               className=\"flex items-center gap-1.5 text-xs font-bold text-pacific-600 dark:text-pacific-400 hover:text-pacific-500 transition-colors\"\n             >\n               <Clock size={14} /> Today\n             </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":["CustomDatePicker","label","value","onChange","isOpen","setIsOpen","viewDate","setViewDate","parts","split","map","Number","length","isNaN","Date","containerRef","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","date","getTime","getMonth","getFullYear","formatDate","dateStr","toLocaleDateString","month","day","year","changeMonth","offset","newDate","setMonth","handleDayClick","type","targetDate","y","m","String","padStart","d","getDate","handleToday","today","handleClear","generateGrid","firstDayOfMonth","getDay","daysInMonth","daysInPrevMonth","days","i","push","remaining","grid","monthNames","isSelected","selected","checkDate","isToday","setHours","className","ref","onClick","size","cell"],"mappings":"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"}},
    {"offset": {"line": 3236, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/NewVersionModal.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Layers, Calendar } from 'lucide-react';\r\n\r\nimport { supabaseService } from '@/lib/supabaseService';\r\nimport { CustomDatePicker } from './CustomDatePicker';\r\n\r\ninterface NewVersionModalProps {\r\n  onClose: () => void;\r\n  onCreate: (data: { title: string; description: string; number: number; startDate: string }) => void;\r\n  suggestedNumber: number;\r\n}\r\n\r\nexport const NewVersionModal: React.FC<NewVersionModalProps> = ({ onClose, onCreate, suggestedNumber }) => {\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [number, setNumber] = useState(suggestedNumber);\r\n  const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0]);\r\n  const [versionDays, setVersionDays] = useState(90); // Default, will fetch\r\n  const [calculatedEndDate, setCalculatedEndDate] = useState('');\r\n\r\n  useEffect(() => {\r\n    // Fetch system settings\r\n    supabaseService.getSystemSettings().then(settings => {\r\n      setVersionDays(settings.days);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Auto-calculate end date\r\n    if (!startDate) {\r\n      setCalculatedEndDate('-');\r\n      return;\r\n    }\r\n    const start = new Date(startDate);\r\n    if (isNaN(start.getTime())) {\r\n      setCalculatedEndDate('-');\r\n      return;\r\n    }\r\n    const end = new Date(start);\r\n    end.setDate(start.getDate() + versionDays);\r\n    setCalculatedEndDate(end.toLocaleDateString(undefined, { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }));\r\n  }, [startDate, versionDays]);\r\n\r\n  const handleSubmit = () => {\r\n    onCreate({ title, description, number, startDate });\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\r\n      <div className=\"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 p-8 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800\" onClick={(e) => e.stopPropagation()}>\r\n        <h2 className=\"mb-6 text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n          <div className=\"p-2 bg-pacific-100 text-pacific-600 rounded-lg\"><Layers size={20} /></div>\r\n          Initialize New Version\r\n        </h2>\r\n        <div className=\"space-y-5\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide\">Version ID</label>\r\n              <input type=\"number\" value={number} onChange={(e) => setNumber(Number(e.target.value))} className=\"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all\" />\r\n            </div>\r\n            <div>\r\n              <CustomDatePicker\r\n                label=\"Start Date\"\r\n                value={startDate}\r\n                onChange={setStartDate}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Read-only calculation feedback */}\r\n          <div className=\"p-3 bg-graphite-50 dark:bg-graphite-800/50 rounded-xl border border-graphite-200 dark:border-graphite-700 flex items-center gap-3\">\r\n            <Calendar size={16} className=\"text-pacific-500\" />\r\n            <div className=\"text-xs\">\r\n              <span className=\"text-graphite-500 uppercase font-bold tracking-wider\">Projected End: </span>\r\n              <span className=\"text-graphite-900 dark:text-white font-mono\">{calculatedEndDate}</span>\r\n              <span className=\"block text-[10px] text-graphite-400 mt-0.5\">Based on system tempo of {versionDays} days.</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide\">Identity Title</label>\r\n            <input type=\"text\" value={title} onChange={(e) => setTitle(e.target.value)} placeholder=\"e.g., The Architect\" className=\"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all\" />\r\n          </div>\r\n          <div>\r\n            <label className=\"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide\">Persona Definition</label>\r\n            <textarea value={description} onChange={(e) => setDescription(e.target.value)} placeholder=\"Define the archetype...\" rows={3} className=\"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all resize-none\" />\r\n          </div>\r\n          <div className=\"flex justify-end gap-3 pt-6\">\r\n            <button onClick={onClose} type=\"button\" className=\"rounded-xl px-4 py-2 text-sm font-medium text-graphite-500 hover:text-graphite-800 dark:hover:text-graphite-200 transition-colors\">Cancel</button>\r\n            <button onClick={handleSubmit} type=\"button\" className=\"rounded-xl bg-pacific-600 px-6 py-2.5 text-sm font-bold text-white hover:bg-pacific-500 transition-colors shadow-lg shadow-pacific-500/30\">Initialize Version</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"],"names":["NewVersionModal","onClose","onCreate","suggestedNumber","title","setTitle","description","setDescription","number","setNumber","startDate","setStartDate","Date","toISOString","split","versionDays","setVersionDays","calculatedEndDate","setCalculatedEndDate","getSystemSettings","then","settings","days","start","isNaN","getTime","end","setDate","getDate","toLocaleDateString","undefined","weekday","year","month","day","handleSubmit","className","onClick","e","stopPropagation","size","type","value","onChange","Number","target","label","placeholder","rows"],"mappings":"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"}},
    {"offset": {"line": 3553, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/app/%28portal%29/lab/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { supabaseService } from '@/lib/supabaseService';\r\nimport { Goal, GoalType, Version, Cycle, HabitWeight, Habit, EntityStatus } from '@/types/types';\r\nimport { Target, Zap, Circle, CheckCircle2, Plus, ArrowRight, Brain, AlertTriangle, List, X, Layers, Activity, Fingerprint, ChevronRight, BarChart3, Calendar, ChevronDown, Edit3, Save, Trash2, Check, LayoutList, Link as LinkIcon, ChevronUp, MoreHorizontal, Copy, History, RefreshCw, Search, CornerDownRight, Archive, Eye, EyeOff } from 'lucide-react';\r\nimport { GoalFormModal } from '@/components/GoalFormModal';\r\nimport { CycleEditorModal } from '@/components/CycleEditorModal';\r\nimport { NewVersionModal } from '@/components/NewVersionModal';\r\n\r\n// --- MODAL COMPONENTS ---\r\n\r\ninterface CycleSettingsModalProps {\r\n    cycle: Cycle;\r\n    isActive: boolean;\r\n    onClose: () => void;\r\n    onSave: (cycleId: string, startDate: string, endDate: string, setActive: boolean) => void;\r\n}\r\n\r\nconst CycleSettingsModal: React.FC<CycleSettingsModalProps> = ({ cycle, isActive, onClose, onSave }) => {\r\n    const [startDate, setStartDate] = useState(cycle.start_date);\r\n    const [endDate, setEndDate] = useState(cycle.end_date);\r\n    const [makeActive, setMakeActive] = useState(isActive);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\r\n            <div\r\n                className=\"w-full max-w-md rounded-2xl bg-white dark:bg-graphite-900 p-6 shadow-2xl border border-graphite-200 dark:border-graphite-800 animate-in zoom-in-95 duration-200\"\r\n                onClick={(e: React.MouseEvent) => e.stopPropagation()}\r\n            >\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h2 className=\"text-lg font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                        <Calendar size={18} className=\"text-pacific-500\" /> Cycle Settings\r\n                    </h2>\r\n                    <button onClick={onClose} type=\"button\"><X size={18} className=\"text-graphite-400 hover:text-white\" /></button>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Start Date</label>\r\n                        <input type=\"date\" value={startDate} onChange={e => setStartDate(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500\" />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">End Date</label>\r\n                        <input type=\"date\" value={endDate} onChange={e => setEndDate(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500\" />\r\n                    </div>\r\n\r\n                    <div className=\"pt-2\">\r\n                        <label className={`flex items-center gap-3 p-3 rounded-xl border transition-colors cursor-pointer ${makeActive ? 'bg-pacific-50 dark:bg-pacific-900/10 border-pacific-500/50' : 'bg-graphite-50 dark:bg-graphite-800 border-graphite-200 dark:border-graphite-700 hover:border-graphite-400'}`}>\r\n                            <div className={`h-5 w-5 rounded-full border flex items-center justify-center transition-colors ${makeActive ? 'bg-pacific-500 border-pacific-500' : 'border-graphite-400'}`}>\r\n                                {makeActive && <Check size={12} className=\"text-white\" />}\r\n                            </div>\r\n                            <input type=\"checkbox\" checked={makeActive} onChange={e => !isActive && setMakeActive(e.target.checked)} className=\"hidden\" disabled={isActive} />\r\n                            <div>\r\n                                <div className=\"text-sm font-bold text-graphite-900 dark:text-white\">Active Status</div>\r\n                                <div className=\"text-xs text-graphite-500\">{isActive ? 'Currently the active cycle' : 'Set as current active cycle'}</div>\r\n                            </div>\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-3 pt-6 mt-2 border-t border-graphite-200 dark:border-graphite-800\">\r\n                    <button onClick={onClose} type=\"button\" className=\"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-900 dark:hover:text-white transition-colors\">Cancel</button>\r\n                    <button onClick={() => onSave(cycle.id, startDate, endDate, makeActive)} type=\"button\" className=\"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 hover:bg-pacific-500 transition-colors flex items-center gap-2\">\r\n                        <Save size={14} /> Save Changes\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface HabitSelectorModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSelect: (habit: Habit) => void;\r\n    currentCycleHabits: Habit[];\r\n    allHabits: Habit[];\r\n}\r\n\r\nconst HabitSelectorModal: React.FC<HabitSelectorModalProps> = ({ isOpen, onClose, onSelect, currentCycleHabits, allHabits }) => {\r\n    const [activeTab, setActiveTab] = useState<'current' | 'database'>('current');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    if (!isOpen) return null;\r\n    const uniqueDbHabits = Array.from(new Map(allHabits.map((h: Habit) => [h.name, h])).values());\r\n    const displayHabits = activeTab === 'current' ? currentCycleHabits : uniqueDbHabits;\r\n    const filteredHabits = displayHabits.filter((h: Habit) => h.name.toLowerCase().includes(searchTerm.toLowerCase()));\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\r\n            <div className=\"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col max-h-[80vh]\" onClick={(e) => e.stopPropagation()}>\r\n                <div className=\"p-6 border-b border-graphite-200 dark:border-graphite-800\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h2 className=\"text-lg font-bold text-graphite-900 dark:text-white flex items-center gap-2\"><LinkIcon size={18} className=\"text-pacific-500\" /> Link Habit</h2>\r\n                        <button onClick={onClose} className=\"text-graphite-400 hover:text-graphite-600 dark:hover:text-white\"><X size={18} /></button>\r\n                    </div>\r\n                    <div className=\"flex gap-2 p-1 bg-graphite-100 dark:bg-graphite-800 rounded-lg mb-4\">\r\n                        <button onClick={() => setActiveTab('current')} className={`flex-1 py-1.5 text-xs font-bold uppercase rounded-md transition-all ${activeTab === 'current' ? 'bg-white dark:bg-graphite-700 text-graphite-900 dark:text-white shadow-sm' : 'text-graphite-500'}`}>Current Cycle</button>\r\n                        <button onClick={() => setActiveTab('database')} className={`flex-1 py-1.5 text-xs font-bold uppercase rounded-md transition-all ${activeTab === 'database' ? 'bg-white dark:bg-graphite-700 text-graphite-900 dark:text-white shadow-sm' : 'text-graphite-500'}`}>Database</button>\r\n                    </div>\r\n                    <input value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder=\"Search habits...\" className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white\" />\r\n                </div>\r\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-2\">\r\n                    {filteredHabits.length > 0 ? filteredHabits.map(habit => (\r\n                        <button key={habit.id} onClick={() => onSelect(habit)} className=\"w-full text-left p-4 rounded-xl border border-graphite-200 dark:border-graphite-800 hover:border-pacific-500 dark:hover:border-pacific-500 bg-white dark:bg-graphite-800/50 hover:bg-pacific-50 dark:hover:bg-pacific-900/10 transition-all group\">\r\n                            <div className=\"flex justify-between items-center mb-1\">\r\n                                <span className=\"font-semibold text-graphite-900 dark:text-white group-hover:text-pacific-600 dark:group-hover:text-pacific-400 transition-colors\">{habit.name}</span>\r\n                                {activeTab === 'database' && <span className=\"text-[10px] font-bold uppercase text-graphite-400 bg-graphite-100 dark:bg-graphite-800 px-2 py-0.5 rounded\">Import</span>}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 text-xs text-graphite-500\">\r\n                                <span>{habit.category}</span>\r\n                                <span className=\"text-graphite-300\"></span>\r\n                                <span className={habit.weight === HabitWeight.HIGH ? 'text-pacific-500 font-bold' : ''}>{habit.weight === HabitWeight.HIGH ? 'High Priority' : habit.weight === HabitWeight.MEDIUM ? 'Medium' : 'Low'}</span>\r\n                            </div>\r\n                        </button>\r\n                    )) : (<div className=\"text-center py-8 text-graphite-400 text-sm\">No habits found.</div>)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Lab: React.FC = () => {\r\n    const [data, setData] = useState<{ goals: Goal[]; version: Version | null; cycles: Cycle[]; habits: Habit[]; activeCycleId: string | null } | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showNewVersion, setShowNewVersion] = useState(false);\r\n    const [showNewCycle, setShowNewCycle] = useState(false);\r\n    const [editingCycle, setEditingCycle] = useState<Cycle | null>(null);\r\n    const [cycleInSettings, setCycleInSettings] = useState<Cycle | null>(null);\r\n    const [showAddGoalModal, setShowAddGoalModal] = useState(false);\r\n    const [targetCycleIdForAddGoal, setTargetCycleIdForAddGoal] = useState<string | null>(null);\r\n    const [showHabitSelector, setShowHabitSelector] = useState(false);\r\n    const [selectedGoalIdForLinking, setSelectedGoalIdForLinking] = useState<string | null>(null);\r\n    const [allHabitsHistory, setAllHabitsHistory] = useState<Habit[]>([]);\r\n    const [editingSubtask, setEditingSubtask] = useState<{ goalId: string, index: number } | null>(null);\r\n    const [editSubtaskText, setEditSubtaskText] = useState('');\r\n    const [addingSubtaskGoalId, setAddingSubtaskGoalId] = useState<string | null>(null);\r\n    const [newSubtaskText, setNewSubtaskText] = useState('');\r\n    const [expandedCycleId, setExpandedCycleId] = useState<string | null>(null);\r\n    const [collapsedGoals, setCollapsedGoals] = useState<Set<string>>(new Set());\r\n    const [showArchived, setShowArchived] = useState(false);\r\n    const [verifyDeleteId, setVerifyDeleteId] = useState<string | null>(null);\r\n    const [maxCycles, setMaxCycles] = useState(6);\r\n\r\n    const loadLabData = async () => {\r\n        try {\r\n            const labData = await supabaseService.getLabData();\r\n            setData(labData);\r\n            const history = await supabaseService.getAllHabits();\r\n            setAllHabitsHistory(history);\r\n            const settings = await supabaseService.getSystemSettings();\r\n            setMaxCycles(settings.cycles);\r\n            if (labData.activeCycleId && !expandedCycleId) setExpandedCycleId(labData.activeCycleId);\r\n            setLoading(false);\r\n        } catch (e) {\r\n            console.error(e);\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { loadLabData(); }, []);\r\n\r\n    const handleCreateVersion = async (vData: { title: string; description: string; number: number; startDate: string }) => { await supabaseService.createVersion(vData); setShowNewVersion(false); loadLabData(); };\r\n\r\n    const handleCreateCycle = async (cData: any, gData: any[], hData: any[]) => {\r\n        await supabaseService.createCycle(cData, gData, hData);\r\n        setShowNewCycle(false);\r\n        loadLabData();\r\n    };\r\n\r\n    const handleUpdateCycle = async (updatedCycle: Cycle) => { await supabaseService.updateCycle(updatedCycle); setEditingCycle(null); loadLabData(); };\r\n\r\n    const handleArchiveCycle = async (e: React.MouseEvent, cycleId: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        try {\r\n            if (!data) return;\r\n            const cycle = data.cycles.find((c: Cycle) => c.id === cycleId);\r\n            if (!cycle) return;\r\n\r\n            const currentStatus = cycle.status || EntityStatus.ACTIVE;\r\n            const newStatus = currentStatus === EntityStatus.ARCHIVED ? EntityStatus.ACTIVE : EntityStatus.ARCHIVED;\r\n\r\n            const updatedCycles = data.cycles.map((c: Cycle) => c.id === cycleId ? { ...c, status: newStatus } : c);\r\n            setData({ ...data, cycles: updatedCycles });\r\n\r\n            await supabaseService.updateCycle({ ...cycle, status: newStatus });\r\n            await loadLabData();\r\n        } catch (e) {\r\n            console.error(\"Archive failed\", e);\r\n            loadLabData();\r\n        }\r\n    };\r\n\r\n    const handleDeleteCycle = async (e: React.MouseEvent, cycleId: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (verifyDeleteId !== cycleId) {\r\n            setVerifyDeleteId(cycleId);\r\n            setTimeout(() => setVerifyDeleteId(curr => curr === cycleId ? null : curr), 3000);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setData((currentData: any) => {\r\n                if (!currentData) return null;\r\n                return {\r\n                    ...currentData,\r\n                    cycles: currentData.cycles.filter((c: Cycle) => c.id !== cycleId)\r\n                };\r\n            });\r\n\r\n            if (expandedCycleId === cycleId) setExpandedCycleId(null);\r\n\r\n            await supabaseService.deleteCycle(cycleId);\r\n            await loadLabData();\r\n\r\n            setVerifyDeleteId(null);\r\n        } catch (err) {\r\n            loadLabData();\r\n        }\r\n    };\r\n\r\n    const handleUpdateCycleSettings = async (cycleId: string, startDate: string, endDate: string, setActive: boolean) => {\r\n        if (!data) return;\r\n        const cycleToUpdate = data.cycles.find((c: Cycle) => c.id === cycleId);\r\n        if (cycleToUpdate) {\r\n            const updatedCycle = { ...cycleToUpdate, start_date: startDate, end_date: endDate };\r\n            await supabaseService.updateCycle(updatedCycle);\r\n        }\r\n        if (setActive && data.activeCycleId !== cycleId) { await supabaseService.setCycleActive(cycleId); }\r\n        setCycleInSettings(null);\r\n        loadLabData();\r\n    };\r\n\r\n    const handleAddGoal = async (goalData: { title: string; description: string; type: GoalType; subtasks?: string[] }, linkedHabit: Habit | null) => {\r\n        if (!targetCycleIdForAddGoal) return;\r\n        const newGoalId = `g-${crypto.randomUUID()}`;\r\n        const newGoal: Goal = { id: newGoalId, cycle_id: targetCycleIdForAddGoal, title: goalData.title, description: goalData.description, type: goalData.type, };\r\n        if (goalData.type === GoalType.TASK_PROJECT) {\r\n            const tasks = goalData.subtasks?.map(rawName => {\r\n                const match = rawName.match(/^(\\s*)/); const leadingStr = match ? match[1] : ''; const normalizedIndent = leadingStr.replace(/\\t/g, '  '); const level = Math.floor(normalizedIndent.length / 2);\r\n                return { name: rawName.trim(), done: false, level };\r\n            }) || [];\r\n            newGoal.subtasks = tasks;\r\n        } else if (goalData.type === GoalType.CONSISTENCY_METRIC && linkedHabit) {\r\n            let habitId = linkedHabit.id;\r\n            if (linkedHabit.cycle_id !== targetCycleIdForAddGoal) {\r\n                const newHabitId = `h-${crypto.randomUUID()}`; const newHabit: Habit = { ...linkedHabit, id: newHabitId, cycle_id: targetCycleIdForAddGoal, linked_goal_id: newGoalId };\r\n                await supabaseService.addHabit(newHabit); habitId = newHabitId;\r\n            } else { const updatedHabit = { ...linkedHabit, linked_goal_id: newGoalId }; await supabaseService.updateHabit(updatedHabit); }\r\n            newGoal.linked_habit_id = habitId; newGoal.current_streak = 0;\r\n        }\r\n        await supabaseService.addGoal(newGoal); setShowAddGoalModal(false); loadLabData();\r\n    };\r\n\r\n    const handleDeleteGoal = async (id: string) => { await supabaseService.deleteGoal(id); loadLabData(); };\r\n    const handleOpenHabitSelector = (goalId: string) => { setSelectedGoalIdForLinking(goalId); setShowHabitSelector(true); };\r\n    const handleLinkHabit = async (habit: Habit) => {\r\n        if (!data || !selectedGoalIdForLinking) return;\r\n        const isCurrentCycle = habit.cycle_id === data.activeCycleId;\r\n        let habitIdToLink = habit.id;\r\n        if (!isCurrentCycle && data.activeCycleId) {\r\n            const newHabit: Habit = { id: `h-${crypto.randomUUID()}`, cycle_id: data.activeCycleId, name: habit.name, category: habit.category, weight: habit.weight, linked_goal_id: selectedGoalIdForLinking };\r\n            await supabaseService.addHabit(newHabit); habitIdToLink = newHabit.id;\r\n        } else { const updatedHabit = { ...habit, linked_goal_id: selectedGoalIdForLinking }; await supabaseService.updateHabit(updatedHabit); }\r\n        const goalToUpdate = data.goals.find((g: Goal) => g.id === selectedGoalIdForLinking);\r\n        if (goalToUpdate) { const updatedGoal = { ...goalToUpdate, linked_habit_id: habitIdToLink }; await supabaseService.updateGoal(updatedGoal); }\r\n        setShowHabitSelector(false); setSelectedGoalIdForLinking(null); loadLabData();\r\n    };\r\n\r\n    const handleToggleSubtask = async (goal: Goal, index: number) => { if (!goal.subtasks) return; const updatedSubtasks = [...goal.subtasks]; updatedSubtasks[index].done = !updatedSubtasks[index].done; const updatedGoal = { ...goal, subtasks: updatedSubtasks }; await supabaseService.updateGoal(updatedGoal); loadLabData(); };\r\n    const handleDeleteSubtask = async (goal: Goal, index: number) => { if (!goal.subtasks) return; const updatedSubtasks = goal.subtasks.filter((_, i) => i !== index); const updatedGoal = { ...goal, subtasks: updatedSubtasks }; await supabaseService.updateGoal(updatedGoal); loadLabData(); };\r\n    const handleStartEditSubtask = (goalId: string, index: number, currentName: string) => { setEditingSubtask({ goalId, index }); setEditSubtaskText(currentName); };\r\n    const handleSaveSubtaskEdit = async (goal: Goal, index: number) => { if (!goal.subtasks) return; const updatedSubtasks = [...goal.subtasks]; updatedSubtasks[index].name = editSubtaskText; const updatedGoal = { ...goal, subtasks: updatedSubtasks }; await supabaseService.updateGoal(updatedGoal); setEditingSubtask(null); setEditSubtaskText(''); loadLabData(); };\r\n    const handleAddNewSubtask = async (goal: Goal) => { if (!newSubtaskText.trim()) return; const updatedSubtasks = goal.subtasks ? [...goal.subtasks] : []; updatedSubtasks.push({ name: newSubtaskText, done: false, level: 0 }); const updatedGoal = { ...goal, subtasks: updatedSubtasks }; await supabaseService.updateGoal(updatedGoal); setAddingSubtaskGoalId(null); setNewSubtaskText(''); loadLabData(); };\r\n    const toggleGoalCollapse = (goalId: string) => { const newSet = new Set(collapsedGoals); if (newSet.has(goalId)) newSet.delete(goalId); else newSet.add(goalId); setCollapsedGoals(newSet); };\r\n\r\n    // --- Handlers for CycleEditorModal ---\r\n    const handleManageGoal = async (action: 'create' | 'update' | 'delete', payload: any) => {\r\n        if (!editingCycle) return;\r\n        if (action === 'delete') {\r\n            await handleDeleteGoal(payload.id);\r\n        } else {\r\n            const goalData = {\r\n                title: payload.title,\r\n                description: payload.description,\r\n                type: payload.type,\r\n                subtasks: payload.subtasks\r\n            };\r\n\r\n            if (action === 'create') {\r\n                const newGoalId = `g-${crypto.randomUUID()}`;\r\n                const newGoal: Goal = {\r\n                    id: newGoalId,\r\n                    cycle_id: editingCycle.id,\r\n                    title: goalData.title,\r\n                    description: goalData.description,\r\n                    type: goalData.type\r\n                };\r\n\r\n                if (goalData.type === GoalType.TASK_PROJECT) {\r\n                    const tasks = payload.subtasks?.map((rawName: string) => {\r\n                        const match = rawName.match(/^(\\s*)/);\r\n                        const leadingStr = match ? match[1] : '';\r\n                        const normalizedIndent = leadingStr.replace(/\\t/g, '  ');\r\n                        const level = Math.floor(normalizedIndent.length / 2);\r\n                        return { name: rawName.trim(), done: false, level };\r\n                    }) || [];\r\n                    newGoal.subtasks = tasks;\r\n                } else if (goalData.type === GoalType.CONSISTENCY_METRIC && payload.linkedHabit) {\r\n                    let habitId = payload.linkedHabit.id;\r\n                    if (payload.linkedHabit.cycle_id !== editingCycle.id) {\r\n                        const newHabitId = `h-${crypto.randomUUID()}`;\r\n                        const newHabit: Habit = { ...payload.linkedHabit, id: newHabitId, cycle_id: editingCycle.id, linked_goal_id: newGoalId };\r\n                        await supabaseService.addHabit(newHabit);\r\n                        habitId = newHabitId;\r\n                    } else {\r\n                        const updatedHabit = { ...payload.linkedHabit, linked_goal_id: newGoalId };\r\n                        await supabaseService.updateHabit(updatedHabit);\r\n                    }\r\n                    newGoal.linked_habit_id = habitId;\r\n                    newGoal.current_streak = 0;\r\n                }\r\n                await supabaseService.addGoal(newGoal);\r\n            } else {\r\n                const originalGoal = data?.goals.find((g: Goal) => g.id === payload.id);\r\n                if (!originalGoal) return;\r\n\r\n                let updatedSubtasks = originalGoal.subtasks;\r\n                if (goalData.type === GoalType.TASK_PROJECT && payload.subtasks) {\r\n                    updatedSubtasks = payload.subtasks.map((rawName: string) => {\r\n                        const match = rawName.match(/^(\\s*)/);\r\n                        const leadingStr = match ? match[1] : '';\r\n                        const normalizedIndent = leadingStr.replace(/\\t/g, '  ');\r\n                        const level = Math.floor(normalizedIndent.length / 2);\r\n                        return { name: rawName.trim(), done: false, level };\r\n                    });\r\n                }\r\n\r\n                const updatedGoal: Goal = {\r\n                    ...originalGoal,\r\n                    title: goalData.title,\r\n                    description: goalData.description,\r\n                    type: goalData.type,\r\n                    subtasks: updatedSubtasks,\r\n                    linked_habit_id: payload.linkedHabit?.id\r\n                };\r\n                await supabaseService.updateGoal(updatedGoal);\r\n            }\r\n            await loadLabData();\r\n        }\r\n    };\r\n\r\n    const handleManageHabit = async (action: 'create' | 'update' | 'delete', payload: any) => {\r\n        if (!editingCycle) return;\r\n        if (action === 'delete') {\r\n            await supabaseService.deleteHabit(payload.id);\r\n        } else if (action === 'create') {\r\n            const newHabit: Habit = {\r\n                id: `h-${crypto.randomUUID()}`,\r\n                cycle_id: editingCycle.id,\r\n                name: payload.name,\r\n                category: payload.category,\r\n                weight: payload.weight\r\n            };\r\n            await supabaseService.addHabit(newHabit);\r\n        } else {\r\n            const updatedHabit: Habit = {\r\n                ...data?.habits.find((h: Habit) => h.id === payload.id)!,\r\n                name: payload.name,\r\n                category: payload.category,\r\n                weight: payload.weight\r\n            };\r\n            await supabaseService.updateHabit(updatedHabit);\r\n        }\r\n        await loadLabData();\r\n    };\r\n\r\n    const handleRenameCategory = async (oldName: string, newName: string) => {\r\n        const allHabits = await supabaseService.getAllHabits();\r\n        const toUpdate = allHabits.filter(h => h.category === oldName);\r\n        for (const h of toUpdate) {\r\n            await supabaseService.updateHabit({ ...h, category: newName });\r\n        }\r\n        await loadLabData();\r\n    };\r\n\r\n    const handleDeleteCategory = async (categoryName: string) => {\r\n        const allHabits = await supabaseService.getAllHabits();\r\n        const toUpdate = allHabits.filter(h => h.category === categoryName);\r\n        for (const h of toUpdate) {\r\n            await supabaseService.updateHabit({ ...h, category: 'Uncategorized' });\r\n        }\r\n        await loadLabData();\r\n    };\r\n\r\n    // Define the standardized handler for library deletions\r\n    const handleDeleteHabitFromLibrary = async (habitId: string) => {\r\n        // 1. Perform Deletion\r\n        await supabaseService.deleteHabit(habitId);\r\n\r\n        // 2. Refresh Local Library State immediately\r\n        const history = await supabaseService.getAllHabits();\r\n        setAllHabitsHistory(history);\r\n\r\n        // 3. Refresh Global Lab Data\r\n        await loadLabData();\r\n    };\r\n\r\n    if (loading || !data) return <div className=\"flex h-full items-center justify-center font-medium text-graphite-400\">Loading Lab Environment...</div>;\r\n\r\n    const currentHabits = data.habits.filter(h => h.cycle_id === data.activeCycleId);\r\n\r\n    const hasArchivedCycles = data.cycles.some(c => c.status === EntityStatus.ARCHIVED);\r\n    const visibleCycles = data.cycles.filter(c => showArchived || c.status !== EntityStatus.ARCHIVED);\r\n\r\n    return (\r\n        <div className=\"pb-10\">\r\n            <header className=\"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-8\">\r\n                {data.version ? (\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <span className=\"inline-flex items-center justify-center rounded bg-pacific-500/10 border border-pacific-500/20 px-2 py-0.5 text-[10px] font-bold text-pacific-600 dark:text-pacific-400 uppercase tracking-wider\">Current Version</span>\r\n                            <span className=\"text-pacific-500 font-mono font-bold text-sm\">v{data.version.number}.0</span>\r\n                        </div>\r\n                        <h1 className=\"text-4xl font-display font-bold text-graphite-900 dark:text-white tracking-tight\">{data.version.title}</h1>\r\n                        <p className=\"text-graphite-500 italic mt-1\">\"{data.version.description}\"</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex flex-col items-start gap-4\">\r\n                        <div className=\"flex items-center gap-3 text-graphite-400\">\r\n                            <div className=\"p-2 bg-graphite-100 dark:bg-graphite-800 rounded-lg\">\r\n                                <Layers size={24} />\r\n                            </div>\r\n                            <div>\r\n                                <h1 className=\"text-xl font-bold text-graphite-900 dark:text-white\">System Standby</h1>\r\n                                <p className=\"text-xs font-medium uppercase tracking-wide\">No Active Version</p>\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-sm text-graphite-500 max-w-md\">The system is currently dormant. Initialize the first Version to begin tracking cycles and habits.</p>\r\n                        <button onClick={() => setShowNewVersion(true)} className=\"px-4 py-2 bg-pacific-600 text-white text-sm font-bold rounded-xl hover:bg-pacific-500 transition-colors shadow-lg shadow-pacific-500/20 flex items-center gap-2\">\r\n                            <Plus size={16} /> Initialize Version 1.0\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                {data.version && (\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"text-right mr-4 hidden md:block\"><div className=\"text-[10px] font-bold text-graphite-400 uppercase tracking-widest flex items-center justify-end gap-2\"><Calendar size={12} /> Timeline</div><div className=\"font-mono text-sm text-graphite-600 dark:text-graphite-300\">{data.version.start_date}  {data.version.end_date}</div></div>\r\n                        <button onClick={() => setShowNewVersion(true)} type=\"button\" className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-white dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 text-sm font-bold hover:border-pacific-500 transition-colors\"><Plus size={16} /> New Version</button>\r\n                    </div>\r\n                )}\r\n            </header>\r\n\r\n            <div className=\"space-y-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <h3 className=\"text-xs font-bold text-graphite-400 uppercase tracking-widest flex items-center gap-2\"><Layers size={14} /> Cycles Log</h3>\r\n                        {hasArchivedCycles && (\r\n                            <button\r\n                                onClick={() => setShowArchived(!showArchived)}\r\n                                type=\"button\"\r\n                                className=\"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-graphite-100 dark:bg-graphite-800 text-graphite-500 hover:text-pacific-500 transition-colors flex items-center gap-1\"\r\n                            >\r\n                                {showArchived ? <EyeOff size={12} /> : <Eye size={12} />} {showArchived ? 'Hide Archived' : 'Show Archived'}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                    {data.version && data.cycles.length < maxCycles && (\r\n                        <button onClick={() => setShowNewCycle(true)} type=\"button\" className=\"text-pacific-600 hover:text-pacific-500 p-2 rounded-lg bg-pacific-50 dark:bg-pacific-900/10\"><Plus size={20} /></button>\r\n                    )}\r\n                </div>\r\n\r\n                {visibleCycles.map((cycle: Cycle) => {\r\n                    const isSystemActive = cycle.id === data.activeCycleId;\r\n                    const isArchived = cycle.status === EntityStatus.ARCHIVED;\r\n                    const cycleGoals = data.goals.filter((g: Goal) => g.cycle_id === cycle.id);\r\n                    const isExpanded = expandedCycleId === cycle.id;\r\n                    const cardBaseClass = \"bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-[#262629] transition-all duration-300\";\r\n                    const textBaseClass = \"text-graphite-900 dark:text-white\";\r\n                    const subtextBaseClass = \"text-graphite-400 dark:text-graphite-500\";\r\n\r\n                    return (\r\n                        <div key={cycle.id} className={`rounded-3xl border transition-all duration-300 overflow-hidden ${cardBaseClass} ${isArchived ? 'opacity-70 grayscale border-dashed' : (!isSystemActive && !isExpanded ? 'opacity-60 hover:opacity-100' : 'opacity-100')}`}>\r\n                            <div\r\n                                onClick={(e) => {\r\n                                    if ((e.target as HTMLElement).closest('button')) return;\r\n                                    setExpandedCycleId(isExpanded ? null : cycle.id);\r\n                                }}\r\n                                className={`group/header p-6 border-b flex items-center justify-between cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition-colors ${isSystemActive ? 'border-graphite-200 dark:border-graphite-800' : 'border-graphite-100 dark:border-graphite-800'}`}\r\n                            >\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    {isExpanded ? <ChevronDown className=\"text-pacific-500\" /> : <ChevronRight className=\"text-graphite-400\" />}\r\n                                    <h2 className={`text-xl font-bold ${textBaseClass} ${isArchived ? 'line-through decoration-graphite-400' : ''}`}>Cycle {cycle.sprint_number}</h2>\r\n\r\n                                    <div className=\"flex items-center gap-4 relative z-10\" onClick={(e: React.MouseEvent) => e.stopPropagation()}>\r\n                                        {isSystemActive ? (<button onClick={() => setCycleInSettings(cycle)} type=\"button\" className=\"px-3 py-1 rounded-lg bg-pacific-500/10 text-pacific-600 dark:text-pacific-400 border border-pacific-500/20 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 hover:bg-pacific-500/20 transition-colors\">Active <Calendar size={12} className=\"pointer-events-none\" /></button>) : isArchived ? (<span className=\"px-3 py-1 rounded-lg bg-graphite-100 dark:bg-graphite-800 text-graphite-500 border border-graphite-200 dark:border-graphite-700 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1\"><Archive size={10} /> Archived</span>) : (<button onClick={() => setCycleInSettings(cycle)} type=\"button\" className=\"px-3 py-1 rounded-lg bg-transparent text-graphite-400 border border-graphite-200 dark:border-graphite-700 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 hover:bg-graphite-100 dark:hover:bg-graphite-800 hover:text-graphite-600 dark:hover:text-graphite-300 transition-colors\">Configure <Calendar size={12} className=\"pointer-events-none\" /></button>)}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center justify-end\"><div className={`font-mono text-sm ${subtextBaseClass} transition-all duration-300`}>{cycle.start_date}  {cycle.end_date}</div></div>\r\n                            </div>\r\n\r\n                            {isExpanded && (\r\n                                <div className=\"p-8 grid grid-cols-1 lg:grid-cols-2 gap-12 animate-in slide-in-from-top-4 duration-300\">\r\n                                    <div className=\"space-y-8\">\r\n                                        <div><h4 className={`text-xs font-bold uppercase tracking-widest mb-4 flex items-center gap-2 ${isSystemActive ? 'text-graphite-500' : 'text-graphite-500 dark:text-graphite-400'}`}><Target size={14} /> Priorities</h4><div className=\"space-y-3\">{cycle.focus_priorities.map((p: string, i: number) => (<div key={i} className={`flex items-center gap-4 p-3 rounded-xl border ${isSystemActive ? 'bg-white/5 border-white/10' : 'bg-graphite-50 dark:bg-graphite-800 border-graphite-200 dark:border-graphite-700'}`}><span className=\"text-pacific-500 font-mono text-xs font-bold\">0{i + 1}.</span><span className={`font-medium ${textBaseClass}`}>{p}</span></div>))}</div></div>\r\n                                        <div><h4 className={`text-xs font-bold uppercase tracking-widest mb-4 flex items-center gap-2 ${isSystemActive ? 'text-graphite-500' : 'text-graphite-500 dark:text-graphite-400'}`}><Activity size={14} /> Identity Kernel</h4><div className=\"grid grid-cols-2 gap-4\">{cycle.cch_list.map((c: { category: string; items: string[] }, i: number) => (<div key={i}><div className={`text-[10px] font-bold mb-2 uppercase ${isSystemActive ? 'text-graphite-500' : 'text-graphite-600 dark:text-graphite-400'}`}>{c.category}</div><div className=\"flex flex-wrap gap-2\">{c.items.map((item: string, j: number) => (<span key={j} className={`text-xs border px-2 py-1 rounded-md ${isSystemActive ? 'text-graphite-400 border-graphite-700' : 'text-graphite-400 dark:text-graphite-500 border-graphite-200 dark:border-graphite-700'}`}>{item}</span>))}</div></div>))}</div></div>\r\n                                        <div className={`p-6 rounded-2xl border ${isSystemActive ? 'bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900/30' : 'bg-white dark:bg-graphite-800/50 border-red-100 dark:border-red-900/30 shadow-sm'}`}><h4 className=\"text-[10px] font-bold text-red-500 dark:text-red-400 uppercase tracking-widest mb-3 flex items-center gap-2\"><AlertTriangle size={12} /> Friction</h4><p className={`text-sm italic ${isSystemActive ? 'text-graphite-700 dark:text-red-100/80' : 'text-graphite-600 dark:text-graphite-400'}`}>\"{cycle.problems}\"</p></div>\r\n\r\n                                        <div className=\"pt-6 border-t border-graphite-200 dark:border-graphite-800 flex flex-wrap items-center gap-3 relative z-10\" onClick={(e: React.MouseEvent) => e.stopPropagation()}>\r\n                                            <button onClick={() => setEditingCycle(cycle)} type=\"button\" className=\"flex items-center gap-2 px-4 py-2 bg-graphite-100 dark:bg-graphite-800 text-graphite-600 dark:text-graphite-300 rounded-xl text-sm font-bold hover:bg-graphite-200 dark:hover:bg-graphite-700 transition-colors\"><Edit3 size={16} className=\"pointer-events-none\" /> Edit Content</button>\r\n                                            <button\r\n                                                onClick={(e) => handleArchiveCycle(e, cycle.id)}\r\n                                                type=\"button\"\r\n                                                className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all border ${isArchived ? 'bg-bali-50 dark:bg-bali-900/20 text-bali-600 dark:text-bali-400 border-bali-200 dark:border-bali-800' : 'bg-graphite-50 dark:bg-graphite-900/50 text-graphite-500 hover:text-pacific-600 dark:hover:text-pacific-400 border-transparent hover:border-pacific-200 dark:hover:border-pacific-800'}`}\r\n                                            >\r\n                                                {isArchived ? <><RefreshCw size={16} className=\"pointer-events-none\" /> Restore</> : <><Archive size={16} className=\"pointer-events-none\" /> Archive</>}\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={(e) => handleDeleteCycle(e, cycle.id)}\r\n                                                type=\"button\"\r\n                                                className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-200 ${verifyDeleteId === cycle.id\r\n                                                    ? 'bg-red-500 text-white border-red-500 shadow-lg shadow-red-500/30 scale-105'\r\n                                                    : 'bg-graphite-50 dark:bg-graphite-900/50 text-graphite-400 hover:text-red-500 border border-transparent hover:border-red-200 dark:hover:border-red-900/30'\r\n                                                    }`}\r\n                                            >\r\n                                                <Trash2 size={16} className=\"pointer-events-none\" />\r\n                                                {verifyDeleteId === cycle.id ? 'Confirm Delete?' : 'Delete'}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <div className=\"flex justify-between items-center mb-4\"><h4 className={`text-xs font-bold uppercase tracking-widest flex items-center gap-2 ${isSystemActive ? 'text-graphite-500' : 'text-graphite-500 dark:text-graphite-400'}`}><CheckCircle2 size={14} /> Goals & Objectives</h4><button onClick={() => { setTargetCycleIdForAddGoal(cycle.id); setShowAddGoalModal(true); }} type=\"button\" className=\"text-[10px] font-bold text-pacific-400 hover:text-white flex items-center gap-1\">+ ADD GOAL</button></div>\r\n                                        <div className=\"space-y-4\">\r\n                                            {cycleGoals.map((goal: Goal) => {\r\n                                                const linkedHabit = currentHabits.find((h: Habit) => h.id === goal.linked_habit_id);\r\n                                                const isProject = goal.type === GoalType.TASK_PROJECT;\r\n                                                const isCollapsed = collapsedGoals.has(goal.id);\r\n                                                const goalCardClass = isSystemActive ? \"bg-graphite-50 dark:bg-graphite-800/50 border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/30\" : \"bg-graphite-50 dark:bg-graphite-800/50 border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/30\";\r\n                                                let progressPercent = 0; let showProgressBar = false;\r\n                                                if (goal.type === GoalType.TASK_PROJECT) { const totalTasks = goal.subtasks?.length || 0; const completedTasks = goal.subtasks?.filter(t => t.done).length || 0; if (totalTasks > 0) { progressPercent = (completedTasks / totalTasks) * 100; showProgressBar = true; } }\r\n                                                else if (goal.type === GoalType.CONSISTENCY_METRIC) { const streak = goal.current_streak || 0; progressPercent = Math.min(100, 100 * (1 - Math.exp(-0.061 * streak))); showProgressBar = true; }\r\n\r\n                                                return (\r\n                                                    <div key={goal.id} onClick={isProject ? () => toggleGoalCollapse(goal.id) : undefined} className={`group relative p-5 rounded-2xl border transition-all overflow-hidden ${goalCardClass} ${isProject ? 'cursor-pointer' : ''}`}>\r\n                                                        {showProgressBar && (<div className=\"absolute top-0 left-0 right-0 h-1.5 bg-graphite-200 dark:bg-black/20\"><div className={`h-full transition-all duration-500 ${progressPercent >= 100 ? 'bg-bali-500' : 'bg-pacific-500'}`} style={{ width: `${progressPercent}%` }} /></div>)}\r\n                                                        <div className=\"flex justify-between items-start mb-3\"><div><h3 className={`font-bold text-lg ${textBaseClass}`}>{goal.title}</h3><p className={`text-sm leading-relaxed mt-1 ${subtextBaseClass}`}>{goal.description}</p></div><div className=\"flex items-center gap-3\">{isProject && (<div className=\"text-graphite-400 group-hover:text-pacific-500 transition-colors\">{isCollapsed ? <ChevronDown size={16} /> : <ChevronUp size={16} />}</div>)}<div className=\"text-xs font-bold text-graphite-500 uppercase tracking-wider\">{goal.type === GoalType.CONSISTENCY_METRIC ? 'Consistency' : 'Project'}</div></div></div>\r\n                                                        {goal.type === GoalType.CONSISTENCY_METRIC && (<div className=\"mt-4 pl-1\" onClick={e => e.stopPropagation()}><button onClick={() => handleOpenHabitSelector(goal.id)} type=\"button\" className={`flex items-center gap-3 px-3 py-2 rounded-lg border transition-all group/habit w-full sm:w-auto ${isSystemActive ? 'bg-white dark:bg-graphite-900 border-graphite-200 dark:border-graphite-700' : 'bg-white dark:bg-graphite-900 border-graphite-200 dark:border-graphite-700'}`}><div className={`p-1.5 rounded-md ${isSystemActive ? 'bg-pacific-50 dark:bg-pacific-900/20 text-pacific-600 dark:text-pacific-400' : 'bg-pacific-50 dark:bg-pacific-900/20 text-pacific-600 dark:text-pacific-400'}`}><Activity size={14} /></div><div className=\"flex flex-col items-start\"><span className=\"text-[10px] font-bold text-graphite-400 uppercase tracking-wider\">Linked Habit</span>{linkedHabit ? (<span className={`text-xs font-bold ${textBaseClass}`}>{linkedHabit.name}</span>) : (<span className=\"text-xs font-bold text-red-400\">Select Habit Source</span>)}</div>{linkedHabit ? (<LinkIcon size={12} className=\"ml-2 text-graphite-400 group-hover/habit:text-pacific-500 transition-colors opacity-0 group-hover/habit:opacity-100\" />) : (<AlertTriangle size={12} className=\"ml-2 text-red-400\" />)}</button></div>)}\r\n                                                        {goal.type === GoalType.TASK_PROJECT && !isCollapsed && (<div className=\"mt-4 pl-1 animate-in slide-in-from-top-1 fade-in duration-200\" onClick={(e: React.MouseEvent) => e.stopPropagation()}><div className=\"space-y-2 mb-3\">{goal.subtasks?.map((t: { name: string; done: boolean; level?: number }, i: number) => (<div key={i} className={`flex items-center gap-3 text-sm group/task min-h-[28px] ${subtextBaseClass}`} style={{ paddingLeft: `${(t.level || 0) * 1.5}rem` }}>{(t.level || 0) > 0 && <CornerDownRight size={12} className=\"text-graphite-500 dark:text-graphite-600 flex-shrink-0\" />}{editingSubtask?.goalId === goal.id && editingSubtask.index === i ? (<div className=\"flex-1 flex items-center gap-2\"><input value={editSubtaskText} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setEditSubtaskText(e.target.value)} className=\"flex-1 bg-graphite-900 dark:bg-white border border-pacific-500 rounded px-2 py-1 text-white dark:text-graphite-900 text-sm focus:outline-none\" autoFocus onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => { if (e.key === 'Enter') handleSaveSubtaskEdit(goal, i); if (e.key === 'Escape') setEditingSubtask(null); }} /><button onClick={() => handleSaveSubtaskEdit(goal, i)} className=\"text-pacific-500 hover:text-white\"><Check size={16} /></button><button onClick={() => setEditingSubtask(null)} className=\"text-red-500 hover:text-white\"><X size={16} /></button></div>) : (<><button onClick={() => handleToggleSubtask(goal, i)} type=\"button\" className={`h-4 w-4 flex-shrink-0 rounded border flex items-center justify-center transition-all ${t.done ? 'bg-pacific-500 border-pacific-500 text-white' : 'border-graphite-600 dark:border-graphite-400 hover:border-pacific-500'}`}>{t.done && <Check size={10} />}</button><span className={`flex-1 transition-all ${t.done ? 'line-through opacity-50' : ''}`} onDoubleClick={() => handleStartEditSubtask(goal.id, i, t.name)}>{t.name}</span><div className=\"opacity-0 group-hover/task:opacity-100 flex items-center gap-2 transition-opacity\"><button onClick={() => handleStartEditSubtask(goal.id, i, t.name)} className=\"text-graphite-500 hover:text-pacific-400\"><Edit3 size={12} /></button><button onClick={() => handleDeleteSubtask(goal, i)} className=\"text-graphite-500 hover:text-red-500\"><Trash2 size={12} /></button></div></>)}</div>))}</div>{addingSubtaskGoalId === goal.id ? (<div className=\"flex items-center gap-2 animate-in fade-in slide-in-from-top-1\"><input value={newSubtaskText} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewSubtaskText(e.target.value)} className=\"flex-1 bg-graphite-900 dark:bg-white border border-graphite-600 dark:border-graphite-300 rounded px-2 py-1 text-white dark:text-graphite-900 text-sm focus:outline-none focus:border-pacific-500\" placeholder=\"New item...\" autoFocus onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => { if (e.key === 'Enter') handleAddNewSubtask(goal); if (e.key === 'Escape') { setAddingSubtaskGoalId(null); setNewSubtaskText(''); } }} /><button onClick={() => handleAddNewSubtask(goal)} className=\"p-1 bg-pacific-600 text-white rounded hover:bg-pacific-500\"><Plus size={14} /></button><button onClick={() => { setAddingSubtaskGoalId(null); setNewSubtaskText(''); }} className=\"p-1 text-graphite-500 hover:text-white\"><X size={14} /></button></div>) : (<button onClick={() => setAddingSubtaskGoalId(goal.id)} className=\"text-[10px] font-bold text-graphite-500 hover:text-pacific-400 flex items-center gap-1 transition-colors mt-2\"><Plus size={12} /> ADD ITEM</button>)}</div>)}\r\n                                                        <button onClick={(e) => { e.stopPropagation(); handleDeleteGoal(goal.id); }} className=\"absolute bottom-4 right-4 text-graphite-600 dark:text-graphite-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-2\"><Trash2 size={16} /></button>\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    );\r\n                })}\r\n                {!data.version && visibleCycles.length === 0 && (\r\n                    <div className=\"text-center py-12 text-graphite-400 text-sm\">System Empty. Initialize a version to proceed.</div>\r\n                )}\r\n                {data.version && !hasArchivedCycles && visibleCycles.length === 0 && (\r\n                    <div className=\"text-center py-12 text-graphite-400 text-sm\">No cycles found. Start by creating a new version or cycle.</div>\r\n                )}\r\n                {hasArchivedCycles && visibleCycles.length === 0 && (\r\n                    <div className=\"text-center py-12 text-graphite-400 text-sm\">All cycles are archived. Click \"Show Archived\" to view them.</div>\r\n                )}\r\n            </div>\r\n\r\n            {showNewVersion && <NewVersionModal onClose={() => setShowNewVersion(false)} onCreate={handleCreateVersion} suggestedNumber={(data.version?.number || 0) + 1} />}\r\n\r\n            {/* CREATING New Cycle */}\r\n            {showNewCycle && (\r\n                <CycleEditorModal\r\n                    mode=\"create\"\r\n                    goals={[]}\r\n                    habits={[]}\r\n                    allHabits={allHabitsHistory}\r\n                    suggestedSprintNumber={data.cycles.length + 1}\r\n                    onClose={() => setShowNewCycle(false)}\r\n                    onCreate={handleCreateCycle}\r\n                    onDeleteHabitFromDB={handleDeleteHabitFromLibrary}\r\n                    maxCycles={maxCycles}\r\n                    // PASSING SMART SCHEDULING CONTEXT\r\n                    versionStartDate={data.version?.start_date}\r\n                    existingCycles={data.cycles}\r\n                />\r\n            )}\r\n\r\n            {/* EDITING Existing Cycle */}\r\n            {editingCycle && (\r\n                <CycleEditorModal\r\n                    mode=\"edit\"\r\n                    cycle={editingCycle}\r\n                    goals={data.goals.filter(g => g.cycle_id === editingCycle.id)}\r\n                    habits={data.habits.filter(h => h.cycle_id === editingCycle.id)}\r\n                    allHabits={allHabitsHistory}\r\n                    onClose={() => setEditingCycle(null)}\r\n                    onSaveCycle={handleUpdateCycle}\r\n                    onManageGoal={handleManageGoal}\r\n                    onManageHabit={handleManageHabit}\r\n                    onRenameCategory={async (oldName: string, newName: string) => {\r\n                        const all = await supabaseService.getAllHabits();\r\n                        const targets = all.filter((h: Habit) => h.category === oldName);\r\n                        for (const h of targets) await supabaseService.updateHabit({ ...h, category: newName });\r\n                        await loadLabData();\r\n                    }}\r\n                    onDeleteCategory={async (catName: string) => {\r\n                        const all = await supabaseService.getAllHabits();\r\n                        const targets = all.filter((h: Habit) => h.category === catName);\r\n                        for (const h of targets) await supabaseService.updateHabit({ ...h, category: 'Uncategorized' });\r\n                        await loadLabData();\r\n                    }}\r\n                    onDeleteHabitFromDB={handleDeleteHabitFromLibrary}\r\n                    maxCycles={maxCycles}\r\n                />\r\n            )}\r\n\r\n            {cycleInSettings && <CycleSettingsModal cycle={cycleInSettings} isActive={data.activeCycleId === cycleInSettings.id} onClose={() => setCycleInSettings(null)} onSave={handleUpdateCycleSettings} />}\r\n            {showAddGoalModal && <GoalFormModal isOpen={showAddGoalModal} onClose={() => setShowAddGoalModal(false)} onSave={handleAddGoal} currentCycleHabits={data.habits.filter(h => h.cycle_id === targetCycleIdForAddGoal)} allHabits={allHabitsHistory} />}\r\n            <HabitSelectorModal isOpen={showHabitSelector} onClose={() => setShowHabitSelector(false)} onSelect={handleLinkHabit} currentCycleHabits={currentHabits} allHabits={allHabitsHistory} />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Lab;\r\n"],"names":["CycleSettingsModal","cycle","isActive","onClose","onSave","startDate","setStartDate","start_date","endDate","setEndDate","end_date","makeActive","setMakeActive","className","onClick","e","stopPropagation","size","type","value","onChange","target","checked","disabled","id","HabitSelectorModal","isOpen","onSelect","currentCycleHabits","allHabits","activeTab","setActiveTab","searchTerm","setSearchTerm","uniqueDbHabits","Array","from","Map","map","h","name","values","displayHabits","filteredHabits","filter","toLowerCase","includes","placeholder","length","habit","category","weight","HIGH","MEDIUM","Lab","data","setData","loading","setLoading","showNewVersion","setShowNewVersion","showNewCycle","setShowNewCycle","editingCycle","setEditingCycle","cycleInSettings","setCycleInSettings","showAddGoalModal","setShowAddGoalModal","targetCycleIdForAddGoal","setTargetCycleIdForAddGoal","showHabitSelector","setShowHabitSelector","selectedGoalIdForLinking","setSelectedGoalIdForLinking","allHabitsHistory","setAllHabitsHistory","editingSubtask","setEditingSubtask","editSubtaskText","setEditSubtaskText","addingSubtaskGoalId","setAddingSubtaskGoalId","newSubtaskText","setNewSubtaskText","expandedCycleId","setExpandedCycleId","collapsedGoals","setCollapsedGoals","Set","showArchived","setShowArchived","verifyDeleteId","setVerifyDeleteId","maxCycles","setMaxCycles","loadLabData","labData","getLabData","history","getAllHabits","settings","getSystemSettings","cycles","activeCycleId","console","error","handleCreateVersion","vData","createVersion","handleCreateCycle","cData","gData","hData","createCycle","handleUpdateCycle","updatedCycle","updateCycle","handleArchiveCycle","cycleId","preventDefault","find","c","currentStatus","status","ACTIVE","newStatus","ARCHIVED","updatedCycles","handleDeleteCycle","setTimeout","curr","currentData","deleteCycle","err","handleUpdateCycleSettings","setActive","cycleToUpdate","setCycleActive","handleAddGoal","goalData","linkedHabit","newGoalId","crypto","randomUUID","newGoal","cycle_id","title","description","TASK_PROJECT","tasks","subtasks","rawName","match","leadingStr","normalizedIndent","replace","level","Math","floor","trim","done","CONSISTENCY_METRIC","habitId","newHabitId","newHabit","linked_goal_id","addHabit","updatedHabit","updateHabit","linked_habit_id","current_streak","addGoal","handleDeleteGoal","deleteGoal","handleOpenHabitSelector","goalId","handleLinkHabit","isCurrentCycle","habitIdToLink","goalToUpdate","goals","g","updatedGoal","updateGoal","handleToggleSubtask","goal","index","updatedSubtasks","handleDeleteSubtask","_","i","handleStartEditSubtask","currentName","handleSaveSubtaskEdit","handleAddNewSubtask","push","toggleGoalCollapse","newSet","has","delete","add","handleManageGoal","action","payload","originalGoal","handleManageHabit","deleteHabit","habits","handleRenameCategory","oldName","newName","toUpdate","handleDeleteCategory","categoryName","handleDeleteHabitFromLibrary","currentHabits","hasArchivedCycles","some","visibleCycles","version","number","isSystemActive","isArchived","cycleGoals","isExpanded","cardBaseClass","textBaseClass","subtextBaseClass","closest","sprint_number","focus_priorities","p","cch_list","items","item","j","problems","isProject","isCollapsed","goalCardClass","progressPercent","showProgressBar","totalTasks","completedTasks","t","streak","min","exp","undefined","style","width","paddingLeft","autoFocus","onKeyDown","key","onDoubleClick","onCreate","suggestedNumber","mode","suggestedSprintNumber","onDeleteHabitFromDB","versionStartDate","existingCycles","onSaveCycle","onManageGoal","onManageHabit","onRenameCategory","all","targets","onDeleteCategory","catName"],"mappings":"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"}}]
}