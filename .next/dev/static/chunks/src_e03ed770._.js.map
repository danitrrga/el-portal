{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/GoalFormModal.tsx"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\nimport { Goal, GoalType, Habit } from '@/types/types';\nimport { CheckCircle2, X, Link as LinkIcon, Search, Check } from 'lucide-react';\n\ninterface GoalFormModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (\n        goal: { title: string; description: string; type: GoalType; subtasks?: string[] },\n        selectedHabit: Habit | null\n    ) => void;\n    initialGoal?: Goal;\n    currentCycleHabits: Habit[];\n    allHabits: Habit[];\n}\n\nexport const GoalFormModal: React.FC<GoalFormModalProps> = ({\n    isOpen, onClose, onSave, initialGoal, currentCycleHabits, allHabits\n}) => {\n    const [title, setTitle] = useState('');\n    const [description, setDescription] = useState('');\n    const [type, setType] = useState<GoalType>(GoalType.TASK_PROJECT);\n    const [subtasks, setSubtasks] = useState('');\n    const [selectedHabit, setSelectedHabit] = useState<Habit | null>(null);\n    const [habitTab, setHabitTab] = useState<'current' | 'database'>('current');\n    const [habitSearch, setHabitSearch] = useState('');\n\n    useEffect(() => {\n        if (initialGoal) {\n            setTitle(initialGoal.title);\n            setDescription(initialGoal.description);\n            setType(initialGoal.type);\n            // Convert subtasks array to string with indentation preservation\n            if (initialGoal.subtasks) {\n                setSubtasks(initialGoal.subtasks.map(t => {\n                    const indent = \"  \".repeat(t.level || 0);\n                    return `${indent}${t.name}`;\n                }).join('\\n'));\n            } else {\n                setSubtasks('');\n            }\n            // Link habit if ID exists\n            if (initialGoal.linked_habit_id) {\n                const found = allHabits.find(h => h.id === initialGoal.linked_habit_id);\n                if (found) setSelectedHabit(found);\n            }\n        } else {\n            // Reset for Add Mode\n            setTitle('');\n            setDescription('');\n            setType(GoalType.TASK_PROJECT);\n            setSubtasks('');\n            setSelectedHabit(null);\n        }\n    }, [initialGoal, isOpen]);\n\n    if (!isOpen) return null;\n\n    const uniqueDbHabits = Array.from(new Map(allHabits.map(h => [h.name, h])).values());\n    const displayHabits = habitTab === 'current' ? currentCycleHabits : uniqueDbHabits;\n    const filteredHabits = displayHabits.filter(h => h.name.toLowerCase().includes(habitSearch.toLowerCase()));\n\n    const handleSave = () => {\n        if (!title.trim()) return;\n        const subtaskList = type === GoalType.TASK_PROJECT ? subtasks.split('\\n').filter(s => s.trim().length > 0) : undefined;\n        onSave({ title, description, type, subtasks: subtaskList }, selectedHabit);\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        if (e.key === 'Tab') {\n            e.preventDefault();\n            const start = e.currentTarget.selectionStart;\n            const end = e.currentTarget.selectionEnd;\n            const value = e.currentTarget.value;\n            const indent = \"  \";\n            const newValue = value.substring(0, start) + indent + value.substring(end);\n            setSubtasks(newValue);\n            requestAnimationFrame(() => {\n                if (e.currentTarget) {\n                    e.currentTarget.selectionStart = e.currentTarget.selectionEnd = start + indent.length;\n                }\n            });\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\n            <div className=\"w-full max-w-xl rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col max-h-[90vh]\" onClick={(e) => e.stopPropagation()}>\n                <div className=\"p-6 border-b border-graphite-200 dark:border-graphite-800 flex justify-between items-center\">\n                    <h2 className=\"text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\n                        <CheckCircle2 size={20} className=\"text-pacific-500\" />\n                        {initialGoal ? 'Edit Goal' : 'Add New Goal'}\n                    </h2>\n                    <button onClick={onClose} className=\"text-graphite-400 hover:text-white\"><X size={20} /></button>\n                </div>\n                <div className=\"p-6 overflow-y-auto space-y-5\">\n                    <div className=\"space-y-4\">\n                        <div>\n                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Goal Title</label>\n                            <input value={title} onChange={e => setTitle(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white\" placeholder=\"e.g. Launch Marketing Campaign\" autoFocus />\n                        </div>\n                        <div>\n                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Description</label>\n                            <textarea value={description} onChange={e => setDescription(e.target.value)} rows={2} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white resize-none\" placeholder=\"What is the objective?\" />\n                        </div>\n                    </div>\n                    <div>\n                        <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-2\">Goal Type</label>\n                        <div className=\"grid grid-cols-2 gap-2 p-1 bg-graphite-100 dark:bg-graphite-800 rounded-xl\">\n                            <button onClick={() => setType(GoalType.TASK_PROJECT)} className={`py-2 rounded-lg text-sm font-bold transition-all ${type === GoalType.TASK_PROJECT ? 'bg-white dark:bg-graphite-700 text-pacific-600 dark:text-white shadow-sm' : 'text-graphite-500 hover:text-graphite-700 dark:hover:text-graphite-300'}`}>Project (Tasks)</button>\n                            <button onClick={() => setType(GoalType.CONSISTENCY_METRIC)} className={`py-2 rounded-lg text-sm font-bold transition-all ${type === GoalType.CONSISTENCY_METRIC ? 'bg-white dark:bg-graphite-700 text-pacific-600 dark:text-white shadow-sm' : 'text-graphite-500 hover:text-graphite-700 dark:hover:text-graphite-300'}`}>Habit Metric</button>\n                        </div>\n                    </div>\n                    {type === GoalType.TASK_PROJECT ? (\n                        <div className=\"animate-in fade-in slide-in-from-top-2\">\n                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Action Plan (Subtasks)</label>\n                            <textarea value={subtasks} onChange={e => setSubtasks(e.target.value)} onKeyDown={handleKeyDown} rows={6} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm font-mono focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white leading-relaxed\" placeholder=\"- Research competitors&#10;  - Analyze pricing (Indented with Tab)&#10;- Draft copy\" />\n                            <p className=\"text-[10px] text-graphite-400 mt-1 text-right\">Use Tab to indent sub-tasks</p>\n                        </div>\n                    ) : (\n                        <div className=\"animate-in fade-in slide-in-from-top-2 p-4 border border-graphite-200 dark:border-graphite-700 rounded-xl bg-graphite-50 dark:bg-graphite-800/50\">\n                            <label className=\"block text-xs font-bold text-pacific-500 uppercase mb-3 flex items-center gap-2\"><LinkIcon size={14} /> Link Habit Source</label>\n                            <div className=\"flex gap-4 mb-3 border-b border-graphite-200 dark:border-graphite-700\">\n                                <button onClick={() => setHabitTab('current')} className={`pb-2 text-xs font-bold uppercase transition-colors border-b-2 ${habitTab === 'current' ? 'border-pacific-500 text-pacific-600 dark:text-pacific-400' : 'border-transparent text-graphite-400'}`}>Current Cycle</button>\n                                <button onClick={() => setHabitTab('database')} className={`pb-2 text-xs font-bold uppercase transition-colors border-b-2 ${habitTab === 'database' ? 'border-pacific-500 text-pacific-600 dark:text-pacific-400' : 'border-transparent text-graphite-400'}`}>Database Search</button>\n                            </div>\n                            {habitTab === 'database' && (\n                                <div className=\"relative mb-3\">\n                                    <Search size={14} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-graphite-400\" />\n                                    <input value={habitSearch} onChange={e => setHabitSearch(e.target.value)} className=\"w-full bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-700 rounded-lg pl-9 pr-3 py-2 text-sm focus:outline-none focus:border-pacific-500\" placeholder=\"Search habit history...\" />\n                                </div>\n                            )}\n                            <div className=\"max-h-40 overflow-y-auto space-y-1 pr-1\">\n                                {filteredHabits.map(h => (\n                                    <button key={h.id} onClick={() => setSelectedHabit(h)} className={`w-full text-left px-3 py-2 rounded-lg text-sm transition-all flex justify-between items-center ${selectedHabit?.name === h.name ? 'bg-pacific-500 text-white shadow-md' : 'hover:bg-graphite-200 dark:hover:bg-graphite-700 text-graphite-700 dark:text-graphite-300'}`}>\n                                        <span className=\"font-medium truncate\">{h.name}</span>\n                                        {selectedHabit?.name === h.name && <Check size={14} />}\n                                    </button>\n                                ))}\n                                {filteredHabits.length === 0 && <div className=\"text-center py-4 text-xs text-graphite-400 italic\">No habits found.</div>}\n                            </div>\n                            {selectedHabit && (\n                                <div className=\"mt-3 pt-3 border-t border-graphite-200 dark:border-graphite-700 flex items-center justify-between\">\n                                    <span className=\"text-xs text-graphite-500\">Selected: <span className=\"font-bold text-graphite-900 dark:text-white\">{selectedHabit.name}</span></span>\n                                    <button onClick={() => setSelectedHabit(null)} className=\"text-xs text-red-400 hover:text-red-500\">Clear</button>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </div>\n                <div className=\"p-6 border-t border-graphite-200 dark:border-graphite-800 flex justify-end gap-3\">\n                    <button onClick={onClose} className=\"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-800 dark:hover:text-white transition-colors\">Cancel</button>\n                    <button onClick={handleSave} disabled={!title.trim() || (type === GoalType.CONSISTENCY_METRIC && !selectedHabit)} className=\"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-pacific-500 transition-colors\">\n                        {initialGoal ? 'Save Changes' : 'Create Goal'}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":["GoalFormModal","isOpen","onClose","onSave","initialGoal","currentCycleHabits","allHabits","title","setTitle","description","setDescription","type","setType","TASK_PROJECT","subtasks","setSubtasks","selectedHabit","setSelectedHabit","habitTab","setHabitTab","habitSearch","setHabitSearch","map","t","indent","repeat","level","name","join","linked_habit_id","found","find","h","id","uniqueDbHabits","Array","from","Map","values","displayHabits","filteredHabits","filter","toLowerCase","includes","handleSave","trim","subtaskList","split","s","length","undefined","handleKeyDown","e","key","preventDefault","start","currentTarget","selectionStart","end","selectionEnd","value","newValue","substring","requestAnimationFrame","className","onClick","stopPropagation","size","onChange","target","placeholder","autoFocus","rows","CONSISTENCY_METRIC","onKeyDown","disabled"],"mappings":"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"}},
    {"offset": {"line": 509, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/HabitFormModal.tsx"],"sourcesContent":["\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { Habit, HabitWeight } from '@/types/types';\nimport { CheckCircle2, X, Save, Library, Plus, Search, Tag, Trash2, ArrowRight, Settings, Edit2, ArrowLeft, AlertCircle, Check } from 'lucide-react';\n\ninterface HabitFormModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (habitData: { name: string; category: string; weight: HabitWeight }) => void;\n    initialHabit?: Habit;\n    allHabits?: Habit[];\n    onDeleteFromLibrary?: (habitId: string) => void;\n    onRenameCategory?: (oldName: string, newName: string) => Promise<void>;\n    onDeleteCategory?: (categoryName: string) => Promise<void>;\n}\n\nexport const HabitFormModal: React.FC<HabitFormModalProps> = ({\n    isOpen, onClose, onSave, initialHabit, allHabits = [], onDeleteFromLibrary, onRenameCategory, onDeleteCategory\n}) => {\n    const [activeTab, setActiveTab] = useState<'create' | 'library'>('create');\n    const [isManagingCats, setIsManagingCats] = useState(false);\n\n    // Form State\n    const [name, setName] = useState('');\n    const [category, setCategory] = useState('');\n    const [weight, setWeight] = useState<HabitWeight>(HabitWeight.MEDIUM);\n\n    // Library State\n    const [librarySearch, setLibrarySearch] = useState('');\n    const [verifyDeleteId, setVerifyDeleteId] = useState<string | null>(null);\n\n    // Category Manager State\n    const [editingCatName, setEditingCatName] = useState<string | null>(null);\n    const [tempCatName, setTempCatName] = useState('');\n    const [verifyDeleteCat, setVerifyDeleteCat] = useState<string | null>(null);\n\n    useEffect(() => {\n        if (initialHabit) {\n            setName(initialHabit.name);\n            setCategory(initialHabit.category);\n            setWeight(initialHabit.weight);\n            setActiveTab('create');\n        } else {\n            // Reset only if opening for new habit\n            if (isOpen && !initialHabit && activeTab === 'create' && name === '') {\n                setName('');\n                setCategory('');\n                setWeight(HabitWeight.MEDIUM);\n            }\n        }\n        setIsManagingCats(false);\n    }, [initialHabit, isOpen]);\n\n    // Smart Category Derivation\n    const uniqueCategories = useMemo(() => {\n        const cats = new Set(allHabits.map(h => h.category).filter(Boolean));\n        return Array.from(cats).sort();\n    }, [allHabits]);\n\n    // Smart Library Derivation\n    const libraryItems = useMemo(() => {\n        const unique = new Map<string, Habit>();\n        allHabits.forEach(h => {\n            if (!unique.has(h.name)) {\n                unique.set(h.name, h);\n            }\n        });\n        return Array.from(unique.values()).filter(h =>\n            h.name.toLowerCase().includes(librarySearch.toLowerCase()) ||\n            h.category.toLowerCase().includes(librarySearch.toLowerCase())\n        );\n    }, [allHabits, librarySearch]);\n\n    if (!isOpen) return null;\n\n    const handleSave = () => {\n        if (!name.trim() || !category.trim()) return;\n        onSave({ name, category, weight });\n    };\n\n    const handleImportFromLibrary = (habit: Habit) => {\n        setName(habit.name);\n        setCategory(habit.category);\n        setWeight(habit.weight);\n        setActiveTab('create');\n    };\n\n    const handleDeleteClick = (e: React.MouseEvent, id: string) => {\n        e.stopPropagation();\n        if (verifyDeleteId === id) {\n            if (onDeleteFromLibrary) onDeleteFromLibrary(id);\n            setVerifyDeleteId(null);\n        } else {\n            setVerifyDeleteId(id);\n            setTimeout(() => setVerifyDeleteId(null), 3000);\n        }\n    };\n\n    // --- Category Manager Handlers ---\n    const startEditCategory = (cat: string) => {\n        setEditingCatName(cat);\n        setTempCatName(cat);\n    };\n\n    const saveEditCategory = async () => {\n        if (editingCatName && tempCatName.trim() && tempCatName !== editingCatName) {\n            if (onRenameCategory) {\n                await onRenameCategory(editingCatName, tempCatName.trim());\n                // If the current form category matched the edited one, update it too\n                if (category === editingCatName) setCategory(tempCatName.trim());\n            }\n        }\n        setEditingCatName(null);\n        setTempCatName('');\n    };\n\n    const deleteCategory = async (cat: string) => {\n        if (verifyDeleteCat === cat) {\n            if (onDeleteCategory) {\n                await onDeleteCategory(cat);\n                // If form selected this category, clear it\n                if (category === cat) setCategory('');\n            }\n            setVerifyDeleteCat(null);\n        } else {\n            setVerifyDeleteCat(cat);\n            setTimeout(() => setVerifyDeleteCat(null), 3000);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\n            <div className=\"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col max-h-[85vh]\" onClick={(e) => e.stopPropagation()}>\n\n                {/* Header & Tabs */}\n                <div className=\"flex-none border-b border-graphite-200 dark:border-graphite-800\">\n                    <div className=\"p-6 pb-4 flex justify-between items-center\">\n                        <h2 className=\"text-lg font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\n                            {isManagingCats ? (\n                                <><Settings size={18} className=\"text-graphite-500\" /> Manage Categories</>\n                            ) : activeTab === 'create' ? (\n                                <><CheckCircle2 size={18} className=\"text-pacific-500\" /> {initialHabit ? 'Edit Habit' : 'Add Habit'}</>\n                            ) : (\n                                <><Library size={18} className=\"text-bali-500\" /> Habit Library</>\n                            )}\n                        </h2>\n                        <button onClick={onClose} className=\"text-graphite-400 hover:text-white\"><X size={18} /></button>\n                    </div>\n\n                    {!initialHabit && !isManagingCats && (\n                        <div className=\"px-6 flex gap-4\">\n                            <button\n                                onClick={() => setActiveTab('create')}\n                                className={`pb-3 text-xs font-bold uppercase tracking-wider transition-colors border-b-2 ${activeTab === 'create' ? 'border-pacific-500 text-pacific-600 dark:text-pacific-400' : 'border-transparent text-graphite-400 hover:text-graphite-600 dark:hover:text-graphite-300'}`}\n                            >\n                                Create New\n                            </button>\n                            <button\n                                onClick={() => setActiveTab('library')}\n                                className={`pb-3 text-xs font-bold uppercase tracking-wider transition-colors border-b-2 ${activeTab === 'library' ? 'border-bali-500 text-bali-600 dark:text-bali-400' : 'border-transparent text-graphite-400 hover:text-graphite-600 dark:hover:text-graphite-300'}`}\n                            >\n                                From History\n                            </button>\n                        </div>\n                    )}\n                </div>\n\n                {/* Content Area */}\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                    {isManagingCats ? (\n                        <div className=\"animate-in fade-in slide-in-from-right-4 space-y-4\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                                <button onClick={() => setIsManagingCats(false)} className=\"text-xs font-bold text-graphite-500 hover:text-pacific-500 flex items-center gap-1\">\n                                    <ArrowLeft size={12} /> Back to Form\n                                </button>\n                                <span className=\"text-[10px] uppercase text-graphite-400 font-bold\">{uniqueCategories.length} Categories</span>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                {uniqueCategories.map(cat => (\n                                    <div key={cat} className=\"group flex items-center justify-between p-3 rounded-xl border border-graphite-200 dark:border-graphite-800 bg-white dark:bg-graphite-800/50 hover:border-pacific-200 dark:hover:border-pacific-900 transition-all\">\n                                        {editingCatName === cat ? (\n                                            <div className=\"flex items-center gap-2 flex-1\">\n                                                <input\n                                                    value={tempCatName}\n                                                    onChange={e => setTempCatName(e.target.value)}\n                                                    className=\"flex-1 bg-graphite-50 dark:bg-graphite-900 border border-pacific-500 rounded-lg px-2 py-1 text-sm text-graphite-900 dark:text-white outline-none\"\n                                                    autoFocus\n                                                    onKeyDown={e => e.key === 'Enter' && saveEditCategory()}\n                                                />\n                                                <button onClick={saveEditCategory} className=\"p-1.5 bg-pacific-500 text-white rounded-lg\"><Check size={14} /></button>\n                                                <button onClick={() => setEditingCatName(null)} className=\"p-1.5 text-graphite-400 hover:text-white\"><X size={14} /></button>\n                                            </div>\n                                        ) : (\n                                            <>\n                                                <span className=\"text-sm font-medium text-graphite-700 dark:text-graphite-300\">{cat}</span>\n                                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                    <button onClick={() => startEditCategory(cat)} className=\"p-2 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg\"><Edit2 size={14} /></button>\n                                                    {cat !== 'Uncategorized' && (\n                                                        <button\n                                                            onClick={() => deleteCategory(cat)}\n                                                            className={`p-2 rounded-lg flex items-center gap-2 transition-all ${verifyDeleteCat === cat ? 'bg-red-500 text-white w-24 justify-center' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'}`}\n                                                        >\n                                                            <Trash2 size={14} /> {verifyDeleteCat === cat && <span className=\"text-[10px] font-bold\">Confirm</span>}\n                                                        </button>\n                                                    )}\n                                                </div>\n                                            </>\n                                        )}\n                                    </div>\n                                ))}\n                                {uniqueCategories.length === 0 && <div className=\"text-center py-8 text-graphite-400 text-sm\">No categories defined yet.</div>}\n                            </div>\n\n                            <div className=\"p-3 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100 dark:border-blue-900/30 flex gap-3 items-start\">\n                                <AlertCircle size={16} className=\"text-blue-500 mt-0.5 shrink-0\" />\n                                <div className=\"text-xs text-blue-700 dark:text-blue-300 leading-relaxed\">\n                                    <strong>Note:</strong> Renaming updates all habits history. Deleting moves associated habits to \"Uncategorized\".\n                                </div>\n                            </div>\n                        </div>\n                    ) : activeTab === 'create' ? (\n                        <div className=\"space-y-5 animate-in fade-in slide-in-from-left-4\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Habit Name</label>\n                                <input value={name} onChange={e => setName(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white transition-all\" placeholder=\"e.g. Morning Run\" autoFocus />\n                            </div>\n\n                            <div>\n                                <div className=\"flex justify-between items-center mb-1.5\">\n                                    <label className=\"block text-xs font-bold text-graphite-500 uppercase\">Category</label>\n                                    <button onClick={() => setIsManagingCats(true)} className=\"text-[10px] font-bold text-pacific-500 hover:text-pacific-600 flex items-center gap-1\"><Settings size={10} /> Manage</button>\n                                </div>\n                                <div className=\"relative\">\n                                    <Tag size={14} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-graphite-400\" />\n                                    <input value={category} onChange={e => setCategory(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl pl-9 pr-4 py-3 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white transition-all\" placeholder=\"e.g. Health\" />\n                                </div>\n                                {/* Category Chips */}\n                                {uniqueCategories.length > 0 && (\n                                    <div className=\"mt-2 flex flex-wrap gap-2\">\n                                        {uniqueCategories.slice(0, 8).map(cat => (\n                                            <button\n                                                key={cat}\n                                                onClick={() => setCategory(cat === category ? '' : cat)}\n                                                className={`px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide border transition-all ${category === cat ? 'bg-pacific-500 text-white border-pacific-500' : 'bg-graphite-100 dark:bg-graphite-800 text-graphite-500 border-transparent hover:bg-pacific-50 dark:hover:bg-pacific-900/20 hover:text-pacific-600 dark:hover:text-pacific-400'}`}\n                                            >\n                                                {cat}\n                                            </button>\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n\n                            <div>\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Impact Weight</label>\n                                <div className=\"grid grid-cols-3 gap-2\">\n                                    {[HabitWeight.LOW, HabitWeight.MEDIUM, HabitWeight.HIGH].map((w) => (\n                                        <button\n                                            key={w}\n                                            onClick={() => setWeight(w)}\n                                            className={`py-2.5 text-xs font-bold rounded-xl border transition-all ${weight === w ? 'bg-pacific-500 text-white border-pacific-500 shadow-md shadow-pacific-500/20' : 'bg-graphite-50 dark:bg-graphite-800 text-graphite-500 border-graphite-200 dark:border-graphite-700 hover:border-graphite-400'}`}\n                                        >\n                                            {w === HabitWeight.LOW ? 'Low (1)' : w === HabitWeight.MEDIUM ? 'Medium (2)' : 'High (4)'}\n                                        </button>\n                                    ))}\n                                </div>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"flex flex-col h-full animate-in fade-in slide-in-from-right-4\">\n                            <div className=\"relative mb-4\">\n                                <Search size={14} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-graphite-400\" />\n                                <input\n                                    value={librarySearch}\n                                    onChange={e => setLibrarySearch(e.target.value)}\n                                    className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl pl-9 pr-4 py-2 text-sm focus:outline-none focus:border-bali-500 text-graphite-900 dark:text-white\"\n                                    placeholder=\"Search history...\"\n                                    autoFocus\n                                />\n                            </div>\n                            <div className=\"flex-1 overflow-y-auto space-y-2 pr-1\">\n                                {libraryItems.length > 0 ? libraryItems.map(habit => (\n                                    <div key={habit.id} onClick={() => handleImportFromLibrary(habit)} className=\"group flex items-center justify-between p-3 rounded-xl border border-graphite-200 dark:border-graphite-800 bg-white dark:bg-graphite-800/50 hover:border-bali-500 dark:hover:border-bali-500 cursor-pointer transition-all\">\n                                        <div>\n                                            <div className=\"text-sm font-bold text-graphite-900 dark:text-white group-hover:text-bali-600 dark:group-hover:text-bali-400 transition-colors\">{habit.name}</div>\n                                            <div className=\"flex items-center gap-2 mt-1\">\n                                                <span className=\"text-[10px] font-medium bg-graphite-100 dark:bg-graphite-900 text-graphite-500 px-2 py-0.5 rounded\">{habit.category}</span>\n                                                <div className=\"flex gap-0.5\">{[...Array(habit.weight)].map((_, i) => <div key={i} className=\"h-1 w-1 rounded-full bg-bali-400\" />)}</div>\n                                            </div>\n                                        </div>\n                                        <div className=\"flex items-center gap-2\">\n                                            <button\n                                                onClick={(e) => handleDeleteClick(e, habit.id)}\n                                                className={`p-2 rounded-lg transition-all ${verifyDeleteId === habit.id ? 'bg-red-500 text-white' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 opacity-0 group-hover:opacity-100'}`}\n                                            >\n                                                <Trash2 size={14} />\n                                            </button>\n                                            <ArrowRight size={16} className=\"text-graphite-300 group-hover:text-bali-500 -translate-x-2 group-hover:translate-x-0 transition-all opacity-0 group-hover:opacity-100\" />\n                                        </div>\n                                    </div>\n                                )) : (\n                                    <div className=\"text-center py-12 text-graphite-400 text-sm\">No matching habits found in history.</div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-6 border-t border-graphite-200 dark:border-graphite-800 flex justify-end gap-3 bg-white dark:bg-graphite-900 rounded-b-2xl\">\n                    {!isManagingCats ? (\n                        <>\n                            <button onClick={onClose} className=\"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-800 dark:hover:text-white transition-colors\">Cancel</button>\n                            {activeTab === 'create' && (\n                                <button onClick={handleSave} disabled={!name.trim()} className=\"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-pacific-500 transition-colors flex items-center gap-2\">\n                                    <Save size={14} /> Save\n                                </button>\n                            )}\n                        </>\n                    ) : (\n                        <button onClick={() => setIsManagingCats(false)} className=\"px-6 py-2 bg-graphite-100 dark:bg-graphite-800 text-graphite-900 dark:text-white rounded-xl text-sm font-bold hover:bg-graphite-200 dark:hover:bg-graphite-700 transition-colors\">\n                            Done\n                        </button>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":["HabitFormModal","isOpen","onClose","onSave","initialHabit","allHabits","onDeleteFromLibrary","onRenameCategory","onDeleteCategory","activeTab","setActiveTab","isManagingCats","setIsManagingCats","name","setName","category","setCategory","weight","setWeight","MEDIUM","librarySearch","setLibrarySearch","verifyDeleteId","setVerifyDeleteId","editingCatName","setEditingCatName","tempCatName","setTempCatName","verifyDeleteCat","setVerifyDeleteCat","uniqueCategories","cats","Set","map","h","filter","Boolean","Array","from","sort","libraryItems","unique","Map","forEach","has","set","values","toLowerCase","includes","handleSave","trim","handleImportFromLibrary","habit","handleDeleteClick","e","id","stopPropagation","setTimeout","startEditCategory","cat","saveEditCategory","deleteCategory","className","onClick","size","length","value","onChange","target","autoFocus","onKeyDown","key","placeholder","slice","LOW","HIGH","w","_","i","disabled"],"mappings":"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"}},
    {"offset": {"line": 1357, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/components/CycleEditorModal.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Cycle, Goal, Habit, GoalType, EntityStatus, CCHItem } from '@/types/types';\r\nimport { supabaseService } from '@/lib/supabaseService';\r\nimport { Edit3, Brain, Fingerprint, Activity, Plus, Trash2, CheckCircle2, List, X, Save, Target, AlertTriangle, Calendar, Rocket, Power, AlertCircle } from 'lucide-react';\r\nimport { GoalFormModal } from './GoalFormModal';\r\nimport { HabitFormModal } from './HabitFormModal';\r\n\r\ninterface CycleEditorModalProps {\r\n    mode?: 'create' | 'edit';\r\n    cycle?: Cycle; // Optional, undefined in 'create' mode\r\n    goals: Goal[];\r\n    habits: Habit[];\r\n    allHabits: Habit[];\r\n    suggestedSprintNumber?: number; // For create mode auto-fill\r\n    onClose: () => void;\r\n    // Handler for 'edit' mode (atomic updates)\r\n    onSaveCycle?: (cycle: Cycle) => void;\r\n    onManageGoal?: (action: 'create' | 'update' | 'delete', goal: any) => void;\r\n    onManageHabit?: (action: 'create' | 'update' | 'delete', habit: any) => void;\r\n    // Handler for 'create' mode (bulk save)\r\n    onCreate?: (cycleData: any, goals: any[], habits: any[]) => void;\r\n    // Category Handlers\r\n    onRenameCategory?: (oldName: string, newName: string) => Promise<void>;\r\n    onDeleteCategory?: (categoryName: string) => Promise<void>;\r\n    // Explicit Handler for deleting habits from the library (database)\r\n    onDeleteHabitFromDB?: (habitId: string) => Promise<void>;\r\n    // Dynamic Cycle Limit\r\n    maxCycles?: number;\r\n    // Context for Smart Scheduling\r\n    versionStartDate?: string;\r\n    existingCycles?: Cycle[];\r\n}\r\n\r\n// Helper for safe date arithmetic without timezone issues\r\nconst addDaysToDate = (dateStr: string, days: number): string => {\r\n    if (!dateStr) return '';\r\n    const parts = dateStr.split('-').map(Number);\r\n    // Create date in local time (Year, Month Index, Day)\r\n    const date = new Date(parts[0], parts[1] - 1, parts[2]);\r\n    date.setDate(date.getDate() + days);\r\n\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n};\r\n\r\nexport const CycleEditorModal: React.FC<CycleEditorModalProps> = ({\r\n    mode = 'edit', cycle, goals, habits, allHabits, suggestedSprintNumber, onClose, onSaveCycle, onManageGoal, onManageHabit, onCreate, onRenameCategory, onDeleteCategory, onDeleteHabitFromDB, maxCycles = 6, versionStartDate, existingCycles\r\n}) => {\r\n    const [activeTab, setActiveTab] = useState<'strategy' | 'identity' | 'mantras' | 'goals' | 'habits'>('strategy');\r\n\r\n    // --- Cycle Config State (Create Mode) ---\r\n    const [sprintNumber, setSprintNumber] = useState(suggestedSprintNumber || 1);\r\n    const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [endDate, setEndDate] = useState(new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]);\r\n    const [isActive, setIsActive] = useState(true);\r\n    const [cycleDuration, setCycleDuration] = useState(15); // Default, updated by DB\r\n\r\n    // --- Cycle Content State ---\r\n    const [priorities, setPriorities] = useState<string[]>(['', '', '']);\r\n    const [problems, setProblems] = useState('');\r\n    const [learning, setLearning] = useState('');\r\n    const [beliefs, setBeliefs] = useState<string[]>([]);\r\n    const [characteristics, setCharacteristics] = useState<string[]>([]);\r\n    const [skills, setSkills] = useState<string[]>([]);\r\n    const [selectedMantras, setSelectedMantras] = useState<string[]>([]);\r\n\r\n    // --- Local Lists State (Buffer for Create Mode) ---\r\n    // In 'create' mode, we manipulate these arrays. In 'edit' mode, we use the props `goals` and `habits` but might optimistic update these for UI.\r\n    const [localGoals, setLocalGoals] = useState<Goal[]>([]);\r\n    const [localHabits, setLocalHabits] = useState<Habit[]>([]);\r\n\r\n    // --- Helper State ---\r\n    const [allMantras, setAllMantras] = useState<string[]>([]);\r\n    const [tempBelief, setTempBelief] = useState('');\r\n    const [tempChar, setTempChar] = useState('');\r\n    const [tempSkill, setTempSkill] = useState('');\r\n    const [newMantra, setNewMantra] = useState('');\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // --- Sub-Modals State ---\r\n    const [editingGoal, setEditingGoal] = useState<Goal | undefined>(undefined);\r\n    const [isGoalModalOpen, setIsGoalModalOpen] = useState(false);\r\n    const [editingHabit, setEditingHabit] = useState<Habit | undefined>(undefined);\r\n    const [isHabitModalOpen, setIsHabitModalOpen] = useState(false);\r\n    const [verifyDeleteId, setVerifyDeleteId] = useState<string | null>(null);\r\n\r\n    // Initialization\r\n    useEffect(() => {\r\n        supabaseService.getMantras().then(setAllMantras);\r\n\r\n        if (mode === 'edit' && cycle) {\r\n            setPriorities(cycle.focus_priorities);\r\n            setProblems(cycle.problems);\r\n            setLearning(cycle.learning_focus);\r\n            setBeliefs(cycle.cch_list.find(c => c.category === 'Beliefs')?.items || []);\r\n            setCharacteristics(cycle.cch_list.find(c => c.category === 'Characteristics')?.items || []);\r\n            setSkills(cycle.cch_list.find(c => c.category === 'Skills')?.items || []);\r\n            setSelectedMantras(cycle.mantras);\r\n            setSprintNumber(cycle.sprint_number);\r\n            setStartDate(cycle.start_date);\r\n            setEndDate(cycle.end_date);\r\n        }\r\n    }, [mode, cycle]);\r\n\r\n    // Smart Scheduling Logic\r\n    useEffect(() => {\r\n        const initScheduling = async () => {\r\n            // 1. Fetch System Settings\r\n            const settings = await supabaseService.getSystemSettings();\r\n            const duration = Math.floor(settings.days / settings.cycles);\r\n            setCycleDuration(duration);\r\n\r\n            // 2. Auto-Suggest Dates (Only in Create Mode)\r\n            if (mode === 'create' && versionStartDate) {\r\n                let suggestedStart = versionStartDate;\r\n\r\n                // If cycles exist, start after the last one\r\n                if (existingCycles && existingCycles.length > 0) {\r\n                    // Sort by end date descending\r\n                    const sorted = [...existingCycles].sort((a, b) => new Date(b.end_date).getTime() - new Date(a.end_date).getTime());\r\n                    const lastCycle = sorted[0];\r\n                    suggestedStart = addDaysToDate(lastCycle.end_date, 1);\r\n                }\r\n\r\n                setStartDate(suggestedStart);\r\n                setEndDate(addDaysToDate(suggestedStart, duration - 1));\r\n            }\r\n        };\r\n        initScheduling();\r\n    }, [mode, versionStartDate, existingCycles]);\r\n\r\n    // Sync local state with props in Edit mode\r\n    useEffect(() => {\r\n        if (mode === 'edit') {\r\n            setLocalGoals(goals);\r\n            setLocalHabits(habits);\r\n        }\r\n    }, [goals, habits, mode]);\r\n\r\n    // -- Cycle Logic Handlers --\r\n    const handleAddMantra = async () => { if (newMantra.trim()) { await supabaseService.addMantra(newMantra); setAllMantras(prev => [...prev, newMantra]); setSelectedMantras(prev => [...prev, newMantra]); setNewMantra(''); } };\r\n    const handleAddBelief = () => { if (tempBelief.trim()) { setBeliefs([...beliefs, tempBelief.trim()]); setTempBelief(''); } };\r\n    const handleAddChar = () => { if (tempChar.trim()) { setCharacteristics([...characteristics, tempChar.trim()]); setTempChar(''); } };\r\n    const handleAddSkill = () => { if (tempSkill.trim()) { setSkills([...skills, tempSkill.trim()]); setTempSkill(''); } };\r\n\r\n    const handleManualStartDateChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const newStart = e.target.value;\r\n        setStartDate(newStart);\r\n        if (newStart && cycleDuration > 0) {\r\n            setEndDate(addDaysToDate(newStart, cycleDuration - 1));\r\n        }\r\n    };\r\n\r\n    // -- Main Save Handler --\r\n    const handleFinalSave = () => {\r\n        // Validate Constraints\r\n        if (mode === 'create' && (sprintNumber < 1 || sprintNumber > maxCycles)) {\r\n            setError(`Versions are limited to exactly ${maxCycles} cycles.`);\r\n            setActiveTab('strategy');\r\n            return;\r\n        }\r\n\r\n        const cycleData = {\r\n            sprint_number: sprintNumber,\r\n            start_date: startDate,\r\n            end_date: endDate,\r\n            status: isActive ? EntityStatus.ACTIVE : undefined, // Only relevant for create usually\r\n            focus_priorities: priorities.filter(p => p.trim().length > 0),\r\n            problems,\r\n            learning_focus: learning,\r\n            mantras: selectedMantras,\r\n            cch_list: [\r\n                { category: 'Beliefs', items: beliefs },\r\n                { category: 'Characteristics', items: characteristics },\r\n                { category: 'Skills', items: skills }\r\n            ] as CCHItem[]\r\n        };\r\n\r\n        if (mode === 'create' && onCreate) {\r\n            onCreate(cycleData, localGoals, localHabits);\r\n        } else if (mode === 'edit' && onSaveCycle && cycle) {\r\n            // In edit mode, goals/habits are handled atomically by other handlers. We just save the cycle config.\r\n            onSaveCycle({ ...cycle, ...cycleData });\r\n        }\r\n    };\r\n\r\n    // -- Goal/Habit Wrapper Handlers --\r\n\r\n    const handleGoalSaveWrapper = (goalData: any, selectedHabit: any) => {\r\n        // goalData from modal: { title, description, type, subtasks (string[]) }\r\n        const newGoalObj = {\r\n            id: editingGoal?.id || `temp-g-${Date.now()}`,\r\n            ...goalData,\r\n            // If it's consistency, we need to store the habit data structure temporarily for the parent to process\r\n            linkedHabit: selectedHabit,\r\n            // In create mode, subtasks come as strings from modal, we format them for preview\r\n            subtasks: goalData.subtasks?.map((s: string) => ({ name: s, done: false }))\r\n        };\r\n\r\n        if (mode === 'create') {\r\n            if (editingGoal) {\r\n                setLocalGoals(prev => prev.map(g => g.id === editingGoal.id ? { ...g, ...newGoalObj } : g));\r\n            } else {\r\n                setLocalGoals(prev => [...prev, newGoalObj]);\r\n            }\r\n        } else {\r\n            // Edit Mode: Immediate DB Action\r\n            if (onManageGoal) {\r\n                const action = editingGoal ? 'update' : 'create';\r\n                onManageGoal(action, { ...newGoalObj, linkedHabit: selectedHabit });\r\n            }\r\n        }\r\n        setIsGoalModalOpen(false);\r\n    };\r\n\r\n    const handleHabitSaveWrapper = (habitData: any) => {\r\n        const newHabitObj = {\r\n            id: editingHabit?.id || `temp-h-${Date.now()}`,\r\n            ...habitData\r\n        };\r\n\r\n        if (mode === 'create') {\r\n            if (editingHabit) {\r\n                setLocalHabits(prev => prev.map(h => h.id === editingHabit.id ? newHabitObj : h));\r\n            } else {\r\n                setLocalHabits(prev => [...prev, newHabitObj]);\r\n            }\r\n        } else {\r\n            if (onManageHabit) {\r\n                const action = editingHabit ? 'update' : 'create';\r\n                onManageHabit(action, newHabitObj);\r\n            }\r\n        }\r\n        setIsHabitModalOpen(false);\r\n    };\r\n\r\n    // Handle deleting a habit from the library/history view in the modal\r\n    const handleDeleteFromLibrary = async (habitId: string) => {\r\n        if (onDeleteHabitFromDB) {\r\n            await onDeleteHabitFromDB(habitId);\r\n        } else if (onManageHabit) {\r\n            onManageHabit('delete', { id: habitId });\r\n        } else {\r\n            console.warn(\"Delete from library not fully supported in create mode without parent handler\");\r\n        }\r\n    };\r\n\r\n    const handleDeleteItem = (id: string, type: 'goal' | 'habit') => {\r\n        if (verifyDeleteId !== id) {\r\n            setVerifyDeleteId(id);\r\n            setTimeout(() => setVerifyDeleteId(null), 3000);\r\n            return;\r\n        }\r\n\r\n        if (mode === 'create') {\r\n            if (type === 'goal') setLocalGoals(prev => prev.filter(g => g.id !== id));\r\n            else setLocalHabits(prev => prev.filter(h => h.id !== id));\r\n        } else {\r\n            if (type === 'goal' && onManageGoal) onManageGoal('delete', { id });\r\n            if (type === 'habit' && onManageHabit) onManageHabit('delete', { id });\r\n        }\r\n        setVerifyDeleteId(null);\r\n    };\r\n\r\n    // Open Handlers\r\n    const openAddGoal = () => { setEditingGoal(undefined); setIsGoalModalOpen(true); };\r\n    const openEditGoal = (g: Goal) => { setEditingGoal(g); setIsGoalModalOpen(true); };\r\n    const openAddHabit = () => { setEditingHabit(undefined); setIsHabitModalOpen(true); };\r\n    const openEditHabit = (h: Habit) => { setEditingHabit(h); setIsHabitModalOpen(true); };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\r\n            <div className=\"w-full max-w-4xl rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col h-[85vh]\" onClick={e => e.stopPropagation()}>\r\n\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-graphite-200 dark:border-graphite-800 flex justify-between items-center bg-graphite-50 dark:bg-graphite-950/50 rounded-t-2xl\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                            {mode === 'create' ? <Rocket size={20} className=\"text-pacific-500\" /> : <Edit3 size={20} className=\"text-pacific-500\" />}\r\n                            {mode === 'create' ? 'Initialize New Cycle' : 'Cycle Editor'}\r\n                        </h2>\r\n                        <div className=\"text-xs text-graphite-500 mt-1 uppercase tracking-wider\">\r\n                            {mode === 'create' ? 'System Configuration' : `Cycle ${cycle?.sprint_number} Configuration`}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Tabs */}\r\n                    <div className=\"flex bg-white dark:bg-graphite-800 p-1 rounded-xl border border-graphite-200 dark:border-graphite-700\">\r\n                        {[\r\n                            { id: 'strategy', icon: <Target size={14} /> },\r\n                            { id: 'identity', icon: <Fingerprint size={14} /> },\r\n                            { id: 'mantras', icon: <Brain size={14} /> },\r\n                            { id: 'goals', icon: <CheckCircle2 size={14} /> },\r\n                            { id: 'habits', icon: <List size={14} /> }\r\n                        ].map(tab => (\r\n                            <button\r\n                                key={tab.id}\r\n                                onClick={() => setActiveTab(tab.id as any)}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold uppercase transition-all ${activeTab === tab.id\r\n                                    ? 'bg-pacific-500 text-white shadow-md'\r\n                                    : 'text-graphite-500 hover:text-graphite-900 dark:hover:text-graphite-white hover:bg-graphite-50 dark:hover:bg-graphite-700'\r\n                                    }`}\r\n                            >\r\n                                {tab.icon} {tab.id}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <button onClick={onClose} type=\"button\" className=\"text-graphite-400 hover:text-white transition-colors\"><X size={24} /></button>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-8 bg-graphite-50/50 dark:bg-graphite-900/50\">\r\n                    {/* STRATEGY TAB */}\r\n                    {activeTab === 'strategy' && (\r\n                        <div className=\"space-y-6 max-w-2xl mx-auto animate-in fade-in slide-in-from-right-2\">\r\n\r\n                            {/* CREATE MODE: Configuration Fields */}\r\n                            {mode === 'create' && (\r\n                                <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm space-y-4\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-2 text-pacific-500 text-xs font-bold uppercase tracking-widest\">\r\n                                            <Calendar size={14} /> Temporal Config\r\n                                        </div>\r\n                                        <div className=\"text-[10px] font-bold text-pacific-600 dark:text-pacific-400 bg-pacific-50 dark:bg-pacific-900/20 px-2 py-1 rounded\">\r\n                                            AUTO-SUGGESTED\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Start Date</label>\r\n                                            <input\r\n                                                type=\"date\"\r\n                                                value={startDate}\r\n                                                onChange={handleManualStartDateChange}\r\n                                                className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2.5 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500\"\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">End Date</label>\r\n                                            <input\r\n                                                type=\"date\"\r\n                                                value={endDate}\r\n                                                onChange={e => setEndDate(e.target.value)}\r\n                                                className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2.5 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-4 pt-2\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-1.5\">Cycle Number (1-{maxCycles})</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                min=\"1\"\r\n                                                max={maxCycles}\r\n                                                value={sprintNumber}\r\n                                                onChange={e => {\r\n                                                    const val = Number(e.target.value);\r\n                                                    setSprintNumber(val);\r\n                                                    if (val > maxCycles) setError(`Maximum ${maxCycles} cycles allowed per version.`);\r\n                                                    else setError(null);\r\n                                                }}\r\n                                                className={`w-full bg-graphite-50 dark:bg-graphite-950 border rounded-xl px-3 py-2.5 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500 ${error ? 'border-red-500 ring-1 ring-red-500/20' : 'border-graphite-200 dark:border-graphite-700'}`}\r\n                                            />\r\n                                            {error && <p className=\"text-red-500 text-[10px] mt-1 font-bold flex items-center gap-1\"><AlertCircle size={10} /> {error}</p>}\r\n                                        </div>\r\n                                        <div className=\"flex items-end\">\r\n                                            <button\r\n                                                onClick={() => setIsActive(!isActive)}\r\n                                                className={`w-full py-2.5 rounded-xl border flex items-center justify-center gap-2 text-sm font-bold transition-all ${isActive ? 'bg-pacific-500/10 border-pacific-500/50 text-pacific-600 dark:text-pacific-400' : 'bg-graphite-50 dark:bg-graphite-950 border-graphite-200 dark:border-graphite-700 text-graphite-500'}`}\r\n                                            >\r\n                                                <Power size={16} /> {isActive ? 'Status: Active' : 'Status: Inactive'}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-4\">Focus Priorities</label>\r\n                                <div className=\"space-y-3\">\r\n                                    {priorities.map((p, i) => (\r\n                                        <div key={i} className=\"flex gap-3\">\r\n                                            <span className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-graphite-100 dark:bg-graphite-800 font-bold text-graphite-500 border border-graphite-200 dark:border-graphite-700\">{i + 1}</span>\r\n                                            <input value={p} onChange={e => { const newP = [...priorities]; newP[i] = e.target.value; setPriorities(newP); }} className=\"flex-1 bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder={`Priority ${i + 1}`} />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-2\">Current Friction/Problems</label>\r\n                                <textarea value={problems} onChange={e => setProblems(e.target.value)} rows={3} className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl p-4 text-sm focus:outline-none focus:border-pacific-500 resize-none transition-colors\" placeholder=\"What is slowing you down?\" />\r\n                            </div>\r\n                            <div className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-2\">Learning Focus</label>\r\n                                <input value={learning} onChange={e => setLearning(e.target.value)} className=\"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl p-4 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder=\"One major skill to master...\" />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* IDENTITY TAB */}\r\n                    {activeTab === 'identity' && (\r\n                        <div className=\"space-y-8 max-w-2xl mx-auto animate-in fade-in slide-in-from-right-2\">\r\n                            {[{ title: 'Core Beliefs', items: beliefs, add: handleAddBelief, val: tempBelief, set: setTempBelief, icon: <Brain size={18} /> }, { title: 'Characteristics', items: characteristics, add: handleAddChar, val: tempChar, set: setTempChar, icon: <Fingerprint size={18} /> }, { title: 'Skills Acquisition', items: skills, add: handleAddSkill, val: tempSkill, set: setTempSkill, icon: <Activity size={18} /> }].map((section, idx) => (\r\n                                <div key={idx} className=\"bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                                    <h3 className=\"text-sm font-bold text-graphite-900 dark:text-white flex items-center gap-2 mb-4\">{section.icon} {section.title}</h3>\r\n                                    <div className=\"flex flex-wrap gap-2 mb-4\">\r\n                                        {section.items.map((item, i) => (\r\n                                            <span key={i} className=\"bg-graphite-100 dark:bg-graphite-800 px-3 py-1.5 rounded-lg text-xs font-medium flex items-center gap-2 border border-graphite-200 dark:border-graphite-700\">\r\n                                                {item}\r\n                                                <button onClick={() => { if (section.title === 'Core Beliefs') setBeliefs(beliefs.filter((_, j) => j !== i)); else if (section.title === 'Characteristics') setCharacteristics(characteristics.filter((_, j) => j !== i)); else setSkills(skills.filter((_, j) => j !== i)); }} className=\"text-graphite-400 hover:text-red-500\"><X size={12} /></button>\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <input value={section.val} onChange={e => section.set(e.target.value)} onKeyDown={e => e.key === 'Enter' && section.add()} className=\"flex-1 bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder={`Add ${section.title}...`} />\r\n                                        <button onClick={section.add} className=\"p-2 bg-pacific-500 text-white rounded-xl hover:bg-pacific-600 transition-colors\"><Plus size={20} /></button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* MANTRAS TAB */}\r\n                    {activeTab === 'mantras' && (\r\n                        <div className=\"space-y-4 max-w-2xl mx-auto animate-in fade-in slide-in-from-right-2 bg-white dark:bg-graphite-900 p-6 rounded-2xl border border-graphite-200 dark:border-graphite-800 shadow-sm\">\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold text-graphite-500 uppercase mb-3\">Select Active Mantras</label>\r\n                                <div className=\"grid grid-cols-1 gap-2 max-h-[400px] overflow-y-auto pr-2\">\r\n                                    {allMantras.map((m, i) => (\r\n                                        <div key={i} onClick={() => setSelectedMantras(prev => prev.includes(m) ? prev.filter(x => x !== m) : [...prev, m])} className={`p-3 rounded-xl border cursor-pointer transition-all flex items-center justify-between ${selectedMantras.includes(m) ? 'bg-pacific-50 border-pacific-500 text-pacific-700 dark:bg-pacific-900/20 dark:text-pacific-300' : 'bg-graphite-50 dark:bg-graphite-950 border-transparent text-graphite-600 dark:text-graphite-400 hover:bg-graphite-100 dark:hover:bg-graphite-800'}`}>\r\n                                            <span className=\"text-sm font-medium\">{m}</span>\r\n                                            {selectedMantras.includes(m) && <CheckCircle2 size={16} />}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex gap-2 pt-4 border-t border-graphite-200 dark:border-graphite-800\">\r\n                                <input value={newMantra} onChange={e => setNewMantra(e.target.value)} className=\"flex-1 bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-pacific-500 transition-colors\" placeholder=\"New Mantra...\" />\r\n                                <button onClick={handleAddMantra} className=\"px-4 bg-graphite-900 dark:bg-white text-white dark:text-graphite-900 rounded-xl font-bold text-xs uppercase tracking-wider\">ADD</button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* GOALS TAB */}\r\n                    {activeTab === 'goals' && (\r\n                        <div className=\"max-w-3xl mx-auto animate-in fade-in slide-in-from-right-2 space-y-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <h3 className=\"text-sm font-bold text-graphite-500 uppercase tracking-widest\">Active Goals</h3>\r\n                                <button onClick={openAddGoal} className=\"flex items-center gap-2 px-4 py-2 bg-pacific-600 text-white rounded-xl text-xs font-bold hover:bg-pacific-500 shadow-lg shadow-pacific-500/30 transition-colors\">\r\n                                    <Plus size={16} /> Add Goal\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"space-y-3\">\r\n                                {localGoals.map((g) => (\r\n                                    <div key={g.id} className=\"p-4 bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 rounded-2xl flex justify-between items-center group hover:border-pacific-500/30 transition-all shadow-sm\">\r\n                                        <div>\r\n                                            <div className=\"font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                                                {g.title}\r\n                                                <span className={`text-[10px] uppercase px-2 py-0.5 rounded border ${g.type === GoalType.TASK_PROJECT ? 'border-purple-200 text-purple-600 dark:border-purple-900 dark:text-purple-400' : 'border-bali-200 text-bali-600 dark:border-bali-900 dark:text-bali-400'}`}>\r\n                                                    {g.type === GoalType.TASK_PROJECT ? 'Project' : 'Metric'}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"text-xs text-graphite-500 mt-1 line-clamp-1\">{g.description}</div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button onClick={() => openEditGoal(g)} className=\"p-2 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg transition-colors\"><Edit3 size={16} /></button>\r\n                                            <button\r\n                                                onClick={() => handleDeleteItem(g.id, 'goal')}\r\n                                                className={`p-2 rounded-lg transition-all flex items-center gap-2 ${verifyDeleteId === g.id ? 'bg-red-500 text-white w-24 justify-center' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'}`}\r\n                                            >\r\n                                                <Trash2 size={16} /> {verifyDeleteId === g.id && <span className=\"text-xs font-bold\">Confirm</span>}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {localGoals.length === 0 && <div className=\"text-center py-12 text-graphite-400 italic bg-graphite-50 dark:bg-graphite-950 rounded-2xl border border-dashed border-graphite-200 dark:border-graphite-800\">No goals defined.</div>}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* HABITS TAB */}\r\n                    {activeTab === 'habits' && (\r\n                        <div className=\"max-w-3xl mx-auto animate-in fade-in slide-in-from-right-2 space-y-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <h3 className=\"text-sm font-bold text-graphite-500 uppercase tracking-widest\">Cycle Habits</h3>\r\n                                <button onClick={openAddHabit} className=\"flex items-center gap-2 px-4 py-2 bg-pacific-600 text-white rounded-xl text-xs font-bold hover:bg-pacific-500 shadow-lg shadow-pacific-500/30 transition-colors\">\r\n                                    <Plus size={16} /> Add Habit\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"space-y-3\">\r\n                                {localHabits.map((h) => (\r\n                                    <div key={h.id} className=\"p-4 bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 rounded-2xl flex justify-between items-center group hover:border-pacific-500/30 transition-all shadow-sm\">\r\n                                        <div>\r\n                                            <div className=\"font-bold text-graphite-900 dark:text-white flex items-center gap-2\">\r\n                                                {h.name}\r\n                                                {h.linked_goal_id && <span className=\"text-[10px] uppercase px-2 py-0.5 rounded bg-pacific-50 dark:bg-pacific-900/20 text-pacific-600 dark:text-pacific-400 font-bold flex items-center gap-1\"><AlertTriangle size={10} /> Linked</span>}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-graphite-500 mt-1 flex items-center gap-3\">\r\n                                                <span className=\"bg-graphite-100 dark:bg-graphite-800 px-2 py-0.5 rounded\">{h.category}</span>\r\n                                                <span>Weight: {h.weight}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button onClick={() => openEditHabit(h)} className=\"p-2 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg transition-colors\"><Edit3 size={16} /></button>\r\n                                            <button\r\n                                                onClick={() => handleDeleteItem(h.id, 'habit')}\r\n                                                className={`p-2 rounded-lg transition-all flex items-center gap-2 ${verifyDeleteId === h.id ? 'bg-red-500 text-white w-24 justify-center' : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'}`}\r\n                                            >\r\n                                                <Trash2 size={16} /> {verifyDeleteId === h.id && <span className=\"text-xs font-bold\">Confirm</span>}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {localHabits.length === 0 && <div className=\"text-center py-12 text-graphite-400 italic bg-graphite-50 dark:bg-graphite-950 rounded-2xl border border-dashed border-graphite-200 dark:border-graphite-800\">No habits defined.</div>}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer Actions */}\r\n                <div className=\"p-6 border-t border-graphite-200 dark:border-graphite-800 flex justify-end gap-3 bg-white dark:bg-graphite-900 rounded-b-2xl\">\r\n                    <button onClick={onClose} className=\"px-6 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-900 dark:hover:text-white transition-colors\">Close</button>\r\n                    <button onClick={handleFinalSave} className=\"px-8 py-2 bg-graphite-900 dark:bg-white text-white dark:text-graphite-900 rounded-xl text-sm font-bold shadow-lg hover:opacity-90 transition-opacity flex items-center gap-2\">\r\n                        {mode === 'create' ? <Rocket size={16} /> : <Save size={16} />}\r\n                        {mode === 'create' ? 'Initialize Cycle' : 'Save Cycle Config'}\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Sub-Modals */}\r\n                <GoalFormModal\r\n                    isOpen={isGoalModalOpen}\r\n                    onClose={() => setIsGoalModalOpen(false)}\r\n                    onSave={handleGoalSaveWrapper}\r\n                    initialGoal={editingGoal}\r\n                    allHabits={allHabits}\r\n                    currentCycleHabits={localHabits}\r\n                />\r\n                <HabitFormModal\r\n                    isOpen={isHabitModalOpen}\r\n                    onClose={() => setIsHabitModalOpen(false)}\r\n                    onSave={handleHabitSaveWrapper}\r\n                    initialHabit={editingHabit}\r\n                    allHabits={allHabits}\r\n                    onDeleteFromLibrary={handleDeleteFromLibrary}\r\n                    onRenameCategory={onRenameCategory}\r\n                    onDeleteCategory={onDeleteCategory}\r\n                />\r\n            </div>\r\n        </div>\r\n    )\r\n};\r\n"],"names":["addDaysToDate","dateStr","days","parts","split","map","Number","date","Date","setDate","getDate","year","getFullYear","month","String","getMonth","padStart","day","CycleEditorModal","mode","cycle","goals","habits","allHabits","suggestedSprintNumber","onClose","onSaveCycle","onManageGoal","onManageHabit","onCreate","onRenameCategory","onDeleteCategory","onDeleteHabitFromDB","maxCycles","versionStartDate","existingCycles","activeTab","setActiveTab","sprintNumber","setSprintNumber","startDate","setStartDate","toISOString","endDate","setEndDate","now","isActive","setIsActive","cycleDuration","setCycleDuration","priorities","setPriorities","problems","setProblems","learning","setLearning","beliefs","setBeliefs","characteristics","setCharacteristics","skills","setSkills","selectedMantras","setSelectedMantras","localGoals","setLocalGoals","localHabits","setLocalHabits","allMantras","setAllMantras","tempBelief","setTempBelief","tempChar","setTempChar","tempSkill","setTempSkill","newMantra","setNewMantra","error","setError","editingGoal","setEditingGoal","undefined","isGoalModalOpen","setIsGoalModalOpen","editingHabit","setEditingHabit","isHabitModalOpen","setIsHabitModalOpen","verifyDeleteId","setVerifyDeleteId","getMantras","then","focus_priorities","learning_focus","cch_list","find","c","category","items","mantras","sprint_number","start_date","end_date","initScheduling","settings","getSystemSettings","duration","Math","floor","cycles","suggestedStart","length","sorted","sort","a","b","getTime","lastCycle","handleAddMantra","trim","addMantra","prev","handleAddBelief","handleAddChar","handleAddSkill","handleManualStartDateChange","e","newStart","target","value","handleFinalSave","cycleData","status","ACTIVE","filter","p","handleGoalSaveWrapper","goalData","selectedHabit","newGoalObj","id","linkedHabit","subtasks","s","name","done","g","action","handleHabitSaveWrapper","habitData","newHabitObj","h","handleDeleteFromLibrary","habitId","console","warn","handleDeleteItem","type","setTimeout","openAddGoal","openEditGoal","openAddHabit","openEditHabit","className","onClick","stopPropagation","size","icon","tab","onChange","min","max","val","i","newP","placeholder","rows","title","add","set","section","idx","item","_","j","onKeyDown","key","m","includes","x","TASK_PROJECT","description","linked_goal_id","weight","isOpen","onSave","initialGoal","currentCycleHabits","initialHabit","onDeleteFromLibrary"],"mappings":"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"}},
    {"offset": {"line": 2840, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/20252128/dev/Projects/el-portal/src/app/%28portal%29/database/page.tsx"],"sourcesContent":["\r\n'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { supabaseService } from '@/lib/supabaseService';\r\nimport { Version, Cycle, EntityStatus, Habit, Goal, HabitWeight, GoalType } from '@/types/types';\r\nimport { Database, Search, ArrowUpRight, Trash2, Edit3, X, Save } from 'lucide-react';\r\nimport { GoalFormModal } from '@/components/GoalFormModal';\r\nimport { CycleEditorModal } from '@/components/CycleEditorModal';\r\nimport { HabitFormModal } from '@/components/HabitFormModal';\r\n\r\ntype TabType = 'versions' | 'cycles' | 'habits' | 'goals';\r\n\r\nconst EditModal = ({ isOpen, onClose, type, data, onSave, categories }: {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    type: TabType;\r\n    data: any;\r\n    onSave: (updatedData: any) => void;\r\n    categories?: string[];\r\n}) => {\r\n    const [formData, setFormData] = useState(data);\r\n\r\n    useEffect(() => {\r\n        setFormData(data);\r\n    }, [data]);\r\n\r\n    if (!isOpen || !formData) return null;\r\n\r\n    const handleChange = (field: string, value: any) => {\r\n        setFormData((prev: any) => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const renderFields = () => {\r\n        switch (type) {\r\n            case 'versions':\r\n                return (\r\n                    <>\r\n                        <div className=\"space-y-1\">\r\n                            <label className=\"text-xs font-bold uppercase text-graphite-500\">Title</label>\r\n                            <input className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-lg p-2 text-sm\"\r\n                                value={formData.title} onChange={e => handleChange('title', e.target.value)} />\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                            <label className=\"text-xs font-bold uppercase text-graphite-500\">Description</label>\r\n                            <textarea className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-lg p-2 text-sm\"\r\n                                value={formData.description} onChange={e => handleChange('description', e.target.value)} rows={3} />\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-xs font-bold uppercase text-graphite-500\">Start Date</label>\r\n                                <input type=\"date\" className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-lg p-2 text-sm\"\r\n                                    value={formData.start_date} onChange={e => handleChange('start_date', e.target.value)} />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-xs font-bold uppercase text-graphite-500\">End Date</label>\r\n                                <input type=\"date\" className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-lg p-2 text-sm\"\r\n                                    value={formData.end_date} onChange={e => handleChange('end_date', e.target.value)} />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                            <label className=\"text-xs font-bold uppercase text-graphite-500\">Status</label>\r\n                            <select className=\"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-lg p-2 text-sm\"\r\n                                value={formData.status} onChange={e => handleChange('status', e.target.value)}>\r\n                                <option value={EntityStatus.ACTIVE}>Active</option>\r\n                                <option value={EntityStatus.ARCHIVED}>Archived</option>\r\n                            </select>\r\n                        </div>\r\n                    </>\r\n                );\r\n            case 'cycles':\r\n                // Handled by CycleEditorModal\r\n                return null;\r\n            case 'habits':\r\n                // Handled by HabitFormModal\r\n                return null;\r\n            case 'goals':\r\n                // Handled by GoalFormModal\r\n                return null;\r\n            default: return null;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4\" onClick={onClose}>\r\n            <div className=\"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 p-6 shadow-2xl border border-graphite-200 dark:border-graphite-800 animate-in zoom-in-95 duration-200\" onClick={e => e.stopPropagation()}>\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h2 className=\"text-lg font-bold text-graphite-900 dark:text-white capitalize\">Edit {type.slice(0, -1)}</h2>\r\n                    <button onClick={onClose}><X size={20} className=\"text-graphite-400 hover:text-white\" /></button>\r\n                </div>\r\n                <div className=\"space-y-4 mb-6\">\r\n                    {renderFields()}\r\n                </div>\r\n                <div className=\"flex justify-end gap-3\">\r\n                    <button onClick={onClose} className=\"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-900 dark:hover:text-white\">Cancel</button>\r\n                    <button onClick={() => onSave(formData)} className=\"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 flex items-center gap-2\">\r\n                        <Save size={16} /> Save Changes\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst DatabasePage: React.FC = () => {\r\n    const [versions, setVersions] = useState<Version[]>([]);\r\n    const [cycles, setCycles] = useState<Cycle[]>([]);\r\n    const [habits, setHabits] = useState<Habit[]>([]);\r\n    const [goals, setGoals] = useState<Goal[]>([]);\r\n    const [activeTab, setActiveTab] = useState<TabType>('versions');\r\n    const [verifyDeleteId, setVerifyDeleteId] = useState<string | null>(null);\r\n\r\n    const [editingItem, setEditingItem] = useState<{ type: TabType; data: any } | null>(null);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const v = await supabaseService.getAllVersions();\r\n            const c = await supabaseService.getAllCycles();\r\n            const h = await supabaseService.getAllHabits();\r\n            const g = await supabaseService.getAllGoals();\r\n\r\n            setVersions(v);\r\n            setCycles(c);\r\n            setHabits(h);\r\n            setGoals(g);\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { loadData(); }, []);\r\n\r\n    // Reset delete verification when changing tabs\r\n    useEffect(() => {\r\n        setVerifyDeleteId(null);\r\n    }, [activeTab]);\r\n\r\n    const handleDelete = async (id: string, type: TabType) => {\r\n        // 1. Check if we are verifying this specific ID\r\n        if (verifyDeleteId !== id) {\r\n            setVerifyDeleteId(id);\r\n            // Auto-reset after 3s\r\n            setTimeout(() => setVerifyDeleteId((prev: string | null) => prev === id ? null : prev), 3000);\r\n            return;\r\n        }\r\n\r\n        // 2. Already verifying, perform delete\r\n        try {\r\n            switch (type) {\r\n                case 'versions': await supabaseService.deleteVersion(id); break;\r\n                case 'cycles': await supabaseService.deleteCycle(id); break;\r\n                case 'habits': await supabaseService.deleteHabit(id); break;\r\n                case 'goals': await supabaseService.deleteGoal(id); break;\r\n            }\r\n            setVerifyDeleteId(null);\r\n            loadData();\r\n        } catch (e) {\r\n            console.error(\"Delete failed\", e);\r\n            loadData();\r\n        }\r\n    };\r\n\r\n    const handleEdit = (item: any) => {\r\n        setEditingItem({ type: activeTab, data: item });\r\n    };\r\n\r\n    const handleSaveEdit = async (updatedData: any) => {\r\n        const type = editingItem?.type;\r\n        if (!type) return;\r\n\r\n        switch (type) {\r\n            case 'versions': await supabaseService.updateVersion(updatedData); break;\r\n            case 'cycles': await supabaseService.updateCycle(updatedData); break;\r\n            // Habits and Goals are now handled by specific modals and handlers\r\n        }\r\n        setEditingItem(null);\r\n        loadData();\r\n    };\r\n\r\n    const handleGoalSave = async (goalData: { title: string; description: string; type: GoalType; subtasks?: string[] }, selectedHabit: Habit | null) => {\r\n        if (editingItem?.type !== 'goals' || !editingItem.data) return;\r\n        const originalGoal = editingItem.data as Goal;\r\n        const parsedSubtasks = goalData.subtasks?.map((rawName: string) => {\r\n            const match = rawName.match(/^(\\s*)/);\r\n            const leadingStr = match ? match[1] : '';\r\n            const normalizedIndent = leadingStr.replace(/\\t/g, '  ');\r\n            const level = Math.floor(normalizedIndent.length / 2);\r\n            return { name: rawName.trim(), done: false, level };\r\n        });\r\n\r\n        const updatedGoal: Goal = {\r\n            ...originalGoal,\r\n            title: goalData.title,\r\n            description: goalData.description,\r\n            type: goalData.type,\r\n            subtasks: parsedSubtasks,\r\n            linked_habit_id: selectedHabit?.id\r\n        };\r\n\r\n        await supabaseService.updateGoal(updatedGoal);\r\n        setEditingItem(null);\r\n        loadData();\r\n    };\r\n\r\n    const handleHabitSave = async (habitData: { name: string; category: string; weight: HabitWeight }) => {\r\n        if (editingItem?.type !== 'habits' || !editingItem.data) return;\r\n        const originalHabit = editingItem.data as Habit;\r\n        const updatedHabit: Habit = {\r\n            ...originalHabit,\r\n            name: habitData.name,\r\n            category: habitData.category,\r\n            weight: habitData.weight\r\n        };\r\n        await supabaseService.updateHabit(updatedHabit);\r\n        setEditingItem(null);\r\n        loadData();\r\n    };\r\n\r\n    const handleCycleManageGoal = async (action: 'create' | 'update' | 'delete', payload: any) => {\r\n        if (!editingItem?.data) return;\r\n        if (action === 'delete') {\r\n            await supabaseService.deleteGoal(payload.id);\r\n        } else {\r\n            // Simplified replication of Lab.tsx logic for Database view context\r\n            if (action === 'create') {\r\n                const newGoal: Goal = {\r\n                    id: `g-${crypto.randomUUID()}`,\r\n                    cycle_id: editingItem.data.id,\r\n                    title: payload.title,\r\n                    description: payload.description,\r\n                    type: payload.type,\r\n                    subtasks: payload.subtasks?.map((s: string) => ({ name: s.trim(), done: false, level: 0 })) || []\r\n                };\r\n                await supabaseService.addGoal(newGoal);\r\n            } else {\r\n                const originalGoal = goals.find((g: Goal) => g.id === payload.id);\r\n                if (originalGoal) {\r\n                    const updatedGoal = { ...originalGoal, ...payload };\r\n                    if (payload.subtasks && typeof payload.subtasks[0] === 'string') {\r\n                        updatedGoal.subtasks = payload.subtasks.map((s: string) => ({ name: s.trim(), done: false, level: 0 }));\r\n                    }\r\n                    await supabaseService.updateGoal(updatedGoal);\r\n                }\r\n            }\r\n        }\r\n        loadData();\r\n    };\r\n\r\n    const handleCycleManageHabit = async (action: 'create' | 'update' | 'delete', payload: any) => {\r\n        if (!editingItem?.data) return;\r\n        if (action === 'delete') {\r\n            await supabaseService.deleteHabit(payload.id);\r\n        } else if (action === 'create') {\r\n            const newHabit: Habit = {\r\n                id: `h-${crypto.randomUUID()}`,\r\n                cycle_id: editingItem.data.id,\r\n                name: payload.name,\r\n                category: payload.category,\r\n                weight: payload.weight\r\n            };\r\n            await supabaseService.addHabit(newHabit);\r\n        } else {\r\n            const originalHabit = habits.find((h: Habit) => h.id === payload.id);\r\n            if (originalHabit) {\r\n                await supabaseService.updateHabit({ ...originalHabit, ...payload });\r\n            }\r\n        }\r\n        loadData();\r\n    };\r\n\r\n    // Get unique categories for habits\r\n    const uniqueCategories = Array.from(new Set(habits.map((h: Habit) => h.category))).sort() as string[];\r\n\r\n    // Calculate current cycle habits for goal linking context\r\n    const activeCycle = cycles.find(c => c.status === EntityStatus.ACTIVE) || cycles[cycles.length - 1];\r\n    const currentCycleHabits = activeCycle ? habits.filter(h => h.cycle_id === activeCycle.id) : [];\r\n\r\n    const renderTable = () => {\r\n        let headers: string[] = [];\r\n        let rows: any[] = [];\r\n\r\n        switch (activeTab) {\r\n            case 'versions':\r\n                headers = ['Number', 'Title', 'Status', 'Dates', 'Actions'];\r\n                rows = versions.map((v: Version) => ({\r\n                    id: v.id,\r\n                    data: [\r\n                        <span className=\"font-medium\">v{v.number}.0</span>,\r\n                        v.title,\r\n                        <span className={`px-2 py-1 rounded text-xs font-bold uppercase ${v.status === EntityStatus.ACTIVE ? 'bg-bali-100 text-bali-700 dark:bg-bali-900/30 dark:text-bali-400' : 'bg-graphite-100 text-graphite-500 dark:bg-graphite-800'}`}>{v.status}</span>,\r\n                        <span className=\"text-xs font-mono text-graphite-500\">{v.start_date}  {v.end_date}</span>\r\n                    ],\r\n                    original: v\r\n                }));\r\n                break;\r\n            case 'cycles':\r\n                headers = ['Sprint #', 'Priorities', 'Version Link', 'Dates', 'Actions'];\r\n                rows = cycles.map((c: Cycle) => ({\r\n                    id: c.id,\r\n                    data: [\r\n                        `Cycle ${c.sprint_number}`,\r\n                        <div className=\"flex flex-col gap-1\">{c.focus_priorities.slice(0, 2).map((p: string, i: number) => <span key={i} className=\"text-xs\"> {p}</span>)}</div>,\r\n                        <span className=\"text-xs text-pacific-500 font-mono\">{c.version_id}</span>,\r\n                        <span className=\"text-xs font-mono text-graphite-500\">{c.start_date}  {c.end_date}</span>\r\n                    ],\r\n                    original: c\r\n                }));\r\n                break;\r\n            case 'habits':\r\n                headers = ['Name', 'Category', 'Weight', 'Cycle Link', 'Actions'];\r\n                rows = habits.map((h: Habit) => ({\r\n                    id: h.id,\r\n                    data: [\r\n                        <span className=\"font-medium\">{h.name}</span>,\r\n                        <span className=\"text-xs bg-graphite-100 dark:bg-graphite-800 px-2 py-1 rounded\">{h.category}</span>,\r\n                        <div className=\"flex gap-0.5\">{[...Array(h.weight)].map((_: any, i: number) => <div key={i} className=\"h-1.5 w-1.5 rounded-full bg-pacific-500\" />)}</div>,\r\n                        <span className=\"text-xs text-pacific-500 font-mono\">{h.cycle_id}</span>\r\n                    ],\r\n                    original: h\r\n                }));\r\n                break;\r\n            case 'goals':\r\n                headers = ['Title', 'Type', 'Cycle Link', 'Linked Habit', 'Actions'];\r\n                rows = goals.map((g: Goal) => ({\r\n                    id: g.id,\r\n                    data: [\r\n                        <span className=\"font-medium\">{g.title}</span>,\r\n                        <span className={`text-[10px] font-bold uppercase px-2 py-1 rounded border ${g.type === GoalType.TASK_PROJECT ? 'border-purple-200 text-purple-600 dark:border-purple-900 dark:text-purple-400' : 'border-bali-200 text-bali-600 dark:border-bali-900 dark:text-bali-400'}`}>{g.type === GoalType.TASK_PROJECT ? 'Project' : 'Consistency'}</span>,\r\n                        <span className=\"text-xs text-pacific-500 font-mono\">{g.cycle_id}</span>,\r\n                        g.linked_habit_id ? <span className=\"text-xs font-mono text-graphite-400\">{g.linked_habit_id.slice(0, 8)}...</span> : <span className=\"text-xs text-graphite-300\">-</span>\r\n                    ],\r\n                    original: g\r\n                }));\r\n                break;\r\n        }\r\n\r\n        return (\r\n            <table className=\"w-full text-left text-sm\">\r\n                <thead className=\"bg-graphite-50 dark:bg-graphite-800/50 text-graphite-500 uppercase font-bold text-xs sticky top-0 backdrop-blur-sm\">\r\n                    <tr>\r\n                        {headers.map((h, i) => <th key={i} className=\"px-6 py-3\">{h}</th>)}\r\n                    </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-graphite-200 dark:divide-graphite-800\">\r\n                    {rows.map(row => (\r\n                        <tr key={row.id} className=\"hover:bg-graphite-50 dark:hover:bg-graphite-800/30 transition-colors group\">\r\n                            {row.data.map((cell: any, i: number) => (\r\n                                <td key={i} className=\"px-6 py-4 text-graphite-700 dark:text-graphite-300 align-middle\">\r\n                                    {cell}\r\n                                </td>\r\n                            ))}\r\n                            <td className=\"px-6 py-4\">\r\n                                <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                    <button onClick={() => handleEdit(row.original)} className=\"p-1.5 text-graphite-400 hover:text-pacific-500 hover:bg-pacific-50 dark:hover:bg-pacific-900/20 rounded-lg transition-colors\">\r\n                                        <Edit3 size={16} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDelete(row.id, activeTab)}\r\n                                        className={`p-1.5 rounded-lg transition-all duration-200 flex items-center gap-2 ${verifyDeleteId === row.id\r\n                                            ? 'bg-red-500 text-white px-3 shadow-lg shadow-red-500/30 opacity-100'\r\n                                            : 'text-graphite-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20'\r\n                                            }`}\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                        {verifyDeleteId === row.id && (\r\n                                            <span className=\"text-xs font-bold animate-in fade-in slide-in-from-left-1\">Confirm</span>\r\n                                        )}\r\n                                    </button>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 h-full flex flex-col\">\r\n            <header className=\"flex items-end justify-between border-b border-graphite-200 dark:border-graphite-800 pb-6\">\r\n                <div>\r\n                    <h2 className=\"text-xs font-bold uppercase tracking-widest text-graphite-500 mb-2\">\r\n                        System Records\r\n                    </h2>\r\n                    <h1 className=\"text-3xl font-display font-medium text-graphite-900 dark:text-white flex items-center gap-3\">\r\n                        <Database className=\"text-graphite-400\" />\r\n                        Database View\r\n                    </h1>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex gap-4 border-b border-graphite-200 dark:border-graphite-800\">\r\n                {(['versions', 'cycles', 'habits', 'goals'] as TabType[]).map(tab => (\r\n                    <button\r\n                        key={tab}\r\n                        onClick={() => setActiveTab(tab)}\r\n                        className={`pb-3 text-sm font-bold uppercase tracking-wide transition-colors border-b-2 ${activeTab === tab ? 'border-pacific-500 text-pacific-700 dark:border-pacific-400 dark:text-pacific-400' : 'border-transparent text-graphite-500 hover:text-graphite-700 dark:hover:text-graphite-300'}`}\r\n                    >\r\n                        {tab}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-auto bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 rounded-lg shadow-sm\">\r\n                {renderTable()}\r\n                {(\r\n                    (activeTab === 'versions' && versions.length === 0) ||\r\n                    (activeTab === 'cycles' && cycles.length === 0) ||\r\n                    (activeTab === 'habits' && habits.length === 0) ||\r\n                    (activeTab === 'goals' && goals.length === 0)\r\n                ) && (\r\n                        <div className=\"p-12 text-center text-graphite-400 italic\">No records found in database.</div>\r\n                    )}\r\n            </div>\r\n\r\n            {editingItem && (\r\n                editingItem.type === 'goals' ? (\r\n                    <GoalFormModal\r\n                        isOpen={true}\r\n                        onClose={() => setEditingItem(null)}\r\n                        onSave={handleGoalSave}\r\n                        initialGoal={editingItem.data as Goal}\r\n                        allHabits={habits}\r\n                        currentCycleHabits={currentCycleHabits}\r\n                    />\r\n                ) : editingItem.type === 'cycles' ? (\r\n                    <CycleEditorModal\r\n                        cycle={editingItem.data as Cycle}\r\n                        goals={goals.filter((g: Goal) => g.cycle_id === editingItem.data.id)}\r\n                        habits={habits.filter((h: Habit) => h.cycle_id === editingItem.data.id)}\r\n                        allHabits={habits}\r\n                        onClose={() => setEditingItem(null)}\r\n                        onSaveCycle={handleSaveEdit}\r\n                        onManageGoal={handleCycleManageGoal}\r\n                        onManageHabit={handleCycleManageHabit}\r\n                        onRenameCategory={async (oldName: string, newName: string) => {\r\n                            const all = await supabaseService.getAllHabits();\r\n                            const targets = all.filter((h: Habit) => h.category === oldName);\r\n                            for (const h of targets) await supabaseService.updateHabit({ ...h, category: newName });\r\n                            await loadData();\r\n                        }}\r\n                        onDeleteCategory={async (catName: string) => {\r\n                            const all = await supabaseService.getAllHabits();\r\n                            const targets = all.filter((h: Habit) => h.category === catName);\r\n                            for (const h of targets) await supabaseService.updateHabit({ ...h, category: 'Uncategorized' });\r\n                            await loadData();\r\n                        }}\r\n                    />\r\n                ) : editingItem.type === 'habits' ? (\r\n                    <HabitFormModal\r\n                        isOpen={true}\r\n                        onClose={() => setEditingItem(null)}\r\n                        onSave={handleHabitSave}\r\n                        initialHabit={editingItem.data as Habit}\r\n                        allHabits={habits}\r\n                        onDeleteFromLibrary={(id: string) => handleDelete(id, 'habits')}\r\n                        onRenameCategory={async (oldName: string, newName: string) => {\r\n                            const all = await supabaseService.getAllHabits();\r\n                            const targets = all.filter((h: Habit) => h.category === oldName);\r\n                            for (const h of targets) await supabaseService.updateHabit({ ...h, category: newName });\r\n                            await loadData();\r\n                        }}\r\n                        onDeleteCategory={async (catName: string) => {\r\n                            const all = await supabaseService.getAllHabits();\r\n                            const targets = all.filter((h: Habit) => h.category === catName);\r\n                            for (const h of targets) await supabaseService.updateHabit({ ...h, category: 'Uncategorized' });\r\n                            await loadData();\r\n                        }}\r\n                    />\r\n                ) : (\r\n                    <EditModal\r\n                        isOpen={!!editingItem}\r\n                        onClose={() => setEditingItem(null)}\r\n                        type={editingItem.type}\r\n                        data={editingItem.data}\r\n                        onSave={handleSaveEdit}\r\n                        categories={uniqueCategories}\r\n                    />\r\n                )\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DatabasePage;\r\n"],"names":["EditModal","isOpen","onClose","type","data","onSave","categories","formData","setFormData","handleChange","field","value","prev","renderFields","className","title","onChange","e","target","description","rows","start_date","end_date","status","ACTIVE","ARCHIVED","onClick","stopPropagation","slice","size","DatabasePage","versions","setVersions","cycles","setCycles","habits","setHabits","goals","setGoals","activeTab","setActiveTab","verifyDeleteId","setVerifyDeleteId","editingItem","setEditingItem","loadData","v","getAllVersions","c","getAllCycles","h","getAllHabits","g","getAllGoals","err","console","error","handleDelete","id","setTimeout","deleteVersion","deleteCycle","deleteHabit","deleteGoal","handleEdit","item","handleSaveEdit","updatedData","updateVersion","updateCycle","handleGoalSave","goalData","selectedHabit","originalGoal","parsedSubtasks","subtasks","map","rawName","match","leadingStr","normalizedIndent","replace","level","Math","floor","length","name","trim","done","updatedGoal","linked_habit_id","updateGoal","handleHabitSave","habitData","originalHabit","updatedHabit","category","weight","updateHabit","handleCycleManageGoal","action","payload","newGoal","crypto","randomUUID","cycle_id","s","addGoal","find","handleCycleManageHabit","newHabit","addHabit","uniqueCategories","Array","from","Set","sort","activeCycle","currentCycleHabits","filter","renderTable","headers","number","original","sprint_number","focus_priorities","p","i","version_id","_","TASK_PROJECT","row","cell","tab","initialGoal","allHabits","cycle","onSaveCycle","onManageGoal","onManageHabit","onRenameCategory","oldName","newName","all","targets","onDeleteCategory","catName","initialHabit","onDeleteFromLibrary"],"mappings":"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"}}]
}