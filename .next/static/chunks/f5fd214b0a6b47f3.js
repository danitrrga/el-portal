(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,64659,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},58377,64030,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);e.s(["Flame",()=>a],58377);let r=(0,t.default)("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);e.s(["Trophy",()=>r],64030)},67585,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let r=e.r(32061);function s({reason:e,children:t}){if("u"<typeof window)throw Object.defineProperty(new r.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,a)=>{"use strict";function r(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"encodeURIPath",{enumerable:!0,get:function(){return r}})},52157,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"PreloadChunks",{enumerable:!0,get:function(){return d}});let r=e.r(18050),s=e.r(74080),i=e.r(63599),l=e.r(9885),n=e.r(43369);function d({moduleIds:e}){if("u">typeof window)return null;let t=i.workAsyncStorage.getStore();if(void 0===t)return null;let a=[];if(t.reactLoadableManifest&&e){let r=t.reactLoadableManifest;for(let t of e){if(!r[t])continue;let e=r[t].files;a.push(...e)}}if(0===a.length)return null;let d=(0,n.getDeploymentIdQueryOrEmptyString)();return(0,r.jsx)(r.Fragment,{children:a.map(e=>{let a=`${t.assetPrefix}/_next/${(0,l.encodeURIPath)(e)}${d}`;return e.endsWith(".css")?(0,r.jsx)("link",{precedence:"dynamic",href:a,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,s.preload)(a,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return c}});let r=e.r(18050),s=e.r(71645),i=e.r(67585),l=e.r(52157);function n(e){return{default:e&&"default"in e?e.default:e}}let d={loader:()=>Promise.resolve(n(()=>null)),loading:null,ssr:!0},c=function(e){let t={...d,...e},a=(0,s.lazy)(()=>t.loader().then(n)),c=t.loading;function o(e){let n=c?(0,r.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,d=!t.ssr||!!t.loading,o=d?s.Suspense:s.Fragment,p=t.ssr?(0,r.jsxs)(r.Fragment,{children:["u"<typeof window?(0,r.jsx)(l.PreloadChunks,{moduleIds:t.modules}):null,(0,r.jsx)(a,{...e})]}):(0,r.jsx)(i.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(a,{...e})});return(0,r.jsx)(o,{...d?{fallback:n}:{},children:p})}return o.displayName="LoadableComponent",o}},70703,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return s}});let r=e.r(55682)._(e.r(69093));function s(e,t){let a={};"function"==typeof e&&(a.loader=e);let s={...a,...t};return(0,r.default)({...s,modules:s.loadableGenerated?.modules})}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},55900,16715,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>a],55900);let r=(0,t.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>r],16715)},52008,e=>{"use strict";let t=(0,e.i(75254).default)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);e.s(["Layers",()=>t],52008)},40316,e=>{"use strict";var t=e.i(18050),a=e.i(71645),r=e.i(52008),s=e.i(87316),i=e.i(8442),l=e.i(73375),n=e.i(63059),d=e.i(37727);let c=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),o=({label:e,value:r,onChange:i})=>{let[o,p]=(0,a.useState)(!1),[h,x]=(0,a.useState)(()=>{if(r){let e=r.split("-").map(Number);if(3===e.length&&!isNaN(e[0]))return new Date(e[0],e[1]-1,e[2])}return new Date}),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{if(r){let e=r.split("-").map(Number),t=new Date(e[0],e[1]-1,e[2]);isNaN(t.getTime())||t.getMonth()===h.getMonth()&&t.getFullYear()===h.getFullYear()||x(t)}},[r]);let u=e=>{let t=new Date(h);t.setMonth(t.getMonth()+e),x(t)},m=(()=>{let e=h.getFullYear(),t=h.getMonth(),a=new Date(e,t,1).getDay(),r=new Date(e,t+1,0).getDate(),s=new Date(e,t,0).getDate(),i=[];for(let e=a-1;e>=0;e--)i.push({day:s-e,type:"prev"});for(let e=1;e<=r;e++)i.push({day:e,type:"current"});let l=42-i.length;for(let e=1;e<=l;e++)i.push({day:e,type:"next"});return i})();return(0,t.jsxs)("div",{className:"relative",ref:g,children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:e}),(0,t.jsxs)("button",{type:"button",onClick:()=>p(!o),className:`w-full flex items-center justify-between rounded-xl bg-graphite-50 dark:bg-graphite-800 border p-3 text-sm transition-all
          ${o?"border-pacific-500 ring-2 ring-pacific-500/20":"border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/50"}
          ${r?"text-graphite-900 dark:text-white":"text-graphite-400"}
        `,children:[(0,t.jsx)("span",{className:"font-medium",children:(e=>{if(!e)return"Select Date";let t=e.split("-").map(Number),a=new Date(t[0],t[1]-1,t[2]);return isNaN(a.getTime())?"Select Date":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})(r)}),(0,t.jsx)(s.Calendar,{size:16,className:"text-pacific-500"})]}),o&&(0,t.jsxs)("div",{className:"absolute top-full left-0 mt-2 w-full min-w-[300px] bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-700 rounded-xl shadow-2xl z-50 p-4 animate-in fade-in zoom-in-95 duration-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>u(-1),className:"p-1 hover:bg-graphite-100 dark:hover:bg-graphite-800 rounded-lg text-graphite-500 dark:text-graphite-400 transition-colors",children:(0,t.jsx)(l.ChevronLeft,{size:20})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-graphite-900 dark:text-white",children:[["January","February","March","April","May","June","July","August","September","October","November","December"][h.getMonth()]," ",h.getFullYear()]}),(0,t.jsx)("button",{type:"button",onClick:()=>u(1),className:"p-1 hover:bg-graphite-100 dark:hover:bg-graphite-800 rounded-lg text-graphite-500 dark:text-graphite-400 transition-colors",children:(0,t.jsx)(n.ChevronRight,{size:20})})]}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>(0,t.jsx)("div",{className:"text-center text-[10px] font-bold text-graphite-400 uppercase",children:e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1",children:m.map((e,a)=>{var s,l;let n,d,c;return(0,t.jsx)("button",{type:"button",onClick:()=>{var t,a;let r,s,l,n,d,c;return t=e.day,a=e.type,s=h.getFullYear(),l=h.getMonth(),n=(r="prev"===a?new Date(s,l-1,t):"next"===a?new Date(s,l+1,t):new Date(s,l,t)).getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0"),void(i(`${n}-${d}-${c}`),p(!1),x(r))},className:`
                  aspect-square flex items-center justify-center rounded-lg text-sm font-medium transition-all
                  ${((e,t)=>{if(!r)return!1;let a=r.split("-").map(Number),s=new Date(a[0],a[1]-1,a[2]);if(isNaN(s.getTime()))return!1;let i=h.getFullYear(),l=h.getMonth();return("prev"===t?new Date(i,l-1,e):"next"===t?new Date(i,l+1,e):new Date(i,l,e)).getTime()===s.getTime()})(e.day,e.type)?"bg-pacific-500 text-white shadow-lg shadow-pacific-500/30":(s=e.day,l=e.type,(n=new Date).setHours(0,0,0,0),d=h.getFullYear(),c=h.getMonth(),("prev"===l?new Date(d,c-1,s):"next"===l?new Date(d,c+1,s):new Date(d,c,s)).getTime()===n.getTime())?"text-pacific-500 font-bold bg-pacific-50 dark:bg-pacific-900/10 hover:bg-pacific-100 dark:hover:bg-pacific-900/30":"current"===e.type?"text-graphite-700 dark:text-graphite-300 hover:bg-graphite-100 dark:hover:bg-graphite-800":"text-graphite-400/30 dark:text-graphite-600/30 hover:bg-graphite-50 dark:hover:bg-graphite-800/50"}
                `,children:e.day},a)})}),(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-graphite-100 dark:border-graphite-800 flex items-center justify-between px-1",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>{i(""),p(!1)},className:"flex items-center gap-1.5 text-xs font-bold text-graphite-400 hover:text-red-500 transition-colors",children:[(0,t.jsx)(d.X,{size:14})," Clear"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");i(`${t}-${a}-${r}`),x(e),p(!1)},className:"flex items-center gap-1.5 text-xs font-bold text-pacific-600 dark:text-pacific-400 hover:text-pacific-500 transition-colors",children:[(0,t.jsx)(c,{size:14})," Today"]})]})]})]})};e.s(["NewVersionModal",0,({onClose:e,onCreate:l,suggestedNumber:n})=>{let[d,c]=(0,a.useState)(""),[p,h]=(0,a.useState)(""),[x,g]=(0,a.useState)(n),[u,m]=(0,a.useState)(new Date().toISOString().split("T")[0]),[f,b]=(0,a.useState)(90),[y,j]=(0,a.useState)("");return(0,a.useEffect)(()=>{i.supabaseService.getSystemSettings().then(e=>{b(e.days)})},[]),(0,a.useEffect)(()=>{if(!u)return void j("-");let e=new Date(u);if(isNaN(e.getTime()))return void j("-");let t=new Date(e);t.setDate(e.getDate()+f),j(t.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"}))},[u,f]),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4",onClick:e,children:(0,t.jsxs)("div",{className:"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 p-8 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("h2",{className:"mb-6 text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-2 bg-pacific-100 text-pacific-600 rounded-lg",children:(0,t.jsx)(r.Layers,{size:20})}),"Initialize New Version"]}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:"Version ID"}),(0,t.jsx)("input",{type:"number",value:x,onChange:e=>g(Number(e.target.value)),className:"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(o,{label:"Start Date",value:u,onChange:m})})]}),(0,t.jsxs)("div",{className:"p-3 bg-graphite-50 dark:bg-graphite-800/50 rounded-xl border border-graphite-200 dark:border-graphite-700 flex items-center gap-3",children:[(0,t.jsx)(s.Calendar,{size:16,className:"text-pacific-500"}),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("span",{className:"text-graphite-500 uppercase font-bold tracking-wider",children:"Projected End: "}),(0,t.jsx)("span",{className:"text-graphite-900 dark:text-white font-mono",children:y}),(0,t.jsxs)("span",{className:"block text-[10px] text-graphite-400 mt-0.5",children:["Based on system tempo of ",f," days."]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:"Identity Title"}),(0,t.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"e.g., The Architect",className:"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:"Persona Definition"}),(0,t.jsx)("textarea",{value:p,onChange:e=>h(e.target.value),placeholder:"Define the archetype...",rows:3,className:"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all resize-none"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-6",children:[(0,t.jsx)("button",{onClick:e,type:"button",className:"rounded-xl px-4 py-2 text-sm font-medium text-graphite-500 hover:text-graphite-800 dark:hover:text-graphite-200 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:()=>{l({title:d,description:p,number:x,startDate:u})},type:"button",className:"rounded-xl bg-pacific-600 px-6 py-2.5 text-sm font-bold text-white hover:bg-pacific-500 transition-colors shadow-lg shadow-pacific-500/30",children:"Initialize Version"})]})]})]})})}],40316)},93798,e=>{"use strict";var t=e.i(18050),a=e.i(71645),r=e.i(8442),s=e.i(73986),i=e.i(20278),l=e.i(64659),n=e.i(55900),d=e.i(43531),c=e.i(16715),o=e.i(25652),p=e.i(7233),h=e.i(87316),x=e.i(52008),g=e.i(58377),u=e.i(64030);let m=(0,e.i(75254).default)("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);var f=e.i(59607),b=e.i(70703),y=e.i(40316);let j=({value:e,max:a,label:r,sublabel:s,color:i="pacific",size:l="md"})=>{let n=a>0?Math.min(100,Math.max(0,e/a*100)):0,d="sm"===l?36:44,c="sm"===l?6:8,o=2*Math.PI*d,p=.75*o,h="sm"===l?100:120;return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsxs)("div",{className:"relative",style:{width:h,height:.75*h},children:[(0,t.jsxs)("svg",{className:"transform",viewBox:`0 0 ${h} ${.85*h}`,style:{width:"100%",height:"100%"},children:[(0,t.jsx)("circle",{cx:h/2,cy:h/2,r:d,stroke:"currentColor",strokeWidth:c,fill:"transparent",strokeLinecap:"round",strokeDasharray:`${p} ${o}`,strokeDashoffset:0,className:"text-graphite-100 dark:text-graphite-800",transform:`rotate(135 ${h/2} ${h/2})`}),(0,t.jsx)("circle",{cx:h/2,cy:h/2,r:d,stroke:"currentColor",strokeWidth:c,fill:"transparent",strokeLinecap:"round",strokeDasharray:`${p} ${o}`,strokeDashoffset:p*(1-n/100),className:`${"pacific"===i?"text-pacific-500":"text-bali-500"} ${"pacific"===i?"drop-shadow-[0_0_8px_rgba(14,165,233,0.4)]":"drop-shadow-[0_0_8px_rgba(16,185,129,0.4)]"} transition-all duration-700 ease-out`,transform:`rotate(135 ${h/2} ${h/2})`})]}),(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",style:{paddingTop:"sm"===l?"8px":"12px"},children:[(0,t.jsxs)("span",{className:`font-display font-bold text-graphite-900 dark:text-white tracking-tight ${"sm"===l?"text-2xl":"text-3xl"}`,children:["number"==typeof e&&e%1==0?e:Math.round(e),(r.includes("%"),"")]}),s&&(0,t.jsx)("span",{className:"text-[8px] font-bold uppercase text-graphite-400 mt-0.5",children:s})]})]}),(0,t.jsx)("div",{className:"text-[10px] font-bold uppercase tracking-widest text-graphite-500 mt-1 text-center",children:r})]})},v=(0,b.default)(()=>e.A(78098).then(e=>({default:e.PerformanceChart})),{loadableGenerated:{modules:[81434]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-full w-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin",children:(0,t.jsx)(c.RefreshCw,{size:24,className:"text-graphite-400"})})})});e.s(["default",0,()=>{let[e,c]=(0,a.useState)(null),[b,k]=(0,a.useState)([]),[w,N]=(0,a.useState)(!0),[S,D]=(0,a.useState)(0),[C,M]=(0,a.useState)(new Set),[T,$]=(0,a.useState)("week"),[_,L]=(0,a.useState)(new Set),[z,P]=(0,a.useState)(!1),O=async()=>{try{await r.supabaseService.seedDefaultArchives();let e=await r.supabaseService.getDashboardData(),t=await r.supabaseService.getHistoryData();c(e),k(t.dailyScores),console.log("Dashboard Data Loaded:",e),console.log("History Data Loaded:",t.dailyScores),D(r.supabaseService.calculateDailyScore(e.habits,e.todayLogs)),N(!1)}catch(e){console.error(e),N(!1)}};(0,a.useEffect)(()=>{O()},[]);let E=async(t,a)=>{if(!e||C.has(t))return;let s=!a;M(e=>new Set(e).add(t));try{let a=s?[...e.todayLogs,{id:"temp",habit_id:t,date:"",status:!0}]:e.todayLogs.filter(e=>e.habit_id!==t);c({...e,todayLogs:a});let i=r.supabaseService.calculateDailyScore(e.habits,a);D(i);let l=r.supabaseService.getLocalDateString();k(e=>e.map(e=>e.date===l?{...e,score:i}:e)),await r.supabaseService.toggleHabit(t,s);let n=await r.supabaseService.getDashboardData();c(n),D(r.supabaseService.calculateDailyScore(n.habits,n.todayLogs))}catch(e){console.error("Error toggling habit:",e),await O()}finally{M(e=>{let a=new Set(e);return a.delete(t),a})}},A=async(t,a)=>{if(!e)return;let s=e.goals.findIndex(e=>e.id===t);if(-1===s)return;let i=e.goals[s];if(!i.subtasks||!Array.isArray(i.subtasks))return;let l=[...i.subtasks];l[a]={...l[a],done:!l[a].done};let n={...i,subtasks:l},d=[...e.goals];d[s]=n,c({...e,goals:d}),await r.supabaseService.updateGoal(n)},R=async e=>{await r.supabaseService.createVersion(e),P(!1),O()};if(w||!e)return(0,t.jsx)("div",{className:"flex h-full items-center justify-center text-sm font-medium text-graphite-400",children:"Initializing Portal..."});let F=(()=>{if(!e.cycle)return{percent:0,daysLeft:0,totalDays:30};let t=new Date(e.cycle.start_date).getTime(),a=new Date(e.cycle.end_date).getTime(),r=new Date().getTime(),s=a-t;return{percent:s>0?Math.min(100,Math.max(0,(r-t)/s*100)):0,daysLeft:Math.max(0,Math.ceil((a-r)/864e5)),totalDays:Math.ceil(s/864e5)}})(),I=e=>{if(!e)return"";let t=new Date(e),a=t.toLocaleString("en-US",{month:"short"}).toUpperCase(),r=t.getDate().toString().padStart(2,"0");return`${a} ${r}`},H=(()=>{let t=new Date;if(t.setHours(0,0,0,0),"week"===T){let e=t.getDay(),a=new Date(t);a.setDate(t.getDate()+(0===e?-6:1-e));let s=[];for(let e=0;e<7;e++){let t=new Date(a);t.setDate(a.getDate()+e),s.push(r.supabaseService.getLocalDateString(t))}return s.map(e=>b.find(t=>t.date===e)||{date:e,score:0})}if("30d"===T)return[...b].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).slice(0,30).reverse();{if(!e.cycle)return[...b].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).slice(0,14).reverse();let t=e.cycle.start_date,a=e.cycle.end_date;return[...b.filter(e=>e.date>=t&&e.date<=a)].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}})(),U=e.goals.filter(t=>t.type===s.GoalType.TASK_PROJECT&&t.cycle_id===e.cycle?.id),Y=e.cycle?.learning_focus?e.cycle.learning_focus.split(/[,\n]/).map(e=>e.trim()).filter(Boolean):[],B=({weight:e,isDone:a})=>(0,t.jsx)("div",{className:"flex gap-0.5",title:`Importance: ${e}`,children:[...Array(e)].map((e,r)=>(0,t.jsx)("div",{className:`h-1.5 w-2.5 rounded-full transition-colors duration-300 ${a?"bg-bali-500":"bg-graphite-400 dark:bg-graphite-600"}`},r))});return(0,t.jsxs)("div",{className:"flex flex-col gap-5 h-full",children:[(0,t.jsxs)("header",{className:"flex flex-col md:flex-row md:items-end justify-between gap-3 border-b border-graphite-200 dark:border-graphite-800 pb-4 flex-shrink-0",children:[e.version?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,t.jsxs)("span",{className:"inline-flex items-center rounded-md bg-pacific-500/10 border border-pacific-500/20 px-2.5 py-0.5 text-[10px] font-bold text-pacific-600 dark:text-pacific-400 uppercase tracking-wider",children:["Version ",e.version.number,".0"]}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-graphite-400 uppercase tracking-wider",children:"Active"})]}),(0,t.jsx)("h1",{className:"text-2xl font-display font-bold text-graphite-900 dark:text-white tracking-tight leading-none",children:e.version.title}),(0,t.jsx)("p",{className:"mt-1.5 text-xs text-graphite-500 dark:text-graphite-400 max-w-2xl leading-snug line-clamp-1",children:e.version.description})]}):(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-graphite-400",children:[(0,t.jsx)("div",{className:"p-2 bg-graphite-100 dark:bg-graphite-800 rounded-lg",children:(0,t.jsx)(x.Layers,{size:20})}),(0,t.jsx)("h1",{className:"text-lg font-bold text-graphite-900 dark:text-white",children:"System Standby"})]}),(0,t.jsxs)("button",{onClick:()=>P(!0),className:"px-4 py-2 bg-pacific-600 text-white text-xs font-bold rounded-xl hover:bg-pacific-500 transition-colors shadow-lg shadow-pacific-500/20 flex items-center gap-2",children:[(0,t.jsx)(p.Plus,{size:14})," Initialize Version 1.0"]})]}),e.version&&(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[e.cycle?(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full bg-pacific-500 animate-pulse"}),(0,t.jsxs)("span",{className:"text-[10px] font-bold uppercase text-graphite-500 dark:text-graphite-400 tracking-wider",children:["Cycle ",e.cycle.sprint_number," Active"]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,t.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase text-graphite-500 dark:text-graphite-400 tracking-wider",children:"No Active Cycle"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2.5 text-[11px] font-mono font-medium text-graphite-500",children:[(0,t.jsx)("span",{children:I(e.cycle?.start_date||"")}),(0,t.jsx)("span",{className:"text-graphite-300 dark:text-graphite-600",children:"â†’"}),(0,t.jsx)("span",{className:"text-pacific-500 font-bold",children:I(e.cycle?.end_date||"")})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-5 flex-shrink-0",children:[(0,t.jsxs)("div",{className:"lg:col-span-4 rounded-2xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 p-4 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h3",{className:"text-[10px] font-bold text-graphite-500 uppercase tracking-widest flex items-center gap-1.5",children:[(0,t.jsx)(h.Calendar,{size:12})," HABIT TRACKER"]}),(0,t.jsxs)("span",{className:"text-[10px] font-mono text-graphite-400",children:[e.todayLogs.filter(e=>e.status).length,"/",e.habits.length]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[e.habits.map(a=>{let r=e.todayLogs.some(e=>e.habit_id===a.id&&e.status),s=e.habitStats[a.id]||{currentStreak:0,maxStreak:0},i=C.has(a.id);return(0,t.jsx)("div",{onClick:()=>!i&&E(a.id,r),className:`group relative rounded-xl p-3 transition-all duration-300 border
                      ${i?"cursor-wait opacity-60":"cursor-pointer"}
                      ${r?"bg-bali-500/10 border-bali-500/30":"bg-graphite-50 dark:bg-graphite-800/50 border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/50 hover:shadow-sm"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2.5 min-w-0",children:[(0,t.jsx)("div",{className:`h-5 w-5 flex-shrink-0 rounded-md flex items-center justify-center transition-all duration-300 border ${r?"bg-bali-500 border-bali-500 text-white shadow-sm shadow-bali-500/30":"bg-transparent border-graphite-300 dark:border-graphite-600 text-transparent group-hover:border-pacific-400"}`,children:(0,t.jsx)(d.Check,{size:12,strokeWidth:3})}),(0,t.jsx)("span",{className:`text-sm font-semibold transition-colors truncate ${r?"text-bali-600 dark:text-bali-400 line-through decoration-bali-500/30":"text-graphite-700 dark:text-graphite-200"}`,children:a.name})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,t.jsx)(B,{weight:a.weight,isDone:r}),(0,t.jsxs)("div",{className:"flex items-center gap-2 opacity-70",children:[(0,t.jsxs)("div",{className:"flex items-center gap-0.5",title:"Current Streak",children:[(0,t.jsx)(g.Flame,{size:11,className:s.currentStreak>0?"text-orange-500":"text-graphite-400"}),(0,t.jsx)("span",{className:`text-[10px] font-bold ${s.currentStreak>0?"text-graphite-600 dark:text-graphite-300":"text-graphite-400"}`,children:s.currentStreak})]}),(0,t.jsxs)("div",{className:"flex items-center gap-0.5",title:"Best Streak",children:[(0,t.jsx)(u.Trophy,{size:11,className:s.maxStreak>0?"text-yellow-500":"text-graphite-400"}),(0,t.jsx)("span",{className:`text-[10px] font-bold ${s.maxStreak>0?"text-graphite-600 dark:text-graphite-300":"text-graphite-400"}`,children:s.maxStreak})]})]})]})]})},a.id)}),0===e.habits.length&&(0,t.jsx)("div",{className:"text-center py-8 text-xs text-graphite-400 italic",children:"No habits defined for this cycle."})]})]}),(0,t.jsxs)("div",{className:"lg:col-span-2 flex flex-col gap-4",children:[(0,t.jsx)("div",{className:"aspect-square rounded-2xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 shadow-sm flex items-center justify-center",children:(0,t.jsx)(j,{value:S,max:100,label:"Efficiency",color:"pacific",size:"sm"})}),(0,t.jsx)("div",{className:"aspect-square rounded-2xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 shadow-sm flex items-center justify-center",children:(0,t.jsx)(j,{value:F.daysLeft,max:F.totalDays,label:`Cycle ${e.cycle?.sprint_number||"-"}`,sublabel:"Days Left",color:"bali",size:"sm"})})]}),(0,t.jsxs)("div",{className:"lg:col-span-3 rounded-2xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 p-4 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsxs)("h3",{className:"text-[10px] font-bold text-graphite-500 uppercase tracking-widest flex items-center gap-1.5",children:[(0,t.jsx)(i.Target,{size:12})," CYCLE GOALS"]})}),(0,t.jsxs)("div",{className:"space-y-2.5",children:[U.map(e=>{let a=_.has(e.id),r=e.subtasks||[],s=r.filter(e=>e.done).length,i=r.length,c=i>0?s/i*100:0,o=i>0&&s===i;return(0,t.jsxs)("div",{className:`group relative rounded-xl border transition-all duration-300 overflow-hidden ${a||o?"bg-bali-500/10 border-bali-500/30":"bg-graphite-50 dark:bg-graphite-800/50 border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/50"}`,children:[(0,t.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-graphite-100 dark:bg-graphite-800/50",children:(0,t.jsx)("div",{className:`h-full transition-all duration-500 ${o?"bg-bali-500":"bg-pacific-500"}`,style:{width:`${c}%`}})}),(0,t.jsxs)("div",{className:"p-3 pt-3.5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("h3",{className:`text-xs font-bold leading-tight flex-1 ${o?"text-bali-600 dark:text-bali-400 line-through":"text-graphite-900 dark:text-white"}`,children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,t.jsxs)("span",{className:"text-[10px] font-mono font-bold text-graphite-400",children:[Math.round(c),"%"]}),(0,t.jsx)("button",{onClick:()=>{var t;let a;return t=e.id,void((a=new Set(_)).has(t)?a.delete(t):a.add(t),L(a))},className:"p-1 rounded-md hover:bg-graphite-100 dark:hover:bg-graphite-700 transition-colors",children:a?(0,t.jsx)(n.ChevronUp,{size:14,className:"text-graphite-400"}):(0,t.jsx)(l.ChevronDown,{size:14,className:"text-graphite-400"})})]})]}),a&&(0,t.jsx)("div",{className:"pt-2.5 border-t border-graphite-100 dark:border-graphite-700 space-y-2 mt-2.5",children:r.length>0?r.map((a,r)=>(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("button",{onClick:()=>A(e.id,r),className:`mt-0.5 h-4 w-4 rounded border flex items-center justify-center transition-all flex-shrink-0 ${a.done?"bg-pacific-500 border-pacific-500 text-white":"border-graphite-300 dark:border-graphite-600 hover:border-pacific-400"}`,children:a.done&&(0,t.jsx)(d.Check,{size:10,strokeWidth:3})}),(0,t.jsx)("span",{className:`text-xs leading-snug cursor-pointer ${a.done?"text-graphite-400 line-through":"text-graphite-600 dark:text-graphite-300"}`,onClick:()=>A(e.id,r),children:a.name})]},r)):(0,t.jsx)("div",{className:"text-center py-2 text-[10px] text-graphite-400 italic",children:"No subtasks defined"})})]})]},e.id)}),0===U.length&&(0,t.jsx)("div",{className:"text-center py-8 text-xs text-graphite-400 italic",children:"No cycle goals defined."})]})]}),(0,t.jsxs)("div",{className:"lg:col-span-3 flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 p-3.5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mb-2.5",children:[(0,t.jsx)(m,{size:13,className:"text-pacific-500"}),(0,t.jsx)("h3",{className:"text-[10px] font-bold uppercase tracking-widest text-graphite-500",children:"Learning Focus"})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5",children:Y.length>0?Y.map((e,a)=>(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-pacific-500/10 border border-pacific-500/20 text-[11px] font-medium text-pacific-600 dark:text-pacific-400",children:e},a)):(0,t.jsx)("span",{className:"text-[10px] text-graphite-400 italic",children:"Not defined"})})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 p-3.5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mb-2.5",children:[(0,t.jsx)(i.Target,{size:13,className:"text-bali-500"}),(0,t.jsx)("h3",{className:"text-[10px] font-bold uppercase tracking-widest text-graphite-500",children:"Focus Priorities"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[e.cycle?.focus_priorities?.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsx)("span",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-md bg-bali-500/10 text-[10px] font-bold text-bali-500",children:a+1}),(0,t.jsx)("span",{className:"text-xs font-medium text-graphite-700 dark:text-graphite-300 leading-snug",children:e})]},a)),!e.cycle?.focus_priorities?.length&&(0,t.jsx)("div",{className:"text-[10px] text-graphite-400 italic",children:"Not defined"})]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-red-50 dark:bg-red-900/10 border border-red-200/50 dark:border-red-900/30 p-3.5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mb-2",children:[(0,t.jsx)(f.AlertTriangle,{size:13,className:"text-red-500"}),(0,t.jsx)("h3",{className:"text-[10px] font-bold uppercase tracking-widest text-red-500 dark:text-red-400",children:"Friction"})]}),e.cycle?.problems?(0,t.jsxs)("p",{className:"text-xs italic text-red-700 dark:text-red-300/80 leading-relaxed",children:['"',e.cycle.problems,'"']}):(0,t.jsx)("p",{className:"text-[10px] text-graphite-400 italic",children:"No friction defined"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-800 p-6 shadow-sm flex-1 min-h-[350px] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[(0,t.jsxs)("span",{className:"text-[11px] font-bold uppercase text-graphite-500 flex items-center gap-2",children:[(0,t.jsx)(o.TrendingUp,{size:14})," Progress Chart"]}),(0,t.jsx)("div",{className:"flex gap-1 bg-graphite-100 dark:bg-graphite-800 p-1 rounded-xl",children:["week","30d","cycle"].map(e=>(0,t.jsx)("button",{onClick:()=>$(e),className:`px-3 py-1 text-[10px] font-bold rounded-lg transition-all ${T===e?"bg-white dark:bg-graphite-700 text-pacific-600 dark:text-pacific-400 shadow-sm":"text-graphite-400 hover:text-graphite-600 dark:hover:text-graphite-200"}`,children:"week"===e?"WEEK":"30d"===e?"30 DAYS":"CYCLE"},e))})]}),(0,t.jsx)("div",{className:"flex-1 min-h-[300px] w-full relative",children:(0,t.jsx)(v,{data:H,className:"h-full w-full absolute inset-0"})})]}),z&&(0,t.jsx)(y.NewVersionModal,{onClose:()=>P(!1),onCreate:R,suggestedNumber:1})]})}],93798)},78098,e=>{e.v(t=>Promise.all(["static/chunks/b96777c3350d1b25.js"].map(t=>e.l(t))).then(()=>t(81434)))}]);