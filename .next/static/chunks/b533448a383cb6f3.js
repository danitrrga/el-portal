(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75254,e=>{"use strict";var t=e.i(71645),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};e.s(["default",0,(e,i)=>{let s=(0,t.forwardRef)(({color:s="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:n="",children:o,...c},u)=>(0,t.createElement)("svg",{ref:u,...a,width:r,height:r,stroke:s,strokeWidth:d?24*Number(l)/Number(r):l,className:["lucide",`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,n].join(" "),...c},[...i.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(o)?o:[o]]));return s.displayName=`${e}`,s}],75254)},8442,73986,e=>{"use strict";var t,a,i,s,r,l=e.i(7471),d=((t={}).ACTIVE="active",t.ARCHIVED="archived",t),n=((a={})[a.LOW=1]="LOW",a[a.MEDIUM=2]="MEDIUM",a[a.HIGH=4]="HIGH",a),o=((i={}).TASK_PROJECT="task_project",i.CONSISTENCY_METRIC="consistency_metric",i),c=((s={}).ROUTINE="routine",s.VISION_5Y="vision_5y",s.LIFE_TODO="life_todo",s.MANTRA_BANK="mantra_bank",s.THEORY_NOTES="theory_notes",s),u=((r={}).ME="Me",r.HER="Her",r.PURPOSE="Purpose",r.SOCIAL="Social",r.MATERIAL="Material",r);e.s(["ArchiveType",()=>c,"EntityStatus",()=>d,"GoalType",()=>o,"HabitWeight",()=>n,"SlideCategory",()=>u],73986);let p=new class{async getUserId(){let{data:{session:e}}=await l.supabase.auth.getSession();if(!e?.user)throw Error("Not authenticated");return e.user.id}async getProfile(){let e=await this.getUserId(),{data:t,error:a}=await l.supabase.from("profiles").select("*").eq("id",e).single();return a?(console.error("Error fetching profile:",a),null):t}async getSystemSettings(){let e=await this.getProfile();return{days:e?.version_days_default||90,cycles:e?.cycles_per_version_default||6}}async updateProfile(e){let t=await this.getUserId(),{error:a}=await l.supabase.from("profiles").update(e).eq("id",t);if(a)throw a}async uploadAvatar(e){let t=await this.getUserId(),a=e.name.split(".").pop(),i=`${t}/avatar-${Date.now()}.${a}`,s=`${i}`,{error:r}=await l.supabase.storage.from("el-portal-assets").upload(s,e,{upsert:!0});if(r)throw r;let{data:d}=l.supabase.storage.from("el-portal-assets").getPublicUrl(s);return d.publicUrl}async updateSystemSettings(e,t){let a=await this.getUserId(),{error:i}=await l.supabase.from("profiles").update({version_days_default:e,cycles_per_version_default:t}).eq("id",a);if(i)throw i}calculateDailyScore(e,t){if(0===e.length)return 0;let a=0,i=0;return(e.forEach(e=>{a+=e.weight,t.some(t=>t.habit_id===e.id&&t.status)&&(i+=e.weight)}),0===a)?0:Math.round(i/a*100)}calculateAsymptoticScore(e){return e<=0?0:Math.min(100,Math.round(100*(1-Math.exp(-.061*e))))}calculateHabitStreaks(e,t){let a=Array.from(new Set(t.filter(t=>t.habit_id===e&&t.status).map(e=>e.date))).sort();if(0===a.length)return{currentStreak:0,maxStreak:0};let i=0,s=0,r=null;for(let e of a){let t=new Date(e).getTime();r?1===Math.round((t-r)/864e5)?s++:(i=Math.max(i,s),s=1):s=1,r=t}i=Math.max(i,s);let l=0,d=new Date,n=d.toISOString().split("T")[0],o=new Date(d);o.setDate(o.getDate()-1);let c=o.toISOString().split("T")[0],u=null;if(a.includes(n)?(l=1,u=new Date(d)):a.includes(c)&&(l=1,u=new Date(o)),u)for(;;){u.setDate(u.getDate()-1);let e=u.toISOString().split("T")[0];if(a.includes(e))l++;else break}return{currentStreak:l,maxStreak:i}}async getDashboardData(){let e=await this.getProfile();if(!e)throw Error("Profile not found");let t=null,a=null;if(e.current_version_id){let{data:a}=await l.supabase.from("versions").select("*").eq("id",e.current_version_id).single();t=a}if(e.current_cycle_id){let{data:t}=await l.supabase.from("cycles").select("*").eq("id",e.current_cycle_id).single();a=t}let i=[],s=[];if(a){let{data:e}=await l.supabase.from("habits").select("*").eq("cycle_id",a.id);i=e||[];let{data:t}=await l.supabase.from("goals").select("*").eq("cycle_id",a.id);s=t||[]}let r=[];if(i.length>0){let e=i.map(e=>e.id),{data:t}=await l.supabase.from("habit_logs").select("*").in("habit_id",e);r=t||[]}let d=new Date().toISOString().split("T")[0],n=r.filter(e=>e.date===d),o={};return i.forEach(e=>{o[e.id]=this.calculateHabitStreaks(e.id,r)}),{version:t,cycle:a,habits:i,todayLogs:n,habitStats:o,goals:s}}async toggleHabit(e,t){let a=await this.getUserId(),i=new Date().toISOString().split("T")[0];if(t){let{error:t}=await l.supabase.from("habit_logs").insert({habit_id:e,date:i,status:!0,user_id:a});if(t)throw t;let{data:s}=await l.supabase.from("habits").select("linked_goal_id").eq("id",e).single();if(s&&s.linked_goal_id){await l.supabase.rpc("increment_goal_streak",{goal_id:s.linked_goal_id});let{data:e}=await l.supabase.from("goals").select("current_streak").eq("id",s.linked_goal_id).single();e&&await l.supabase.from("goals").update({current_streak:(e.current_streak||0)+1}).eq("id",s.linked_goal_id)}}else{let{error:t}=await l.supabase.from("habit_logs").delete().eq("habit_id",e).eq("date",i);if(t)throw t;let{data:a}=await l.supabase.from("habits").select("linked_goal_id").eq("id",e).single();if(a&&a.linked_goal_id){let{data:e}=await l.supabase.from("goals").select("current_streak").eq("id",a.linked_goal_id).single();e&&await l.supabase.from("goals").update({current_streak:Math.max(0,(e.current_streak||0)-1)}).eq("id",a.linked_goal_id)}}}async getSlides(){let{data:e}=await l.supabase.from("slides").select("*").order("category");return e?Promise.all(e.map(async e=>{if(e.image_url&&!e.image_url.startsWith("http")){let{data:t}=await l.supabase.storage.from("el-portal-assets").createSignedUrl(e.image_url,3600);if(t)return{...e,image_url:t.signedUrl}}return e})):[]}async updateSlide(e,t){let a=await this.getUserId(),i=e.image_url;if(t){let s=t.name.split(".").pop(),r=`${a}/${e.category}.${s}`,d=`${r}`,{error:n}=await l.supabase.storage.from("el-portal-assets").upload(d,t,{upsert:!0});if(n)throw n;i=d}let{data:s}=await l.supabase.from("slides").select("id").eq("category",e.category).single();s?await l.supabase.from("slides").update({image_url:i,caption:e.caption}).eq("id",s.id):await l.supabase.from("slides").insert({user_id:a,category:e.category,image_url:i,caption:e.caption})}async getSlideImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;let{data:t}=await l.supabase.storage.from("el-portal-assets").createSignedUrl(e,3600);return t?.signedUrl||""}async getArchives(){let{data:e}=await l.supabase.from("archives").select("*");return(e||[]).map(e=>({...e,content:"object"==typeof e.content&&e.content?.markdown?e.content.markdown:e.content}))}async updateArchive(e){let t=await this.getUserId(),a={markdown:e.content},{data:i}=await l.supabase.from("archives").select("id").eq("id",e.id).maybeSingle();i?await l.supabase.from("archives").update({type:e.type,title:e.title,content:a}).eq("id",e.id):await l.supabase.from("archives").insert({id:e.id,user_id:t,type:e.type,title:e.title,content:a})}async getHistoryData(){let e=await this.getUserId(),t=new Date,a=new Date;a.setDate(t.getDate()-90);let i=a.toISOString().split("T")[0],{data:s}=await l.supabase.from("habit_logs").select("*").eq("user_id",e).gte("date",i),r=s||[],{data:d}=await l.supabase.from("habits").select("*").eq("user_id",e),n=d||[],{data:o}=await l.supabase.from("cycles").select("*").eq("user_id",e),c=o||[],u={};n.forEach(e=>{u[e.id]=this.calculateHabitStreaks(e.id,r)});let p=[];for(let e=0;e<=90;e++){let i=new Date(a);i.setDate(i.getDate()+e);let s=i.toISOString().split("T")[0];if(s>t.toISOString().split("T")[0])break;let l=c.find(e=>e.start_date<=s&&e.end_date>=s),d=l?n.filter(e=>e.cycle_id===l.id):[],o=r.filter(e=>e.date===s),u=0,f=[];d.length>0&&(u=this.calculateDailyScore(d,o),d.forEach(e=>{let t=o.some(t=>t.habit_id===e.id&&t.status);f.push({habit:e,done:t})})),p.push({date:s,score:u,details:f})}return{dailyScores:p.reverse(),cycles:c,habitStats:u}}async createVersion(e){let t=await this.getUserId(),a=await this.getProfile(),i=a?.version_days_default||90,s=new Date(e.startDate),r=new Date(s);r.setDate(s.getDate()+i);let{data:n,error:o}=await l.supabase.from("versions").insert({user_id:t,number:e.number,title:e.title,description:e.description,status:d.ACTIVE,start_date:e.startDate,end_date:r.toISOString().split("T")[0]}).select().single();if(o)throw o;return await l.supabase.from("profiles").update({current_version_id:n.id}).eq("id",t),n}async updateGoal(e){let{error:t}=await l.supabase.from("goals").update({title:e.title,description:e.description,type:e.type,subtasks:e.subtasks,current_streak:e.current_streak}).eq("id",e.id);if(t)throw t}async getMantras(){let e=await this.getUserId(),{data:t}=await l.supabase.from("cycles").select("mantras").eq("user_id",e),a=new Set;t?.forEach(e=>e.mantras?.forEach(e=>a.add(e)));let{data:i}=await l.supabase.from("archives").select("content").eq("user_id",e).eq("type",c.MANTRA_BANK);return i?.forEach(e=>{let t="object"==typeof e.content&&e.content.markdown?e.content.markdown:JSON.stringify(e.content);a.add(t)}),Array.from(a)}async addMantra(e){let t=await this.getUserId();await l.supabase.from("archives").insert({user_id:t,type:c.MANTRA_BANK,title:"Mantra",content:{markdown:e}})}async createCycle(e,t,a){let i=await this.getUserId(),s=await this.getProfile();if(!s?.current_version_id)throw Error("No active version");let{count:r}=await l.supabase.from("cycles").select("*",{count:"exact",head:!0}).eq("version_id",s.current_version_id),{data:n,error:o}=await l.supabase.from("cycles").insert({user_id:i,version_id:s.current_version_id,sprint_number:(r||0)+1,start_date:new Date().toISOString().split("T")[0],end_date:new Date(Date.now()+12096e5).toISOString().split("T")[0],status:d.ACTIVE,focus_priorities:e.focus_priorities,problems:e.problems,cch_list:e.cch_list,mantras:e.mantras,learning_focus:e.learning_focus}).select().single();if(o)throw o;for(let e of t){let{data:t,error:a}=await l.supabase.from("goals").insert({user_id:i,cycle_id:n.id,title:e.title,description:e.description,type:e.type,subtasks:e.subtasks?.map(e=>({name:e,done:!1}))}).select().single();if(a&&console.error("Error creating goal",a),e.habit&&t){let{data:a,error:s}=await l.supabase.from("habits").insert({user_id:i,cycle_id:n.id,name:e.habit.name,weight:e.habit.weight,category:e.habit.category,linked_goal_id:t.id}).select().single();a&&await l.supabase.from("goals").update({linked_habit_id:a.id}).eq("id",t.id)}}for(let e of a)await l.supabase.from("habits").insert({user_id:i,cycle_id:n.id,name:e.name,weight:e.weight,category:e.category});return await l.supabase.from("profiles").update({current_cycle_id:n.id}).eq("id",i),n}async getLabData(){let e=await this.getUserId(),t=await this.getProfile(),{data:a}=await l.supabase.from("versions").select("*").eq("user_id",e),i=a?.find(e=>e.id===t?.current_version_id)||null,{data:s}=await l.supabase.from("cycles").select("*").eq("user_id",e).order("sprint_number",{ascending:!1}),r=i?(s||[]).filter(e=>e.version_id===i.id):[],{data:d}=await l.supabase.from("goals").select("*").eq("user_id",e),{data:n}=await l.supabase.from("habits").select("*").eq("user_id",e);return{goals:d||[],version:i,cycles:r,habits:n||[],activeCycleId:t?.current_cycle_id||null}}async updateCycle(e){let{error:t}=await l.supabase.from("cycles").update({start_date:e.start_date,end_date:e.end_date,status:e.status,focus_priorities:e.focus_priorities,problems:e.problems,cch_list:e.cch_list,mantras:e.mantras,learning_focus:e.learning_focus}).eq("id",e.id);if(t)throw t}async deleteCycle(e){let t=await this.getUserId(),{error:a}=await l.supabase.from("cycles").delete().eq("id",e);if(a)throw a;let i=await this.getProfile();i?.current_cycle_id===e&&await l.supabase.from("profiles").update({current_cycle_id:null}).eq("id",t)}async setCycleActive(e){let t=await this.getUserId();await l.supabase.from("profiles").update({current_cycle_id:e}).eq("id",t)}async addGoal(e){let t=await this.getUserId(),{error:a}=await l.supabase.from("goals").insert({id:e.id,user_id:t,cycle_id:e.cycle_id,title:e.title,description:e.description,type:e.type,subtasks:e.subtasks?.map(e=>({...e,name:e.name,done:e.done})),linked_habit_id:e.linked_habit_id,current_streak:e.current_streak});if(a)throw a}async deleteGoal(e){let{error:t}=await l.supabase.from("goals").delete().eq("id",e);if(t)throw t}async getAllHabits(){let e=await this.getUserId(),{data:t}=await l.supabase.from("habits").select("*").eq("user_id",e);return t||[]}async addHabit(e){let t=await this.getUserId(),{error:a}=await l.supabase.from("habits").insert({id:e.id,user_id:t,cycle_id:e.cycle_id,name:e.name,weight:e.weight,category:e.category,linked_goal_id:e.linked_goal_id});if(a)throw a}async updateHabit(e){let{error:t}=await l.supabase.from("habits").update({name:e.name,weight:e.weight,category:e.category,linked_goal_id:e.linked_goal_id}).eq("id",e.id);if(t)throw t}async deleteHabit(e){let{error:t}=await l.supabase.from("habits").delete().eq("id",e);if(t)throw t}async getAllVersions(){let e=await this.getUserId(),{data:t}=await l.supabase.from("versions").select("*").eq("user_id",e).order("start_date",{ascending:!1});return t||[]}async updateVersion(e){let{error:t}=await l.supabase.from("versions").update({title:e.title,description:e.description,start_date:e.start_date,end_date:e.end_date,status:e.status}).eq("id",e.id);if(t)throw t}async deleteVersion(e){let{error:t}=await l.supabase.from("versions").delete().eq("id",e);if(t)throw t}async getAllCycles(){let e=await this.getUserId(),{data:t}=await l.supabase.from("cycles").select("*").eq("user_id",e).order("sprint_number",{ascending:!1});return t||[]}async getAllGoals(){let e=await this.getUserId(),{data:t}=await l.supabase.from("goals").select("*").eq("user_id",e);return t||[]}async signOut(){await l.supabase.auth.signOut()}};e.s(["supabaseService",0,p],8442)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",0,t],37727)},73375,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",0,t],73375)},18566,(e,t,a)=>{t.exports=e.r(76562)},93886,84614,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);e.s(["Film",0,a],93886);let i=(0,t.default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",0,i],84614)},25652,e=>{"use strict";let t=(0,e.i(75254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",0,t],25652)},38308,e=>{"use strict";let t=(0,e.i(75254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",0,t],38308)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",0,t],56909)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",0,t],86536)},77705,e=>{"use strict";let t=(0,e.i(75254).default)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);e.s(["EyeOff",0,t],77705)},20278,59607,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);e.s(["Target",0,a],20278);let i=(0,t.default)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",0,i],59607)},7866,39616,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);e.s(["Library",0,a],7866);let i=(0,t.default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",0,i],39616)},58041,e=>{"use strict";let t=(0,e.i(75254).default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);e.s(["Database",0,t],58041)}]);