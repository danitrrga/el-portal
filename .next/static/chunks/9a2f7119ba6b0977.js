(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65286,e=>{"use strict";let t=(0,e.i(75254).default)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],65286)},83627,e=>{"use strict";let t=(0,e.i(75254).default)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);e.s(["Edit3",()=>t],83627)},27612,55436,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>a],27612);let i=(0,t.default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>i],55436)},55711,e=>{"use strict";let t=(0,e.i(75254).default)("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);e.s(["Brain",()=>t],55711)},70956,e=>{"use strict";let t=(0,e.i(75254).default)("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);e.s(["List",()=>t],70956)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},64659,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},52008,e=>{"use strict";let t=(0,e.i(75254).default)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);e.s(["Layers",()=>t],52008)},55900,16715,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>a],55900);let i=(0,t.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>i],16715)},40316,e=>{"use strict";var t=e.i(18050),a=e.i(71645),i=e.i(52008),r=e.i(87316),s=e.i(8442),l=e.i(73375),n=e.i(63059),d=e.i(37727);let c=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),o=({label:e,value:i,onChange:s})=>{let[o,p]=(0,a.useState)(!1),[h,x]=(0,a.useState)(()=>{if(i){let e=i.split("-").map(Number);if(3===e.length&&!isNaN(e[0]))return new Date(e[0],e[1]-1,e[2])}return new Date}),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{if(i){let e=i.split("-").map(Number),t=new Date(e[0],e[1]-1,e[2]);isNaN(t.getTime())||t.getMonth()===h.getMonth()&&t.getFullYear()===h.getFullYear()||x(t)}},[i]);let u=e=>{let t=new Date(h);t.setMonth(t.getMonth()+e),x(t)},b=(()=>{let e=h.getFullYear(),t=h.getMonth(),a=new Date(e,t,1).getDay(),i=new Date(e,t+1,0).getDate(),r=new Date(e,t,0).getDate(),s=[];for(let e=a-1;e>=0;e--)s.push({day:r-e,type:"prev"});for(let e=1;e<=i;e++)s.push({day:e,type:"current"});let l=42-s.length;for(let e=1;e<=l;e++)s.push({day:e,type:"next"});return s})();return(0,t.jsxs)("div",{className:"relative",ref:g,children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:e}),(0,t.jsxs)("button",{type:"button",onClick:()=>p(!o),className:`w-full flex items-center justify-between rounded-xl bg-graphite-50 dark:bg-graphite-800 border p-3 text-sm transition-all
          ${o?"border-pacific-500 ring-2 ring-pacific-500/20":"border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/50"}
          ${i?"text-graphite-900 dark:text-white":"text-graphite-400"}
        `,children:[(0,t.jsx)("span",{className:"font-medium",children:(e=>{if(!e)return"Select Date";let t=e.split("-").map(Number),a=new Date(t[0],t[1]-1,t[2]);return isNaN(a.getTime())?"Select Date":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})(i)}),(0,t.jsx)(r.Calendar,{size:16,className:"text-pacific-500"})]}),o&&(0,t.jsxs)("div",{className:"absolute top-full left-0 mt-2 w-full min-w-[300px] bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-graphite-700 rounded-xl shadow-2xl z-50 p-4 animate-in fade-in zoom-in-95 duration-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>u(-1),className:"p-1 hover:bg-graphite-100 dark:hover:bg-graphite-800 rounded-lg text-graphite-500 dark:text-graphite-400 transition-colors",children:(0,t.jsx)(l.ChevronLeft,{size:20})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-graphite-900 dark:text-white",children:[["January","February","March","April","May","June","July","August","September","October","November","December"][h.getMonth()]," ",h.getFullYear()]}),(0,t.jsx)("button",{type:"button",onClick:()=>u(1),className:"p-1 hover:bg-graphite-100 dark:hover:bg-graphite-800 rounded-lg text-graphite-500 dark:text-graphite-400 transition-colors",children:(0,t.jsx)(n.ChevronRight,{size:20})})]}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>(0,t.jsx)("div",{className:"text-center text-[10px] font-bold text-graphite-400 uppercase",children:e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1",children:b.map((e,a)=>{var r,l;let n,d,c;return(0,t.jsx)("button",{type:"button",onClick:()=>{var t,a;let i,r,l,n,d,c;return t=e.day,a=e.type,r=h.getFullYear(),l=h.getMonth(),n=(i="prev"===a?new Date(r,l-1,t):"next"===a?new Date(r,l+1,t):new Date(r,l,t)).getFullYear(),d=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0"),void(s(`${n}-${d}-${c}`),p(!1),x(i))},className:`
                  aspect-square flex items-center justify-center rounded-lg text-sm font-medium transition-all
                  ${((e,t)=>{if(!i)return!1;let a=i.split("-").map(Number),r=new Date(a[0],a[1]-1,a[2]);if(isNaN(r.getTime()))return!1;let s=h.getFullYear(),l=h.getMonth();return("prev"===t?new Date(s,l-1,e):"next"===t?new Date(s,l+1,e):new Date(s,l,e)).getTime()===r.getTime()})(e.day,e.type)?"bg-pacific-500 text-white shadow-lg shadow-pacific-500/30":(r=e.day,l=e.type,(n=new Date).setHours(0,0,0,0),d=h.getFullYear(),c=h.getMonth(),("prev"===l?new Date(d,c-1,r):"next"===l?new Date(d,c+1,r):new Date(d,c,r)).getTime()===n.getTime())?"text-pacific-500 font-bold bg-pacific-50 dark:bg-pacific-900/10 hover:bg-pacific-100 dark:hover:bg-pacific-900/30":"current"===e.type?"text-graphite-700 dark:text-graphite-300 hover:bg-graphite-100 dark:hover:bg-graphite-800":"text-graphite-400/30 dark:text-graphite-600/30 hover:bg-graphite-50 dark:hover:bg-graphite-800/50"}
                `,children:e.day},a)})}),(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-graphite-100 dark:border-graphite-800 flex items-center justify-between px-1",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>{s(""),p(!1)},className:"flex items-center gap-1.5 text-xs font-bold text-graphite-400 hover:text-red-500 transition-colors",children:[(0,t.jsx)(d.X,{size:14})," Clear"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");s(`${t}-${a}-${i}`),x(e),p(!1)},className:"flex items-center gap-1.5 text-xs font-bold text-pacific-600 dark:text-pacific-400 hover:text-pacific-500 transition-colors",children:[(0,t.jsx)(c,{size:14})," Today"]})]})]})]})};e.s(["NewVersionModal",0,({onClose:e,onCreate:l,suggestedNumber:n})=>{let[d,c]=(0,a.useState)(""),[p,h]=(0,a.useState)(""),[x,g]=(0,a.useState)(n),[u,b]=(0,a.useState)(new Date().toISOString().split("T")[0]),[m,f]=(0,a.useState)(90),[y,k]=(0,a.useState)("");return(0,a.useEffect)(()=>{s.supabaseService.getSystemSettings().then(e=>{f(e.days)})},[]),(0,a.useEffect)(()=>{if(!u)return void k("-");let e=new Date(u);if(isNaN(e.getTime()))return void k("-");let t=new Date(e);t.setDate(e.getDate()+m),k(t.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"}))},[u,m]),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4",onClick:e,children:(0,t.jsxs)("div",{className:"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 p-8 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("h2",{className:"mb-6 text-xl font-bold text-graphite-900 dark:text-white flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-2 bg-pacific-100 text-pacific-600 rounded-lg",children:(0,t.jsx)(i.Layers,{size:20})}),"Initialize New Version"]}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:"Version ID"}),(0,t.jsx)("input",{type:"number",value:x,onChange:e=>g(Number(e.target.value)),className:"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(o,{label:"Start Date",value:u,onChange:b})})]}),(0,t.jsxs)("div",{className:"p-3 bg-graphite-50 dark:bg-graphite-800/50 rounded-xl border border-graphite-200 dark:border-graphite-700 flex items-center gap-3",children:[(0,t.jsx)(r.Calendar,{size:16,className:"text-pacific-500"}),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("span",{className:"text-graphite-500 uppercase font-bold tracking-wider",children:"Projected End: "}),(0,t.jsx)("span",{className:"text-graphite-900 dark:text-white font-mono",children:y}),(0,t.jsxs)("span",{className:"block text-[10px] text-graphite-400 mt-0.5",children:["Based on system tempo of ",m," days."]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:"Identity Title"}),(0,t.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"e.g., The Architect",className:"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1.5 block text-xs font-bold text-graphite-500 uppercase tracking-wide",children:"Persona Definition"}),(0,t.jsx)("textarea",{value:p,onChange:e=>h(e.target.value),placeholder:"Define the archetype...",rows:3,className:"w-full rounded-xl bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 p-3 text-graphite-900 dark:text-white focus:border-pacific-500 focus:ring-2 focus:ring-pacific-500/20 focus:outline-none transition-all resize-none"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-6",children:[(0,t.jsx)("button",{onClick:e,type:"button",className:"rounded-xl px-4 py-2 text-sm font-medium text-graphite-500 hover:text-graphite-800 dark:hover:text-graphite-200 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:()=>{l({title:d,description:p,number:x,startDate:u})},type:"button",className:"rounded-xl bg-pacific-600 px-6 py-2.5 text-sm font-bold text-white hover:bg-pacific-500 transition-colors shadow-lg shadow-pacific-500/30",children:"Initialize Version"})]})]})]})})}],40316)},99232,e=>{"use strict";var t=e.i(18050),a=e.i(71645),i=e.i(8442),r=e.i(73986),s=e.i(20278),l=e.i(65286),n=e.i(7233),d=e.i(59607),c=e.i(37727),o=e.i(52008),p=e.i(21218),h=e.i(63059),x=e.i(87316),g=e.i(64659),u=e.i(83627),b=e.i(56909),m=e.i(27612),f=e.i(43531),y=e.i(21345),k=e.i(55900),v=e.i(16715),j=e.i(75254);let w=(0,j.default)("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),N=(0,j.default)("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var C=e.i(86536),S=e.i(77705),D=e.i(71841),z=e.i(14784),T=e.i(40316);let M=({cycle:e,isActive:i,onClose:r,onSave:s})=>{let[l,n]=(0,a.useState)(e.start_date),[d,o]=(0,a.useState)(e.end_date),[p,h]=(0,a.useState)(i);return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4",onClick:r,children:(0,t.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white dark:bg-graphite-900 p-6 shadow-2xl border border-graphite-200 dark:border-graphite-800 animate-in zoom-in-95 duration-200",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("h2",{className:"text-lg font-bold text-graphite-900 dark:text-white flex items-center gap-2",children:[(0,t.jsx)(x.Calendar,{size:18,className:"text-pacific-500"})," Cycle Settings"]}),(0,t.jsx)("button",{onClick:r,type:"button",children:(0,t.jsx)(c.X,{size:18,className:"text-graphite-400 hover:text-white"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-bold text-graphite-500 uppercase mb-1.5",children:"Start Date"}),(0,t.jsx)("input",{type:"date",value:l,onChange:e=>n(e.target.value),className:"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-bold text-graphite-500 uppercase mb-1.5",children:"End Date"}),(0,t.jsx)("input",{type:"date",value:d,onChange:e=>o(e.target.value),className:"w-full bg-graphite-50 dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 rounded-xl px-3 py-2 text-sm text-graphite-900 dark:text-white focus:outline-none focus:border-pacific-500"})]}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-xl border transition-colors cursor-pointer ${p?"bg-pacific-50 dark:bg-pacific-900/10 border-pacific-500/50":"bg-graphite-50 dark:bg-graphite-800 border-graphite-200 dark:border-graphite-700 hover:border-graphite-400"}`,children:[(0,t.jsx)("div",{className:`h-5 w-5 rounded-full border flex items-center justify-center transition-colors ${p?"bg-pacific-500 border-pacific-500":"border-graphite-400"}`,children:p&&(0,t.jsx)(f.Check,{size:12,className:"text-white"})}),(0,t.jsx)("input",{type:"checkbox",checked:p,onChange:e=>!i&&h(e.target.checked),className:"hidden",disabled:i}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-bold text-graphite-900 dark:text-white",children:"Active Status"}),(0,t.jsx)("div",{className:"text-xs text-graphite-500",children:i?"Currently the active cycle":"Set as current active cycle"})]})]})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-6 mt-2 border-t border-graphite-200 dark:border-graphite-800",children:[(0,t.jsx)("button",{onClick:r,type:"button",className:"px-4 py-2 text-sm font-bold text-graphite-500 hover:text-graphite-900 dark:hover:text-white transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>s(e.id,l,d,p),type:"button",className:"px-6 py-2 bg-pacific-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-pacific-500/30 hover:bg-pacific-500 transition-colors flex items-center gap-2",children:[(0,t.jsx)(b.Save,{size:14})," Save Changes"]})]})]})})},_=({isOpen:e,onClose:i,onSelect:s,currentCycleHabits:l,allHabits:n})=>{let[d,o]=(0,a.useState)("current"),[p,h]=(0,a.useState)("");if(!e)return null;let x=Array.from(new Map(n.map(e=>[e.name,e])).values()),g=("current"===d?l:x).filter(e=>e.name.toLowerCase().includes(p.toLowerCase()));return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-graphite-950/80 backdrop-blur-sm p-4",onClick:i,children:(0,t.jsxs)("div",{className:"w-full max-w-lg rounded-2xl bg-white dark:bg-graphite-900 shadow-2xl animate-in zoom-in-95 duration-200 border border-graphite-200 dark:border-graphite-800 flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"p-6 border-b border-graphite-200 dark:border-graphite-800",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h2",{className:"text-lg font-bold text-graphite-900 dark:text-white flex items-center gap-2",children:[(0,t.jsx)(y.Link,{size:18,className:"text-pacific-500"})," Link Habit"]}),(0,t.jsx)("button",{onClick:i,className:"text-graphite-400 hover:text-graphite-600 dark:hover:text-white",children:(0,t.jsx)(c.X,{size:18})})]}),(0,t.jsxs)("div",{className:"flex gap-2 p-1 bg-graphite-100 dark:bg-graphite-800 rounded-lg mb-4",children:[(0,t.jsx)("button",{onClick:()=>o("current"),className:`flex-1 py-1.5 text-xs font-bold uppercase rounded-md transition-all ${"current"===d?"bg-white dark:bg-graphite-700 text-graphite-900 dark:text-white shadow-sm":"text-graphite-500"}`,children:"Current Cycle"}),(0,t.jsx)("button",{onClick:()=>o("database"),className:`flex-1 py-1.5 text-xs font-bold uppercase rounded-md transition-all ${"database"===d?"bg-white dark:bg-graphite-700 text-graphite-900 dark:text-white shadow-sm":"text-graphite-500"}`,children:"Database"})]}),(0,t.jsx)("input",{value:p,onChange:e=>h(e.target.value),placeholder:"Search habits...",className:"w-full bg-graphite-50 dark:bg-graphite-950 border border-graphite-200 dark:border-graphite-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-pacific-500 text-graphite-900 dark:text-white"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:g.length>0?g.map(e=>(0,t.jsxs)("button",{onClick:()=>s(e),className:"w-full text-left p-4 rounded-xl border border-graphite-200 dark:border-graphite-800 hover:border-pacific-500 dark:hover:border-pacific-500 bg-white dark:bg-graphite-800/50 hover:bg-pacific-50 dark:hover:bg-pacific-900/10 transition-all group",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("span",{className:"font-semibold text-graphite-900 dark:text-white group-hover:text-pacific-600 dark:group-hover:text-pacific-400 transition-colors",children:e.name}),"database"===d&&(0,t.jsx)("span",{className:"text-[10px] font-bold uppercase text-graphite-400 bg-graphite-100 dark:bg-graphite-800 px-2 py-0.5 rounded",children:"Import"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-graphite-500",children:[(0,t.jsx)("span",{children:e.category}),(0,t.jsx)("span",{className:"text-graphite-300",children:"•"}),(0,t.jsx)("span",{className:e.weight===r.HabitWeight.HIGH?"text-pacific-500 font-bold":"",children:e.weight===r.HabitWeight.HIGH?"High Priority":e.weight===r.HabitWeight.MEDIUM?"Medium":"Low"})]})]},e.id)):(0,t.jsx)("div",{className:"text-center py-8 text-graphite-400 text-sm",children:"No habits found."})})]})})};e.s(["default",0,()=>{let[e,b]=(0,a.useState)(null),[j,E]=(0,a.useState)(!0),[H,A]=(0,a.useState)(!1),[I,$]=(0,a.useState)(!1),[L,P]=(0,a.useState)(null),[R,G]=(0,a.useState)(null),[V,F]=(0,a.useState)(!1),[O,U]=(0,a.useState)(null),[q,Y]=(0,a.useState)(!1),[K,J]=(0,a.useState)(null),[B,X]=(0,a.useState)([]),[W,Z]=(0,a.useState)(null),[Q,ee]=(0,a.useState)(""),[et,ea]=(0,a.useState)(null),[ei,er]=(0,a.useState)(""),[es,el]=(0,a.useState)(null),[en,ed]=(0,a.useState)(new Set),[ec,eo]=(0,a.useState)(!1),[ep,eh]=(0,a.useState)(null),[ex,eg]=(0,a.useState)(6),eu=async()=>{try{let e=await i.supabaseService.getLabData();b(e);let t=await i.supabaseService.getAllHabits();X(t);let a=await i.supabaseService.getSystemSettings();eg(a.cycles),e.activeCycleId&&!es&&el(e.activeCycleId),E(!1)}catch(e){console.error(e),E(!1)}};(0,a.useEffect)(()=>{eu()},[]);let eb=async e=>{await i.supabaseService.createVersion(e),A(!1),eu()},em=async(e,t,a)=>{await i.supabaseService.createCycle(e,t,a),$(!1),eu()},ef=async e=>{await i.supabaseService.updateCycle(e),P(null),eu()},ey=async(t,a)=>{t.preventDefault(),t.stopPropagation();try{if(!e)return;let t=e.cycles.find(e=>e.id===a);if(!t)return;let s=(t.status||r.EntityStatus.ACTIVE)===r.EntityStatus.ARCHIVED?r.EntityStatus.ACTIVE:r.EntityStatus.ARCHIVED,l=e.cycles.map(e=>e.id===a?{...e,status:s}:e);b({...e,cycles:l}),await i.supabaseService.updateCycle({...t,status:s}),await eu()}catch(e){console.error("Archive failed",e),eu()}},ek=async(e,t)=>{if(e.preventDefault(),e.stopPropagation(),ep!==t){eh(t),setTimeout(()=>eh(e=>e===t?null:e),3e3);return}try{b(e=>e?{...e,cycles:e.cycles.filter(e=>e.id!==t)}:null),es===t&&el(null),await i.supabaseService.deleteCycle(t),await eu(),eh(null)}catch(e){eu()}},ev=async(t,a,r,s)=>{if(!e)return;let l=e.cycles.find(e=>e.id===t);if(l){let e={...l,start_date:a,end_date:r};await i.supabaseService.updateCycle(e)}s&&e.activeCycleId!==t&&await i.supabaseService.setCycleActive(t),G(null),eu()},ej=async(e,t)=>{if(!O)return;let a=`g-${crypto.randomUUID()}`,s={id:a,cycle_id:O,title:e.title,description:e.description,type:e.type};if(e.type===r.GoalType.TASK_PROJECT)s.subtasks=e.subtasks?.map(e=>{let t=e.match(/^(\s*)/),a=Math.floor((t?t[1]:"").replace(/\t/g,"  ").length/2);return{name:e.trim(),done:!1,level:a}})||[];else if(e.type===r.GoalType.CONSISTENCY_METRIC&&t){let e=t.id;if(t.cycle_id!==O){let r=`h-${crypto.randomUUID()}`,s={...t,id:r,cycle_id:O,linked_goal_id:a};await i.supabaseService.addHabit(s),e=r}else{let e={...t,linked_goal_id:a};await i.supabaseService.updateHabit(e)}s.linked_habit_id=e,s.current_streak=0}await i.supabaseService.addGoal(s),F(!1),eu()},ew=async e=>{await i.supabaseService.deleteGoal(e),eu()},eN=async t=>{if(!e||!K)return;let a=t.cycle_id===e.activeCycleId,r=t.id;if(!a&&e.activeCycleId){let a={id:`h-${crypto.randomUUID()}`,cycle_id:e.activeCycleId,name:t.name,category:t.category,weight:t.weight,linked_goal_id:K};await i.supabaseService.addHabit(a),r=a.id}else{let e={...t,linked_goal_id:K};await i.supabaseService.updateHabit(e)}let s=e.goals.find(e=>e.id===K);if(s){let e={...s,linked_habit_id:r};await i.supabaseService.updateGoal(e)}Y(!1),J(null),eu()},eC=async(e,t)=>{if(!e.subtasks)return;let a=[...e.subtasks];a[t].done=!a[t].done;let r={...e,subtasks:a};await i.supabaseService.updateGoal(r),eu()},eS=async(e,t)=>{if(!e.subtasks)return;let a=e.subtasks.filter((e,a)=>a!==t),r={...e,subtasks:a};await i.supabaseService.updateGoal(r),eu()},eD=(e,t,a)=>{Z({goalId:e,index:t}),ee(a)},ez=async(e,t)=>{if(!e.subtasks)return;let a=[...e.subtasks];a[t].name=Q;let r={...e,subtasks:a};await i.supabaseService.updateGoal(r),Z(null),ee(""),eu()},eT=async e=>{if(!ei.trim())return;let t=e.subtasks?[...e.subtasks]:[];t.push({name:ei,done:!1,level:0});let a={...e,subtasks:t};await i.supabaseService.updateGoal(a),ea(null),er(""),eu()},eM=async(t,a)=>{if(L)if("delete"===t)await ew(a.id);else{let s={title:a.title,description:a.description,type:a.type,subtasks:a.subtasks};if("create"===t){let e=`g-${crypto.randomUUID()}`,t={id:e,cycle_id:L.id,title:s.title,description:s.description,type:s.type};if(s.type===r.GoalType.TASK_PROJECT)t.subtasks=a.subtasks?.map(e=>{let t=e.match(/^(\s*)/),a=Math.floor((t?t[1]:"").replace(/\t/g,"  ").length/2);return{name:e.trim(),done:!1,level:a}})||[];else if(s.type===r.GoalType.CONSISTENCY_METRIC&&a.linkedHabit){let r=a.linkedHabit.id;if(a.linkedHabit.cycle_id!==L.id){let t=`h-${crypto.randomUUID()}`,s={...a.linkedHabit,id:t,cycle_id:L.id,linked_goal_id:e};await i.supabaseService.addHabit(s),r=t}else{let t={...a.linkedHabit,linked_goal_id:e};await i.supabaseService.updateHabit(t)}t.linked_habit_id=r,t.current_streak=0}await i.supabaseService.addGoal(t)}else{let t=e?.goals.find(e=>e.id===a.id);if(!t)return;let l=t.subtasks;s.type===r.GoalType.TASK_PROJECT&&a.subtasks&&(l=a.subtasks.map(e=>{let t=e.match(/^(\s*)/),a=Math.floor((t?t[1]:"").replace(/\t/g,"  ").length/2);return{name:e.trim(),done:!1,level:a}}));let n={...t,title:s.title,description:s.description,type:s.type,subtasks:l,linked_habit_id:a.linkedHabit?.id};await i.supabaseService.updateGoal(n)}await eu()}},e_=async(t,a)=>{if(L){if("delete"===t)await i.supabaseService.deleteHabit(a.id);else if("create"===t){let e={id:`h-${crypto.randomUUID()}`,cycle_id:L.id,name:a.name,category:a.category,weight:a.weight};await i.supabaseService.addHabit(e)}else{let t={...e?.habits.find(e=>e.id===a.id),name:a.name,category:a.category,weight:a.weight};await i.supabaseService.updateHabit(t)}await eu()}},eE=async e=>{await i.supabaseService.deleteHabit(e),X(await i.supabaseService.getAllHabits()),await eu()};if(j||!e)return(0,t.jsx)("div",{className:"flex h-full items-center justify-center font-medium text-graphite-400",children:"Loading Lab Environment..."});let eH=e.habits.filter(t=>t.cycle_id===e.activeCycleId),eA=e.cycles.some(e=>e.status===r.EntityStatus.ARCHIVED),eI=e.cycles.filter(e=>ec||e.status!==r.EntityStatus.ARCHIVED);return(0,t.jsxs)("div",{className:"pb-10",children:[(0,t.jsxs)("header",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-8",children:[e.version?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("span",{className:"inline-flex items-center justify-center rounded bg-pacific-500/10 border border-pacific-500/20 px-2 py-0.5 text-[10px] font-bold text-pacific-600 dark:text-pacific-400 uppercase tracking-wider",children:"Current Version"}),(0,t.jsxs)("span",{className:"text-pacific-500 font-mono font-bold text-sm",children:["v",e.version.number,".0"]})]}),(0,t.jsx)("h1",{className:"text-4xl font-display font-bold text-graphite-900 dark:text-white tracking-tight",children:e.version.title}),(0,t.jsxs)("p",{className:"text-graphite-500 italic mt-1",children:['"',e.version.description,'"']})]}):(0,t.jsxs)("div",{className:"flex flex-col items-start gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 text-graphite-400",children:[(0,t.jsx)("div",{className:"p-2 bg-graphite-100 dark:bg-graphite-800 rounded-lg",children:(0,t.jsx)(o.Layers,{size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-graphite-900 dark:text-white",children:"System Standby"}),(0,t.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide",children:"No Active Version"})]})]}),(0,t.jsx)("p",{className:"text-sm text-graphite-500 max-w-md",children:"The system is currently dormant. Initialize the first Version to begin tracking cycles and habits."}),(0,t.jsxs)("button",{onClick:()=>A(!0),className:"px-4 py-2 bg-pacific-600 text-white text-sm font-bold rounded-xl hover:bg-pacific-500 transition-colors shadow-lg shadow-pacific-500/20 flex items-center gap-2",children:[(0,t.jsx)(n.Plus,{size:16})," Initialize Version 1.0"]})]}),e.version&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-right mr-4 hidden md:block",children:[(0,t.jsxs)("div",{className:"text-[10px] font-bold text-graphite-400 uppercase tracking-widest flex items-center justify-end gap-2",children:[(0,t.jsx)(x.Calendar,{size:12})," Timeline"]}),(0,t.jsxs)("div",{className:"font-mono text-sm text-graphite-600 dark:text-graphite-300",children:[e.version.start_date," — ",e.version.end_date]})]}),(0,t.jsxs)("button",{onClick:()=>A(!0),type:"button",className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white dark:bg-graphite-800 border border-graphite-200 dark:border-graphite-700 text-sm font-bold hover:border-pacific-500 transition-colors",children:[(0,t.jsx)(n.Plus,{size:16})," New Version"]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("h3",{className:"text-xs font-bold text-graphite-400 uppercase tracking-widest flex items-center gap-2",children:[(0,t.jsx)(o.Layers,{size:14})," Cycles Log"]}),eA&&(0,t.jsxs)("button",{onClick:()=>eo(!ec),type:"button",className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-graphite-100 dark:bg-graphite-800 text-graphite-500 hover:text-pacific-500 transition-colors flex items-center gap-1",children:[ec?(0,t.jsx)(S.EyeOff,{size:12}):(0,t.jsx)(C.Eye,{size:12})," ",ec?"Hide Archived":"Show Archived"]})]}),e.version&&e.cycles.length<ex&&(0,t.jsx)("button",{onClick:()=>$(!0),type:"button",className:"text-pacific-600 hover:text-pacific-500 p-2 rounded-lg bg-pacific-50 dark:bg-pacific-900/10",children:(0,t.jsx)(n.Plus,{size:20})})]}),eI.map(a=>{let i=a.id===e.activeCycleId,o=a.status===r.EntityStatus.ARCHIVED,b=e.goals.filter(e=>e.cycle_id===a.id),j=es===a.id,C="text-graphite-900 dark:text-white",S="text-graphite-400 dark:text-graphite-500";return(0,t.jsxs)("div",{className:`rounded-3xl border transition-all duration-300 overflow-hidden bg-white dark:bg-graphite-900 border border-graphite-200 dark:border-[#262629] transition-all duration-300 ${o?"opacity-70 grayscale border-dashed":!i&&!j?"opacity-60 hover:opacity-100":"opacity-100"}`,children:[(0,t.jsxs)("div",{onClick:e=>{e.target.closest("button")||el(j?null:a.id)},className:`group/header p-6 border-b flex items-center justify-between cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition-colors ${i?"border-graphite-200 dark:border-graphite-800":"border-graphite-100 dark:border-graphite-800"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[j?(0,t.jsx)(g.ChevronDown,{className:"text-pacific-500"}):(0,t.jsx)(h.ChevronRight,{className:"text-graphite-400"}),(0,t.jsxs)("h2",{className:`text-xl font-bold ${C} ${o?"line-through decoration-graphite-400":""}`,children:["Cycle ",a.sprint_number]}),(0,t.jsx)("div",{className:"flex items-center gap-4 relative z-10",onClick:e=>e.stopPropagation(),children:i?(0,t.jsxs)("button",{onClick:()=>G(a),type:"button",className:"px-3 py-1 rounded-lg bg-pacific-500/10 text-pacific-600 dark:text-pacific-400 border border-pacific-500/20 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 hover:bg-pacific-500/20 transition-colors",children:["Active ",(0,t.jsx)(x.Calendar,{size:12,className:"pointer-events-none"})]}):o?(0,t.jsxs)("span",{className:"px-3 py-1 rounded-lg bg-graphite-100 dark:bg-graphite-800 text-graphite-500 border border-graphite-200 dark:border-graphite-700 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1",children:[(0,t.jsx)(N,{size:10})," Archived"]}):(0,t.jsxs)("button",{onClick:()=>G(a),type:"button",className:"px-3 py-1 rounded-lg bg-transparent text-graphite-400 border border-graphite-200 dark:border-graphite-700 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 hover:bg-graphite-100 dark:hover:bg-graphite-800 hover:text-graphite-600 dark:hover:text-graphite-300 transition-colors",children:["Configure ",(0,t.jsx)(x.Calendar,{size:12,className:"pointer-events-none"})]})})]}),(0,t.jsx)("div",{className:"flex items-center justify-end",children:(0,t.jsxs)("div",{className:`font-mono text-sm ${S} transition-all duration-300`,children:[a.start_date," — ",a.end_date]})})]}),j&&(0,t.jsxs)("div",{className:"p-8 grid grid-cols-1 lg:grid-cols-2 gap-12 animate-in slide-in-from-top-4 duration-300",children:[(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:`text-xs font-bold uppercase tracking-widest mb-4 flex items-center gap-2 ${i?"text-graphite-500":"text-graphite-500 dark:text-graphite-400"}`,children:[(0,t.jsx)(s.Target,{size:14})," Priorities"]}),(0,t.jsx)("div",{className:"space-y-3",children:a.focus_priorities.map((e,a)=>(0,t.jsxs)("div",{className:`flex items-center gap-4 p-3 rounded-xl border ${i?"bg-white/5 border-white/10":"bg-graphite-50 dark:bg-graphite-800 border-graphite-200 dark:border-graphite-700"}`,children:[(0,t.jsxs)("span",{className:"text-pacific-500 font-mono text-xs font-bold",children:["0",a+1,"."]}),(0,t.jsx)("span",{className:`font-medium ${C}`,children:e})]},a))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:`text-xs font-bold uppercase tracking-widest mb-4 flex items-center gap-2 ${i?"text-graphite-500":"text-graphite-500 dark:text-graphite-400"}`,children:[(0,t.jsx)(p.Activity,{size:14})," Identity Kernel"]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:a.cch_list.map((e,a)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:`text-[10px] font-bold mb-2 uppercase ${i?"text-graphite-500":"text-graphite-600 dark:text-graphite-400"}`,children:e.category}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.items.map((e,a)=>(0,t.jsx)("span",{className:`text-xs border px-2 py-1 rounded-md ${i?"text-graphite-400 border-graphite-700":"text-graphite-400 dark:text-graphite-500 border-graphite-200 dark:border-graphite-700"}`,children:e},a))})]},a))})]}),(0,t.jsxs)("div",{className:`p-6 rounded-2xl border ${i?"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900/30":"bg-white dark:bg-graphite-800/50 border-red-100 dark:border-red-900/30 shadow-sm"}`,children:[(0,t.jsxs)("h4",{className:"text-[10px] font-bold text-red-500 dark:text-red-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[(0,t.jsx)(d.AlertTriangle,{size:12})," Friction"]}),(0,t.jsxs)("p",{className:`text-sm italic ${i?"text-graphite-700 dark:text-red-100/80":"text-graphite-600 dark:text-graphite-400"}`,children:['"',a.problems,'"']})]}),(0,t.jsxs)("div",{className:"pt-6 border-t border-graphite-200 dark:border-graphite-800 flex flex-wrap items-center gap-3 relative z-10",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("button",{onClick:()=>P(a),type:"button",className:"flex items-center gap-2 px-4 py-2 bg-graphite-100 dark:bg-graphite-800 text-graphite-600 dark:text-graphite-300 rounded-xl text-sm font-bold hover:bg-graphite-200 dark:hover:bg-graphite-700 transition-colors",children:[(0,t.jsx)(u.Edit3,{size:16,className:"pointer-events-none"})," Edit Content"]}),(0,t.jsx)("button",{onClick:e=>ey(e,a.id),type:"button",className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all border ${o?"bg-bali-50 dark:bg-bali-900/20 text-bali-600 dark:text-bali-400 border-bali-200 dark:border-bali-800":"bg-graphite-50 dark:bg-graphite-900/50 text-graphite-500 hover:text-pacific-600 dark:hover:text-pacific-400 border-transparent hover:border-pacific-200 dark:hover:border-pacific-800"}`,children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.RefreshCw,{size:16,className:"pointer-events-none"})," Restore"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N,{size:16,className:"pointer-events-none"})," Archive"]})}),(0,t.jsxs)("button",{onClick:e=>ek(e,a.id),type:"button",className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-200 ${ep===a.id?"bg-red-500 text-white border-red-500 shadow-lg shadow-red-500/30 scale-105":"bg-graphite-50 dark:bg-graphite-900/50 text-graphite-400 hover:text-red-500 border border-transparent hover:border-red-200 dark:hover:border-red-900/30"}`,children:[(0,t.jsx)(m.Trash2,{size:16,className:"pointer-events-none"}),ep===a.id?"Confirm Delete?":"Delete"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("h4",{className:`text-xs font-bold uppercase tracking-widest flex items-center gap-2 ${i?"text-graphite-500":"text-graphite-500 dark:text-graphite-400"}`,children:[(0,t.jsx)(l.CheckCircle2,{size:14})," Goals & Objectives"]}),(0,t.jsx)("button",{onClick:()=>{U(a.id),F(!0)},type:"button",className:"text-[10px] font-bold text-pacific-400 hover:text-white flex items-center gap-1",children:"+ ADD GOAL"})]}),(0,t.jsx)("div",{className:"space-y-4",children:b.map(e=>{let a=eH.find(t=>t.id===e.linked_habit_id),i=e.type===r.GoalType.TASK_PROJECT,s=en.has(e.id),l=0,o=!1;if(e.type===r.GoalType.TASK_PROJECT){let t=e.subtasks?.length||0,a=e.subtasks?.filter(e=>e.done).length||0;t>0&&(l=a/t*100,o=!0)}else e.type===r.GoalType.CONSISTENCY_METRIC&&(l=Math.min(100,100*(1-Math.exp(-.061*(e.current_streak||0)))),o=!0);return(0,t.jsxs)("div",{onClick:i?()=>{var t;let a;return t=e.id,void((a=new Set(en)).has(t)?a.delete(t):a.add(t),ed(a))}:void 0,className:`group relative p-5 rounded-2xl border transition-all overflow-hidden bg-graphite-50 dark:bg-graphite-800/50 border-graphite-200 dark:border-graphite-700 hover:border-pacific-500/30 ${i?"cursor-pointer":""}`,children:[o&&(0,t.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1.5 bg-graphite-200 dark:bg-black/20",children:(0,t.jsx)("div",{className:`h-full transition-all duration-500 ${l>=100?"bg-bali-500":"bg-pacific-500"}`,style:{width:`${l}%`}})}),(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:`font-bold text-lg ${C}`,children:e.title}),(0,t.jsx)("p",{className:`text-sm leading-relaxed mt-1 ${S}`,children:e.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[i&&(0,t.jsx)("div",{className:"text-graphite-400 group-hover:text-pacific-500 transition-colors",children:s?(0,t.jsx)(g.ChevronDown,{size:16}):(0,t.jsx)(k.ChevronUp,{size:16})}),(0,t.jsx)("div",{className:"text-xs font-bold text-graphite-500 uppercase tracking-wider",children:e.type===r.GoalType.CONSISTENCY_METRIC?"Consistency":"Project"})]})]}),e.type===r.GoalType.CONSISTENCY_METRIC&&(0,t.jsx)("div",{className:"mt-4 pl-1",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("button",{onClick:()=>{J(e.id),Y(!0)},type:"button",className:"flex items-center gap-3 px-3 py-2 rounded-lg border transition-all group/habit w-full sm:w-auto bg-white dark:bg-graphite-900 border-graphite-200 dark:border-graphite-700",children:[(0,t.jsx)("div",{className:"p-1.5 rounded-md bg-pacific-50 dark:bg-pacific-900/20 text-pacific-600 dark:text-pacific-400",children:(0,t.jsx)(p.Activity,{size:14})}),(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold text-graphite-400 uppercase tracking-wider",children:"Linked Habit"}),a?(0,t.jsx)("span",{className:`text-xs font-bold ${C}`,children:a.name}):(0,t.jsx)("span",{className:"text-xs font-bold text-red-400",children:"Select Habit Source"})]}),a?(0,t.jsx)(y.Link,{size:12,className:"ml-2 text-graphite-400 group-hover/habit:text-pacific-500 transition-colors opacity-0 group-hover/habit:opacity-100"}):(0,t.jsx)(d.AlertTriangle,{size:12,className:"ml-2 text-red-400"})]})}),e.type===r.GoalType.TASK_PROJECT&&!s&&(0,t.jsxs)("div",{className:"mt-4 pl-1 animate-in slide-in-from-top-1 fade-in duration-200",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"space-y-2 mb-3",children:e.subtasks?.map((a,i)=>(0,t.jsxs)("div",{className:`flex items-center gap-3 text-sm group/task min-h-[28px] ${S}`,style:{paddingLeft:`${1.5*(a.level||0)}rem`},children:[(a.level||0)>0&&(0,t.jsx)(w,{size:12,className:"text-graphite-500 dark:text-graphite-600 flex-shrink-0"}),W?.goalId===e.id&&W.index===i?(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[(0,t.jsx)("input",{value:Q,onChange:e=>ee(e.target.value),className:"flex-1 bg-graphite-900 dark:bg-white border border-pacific-500 rounded px-2 py-1 text-white dark:text-graphite-900 text-sm focus:outline-none",autoFocus:!0,onKeyDown:t=>{"Enter"===t.key&&ez(e,i),"Escape"===t.key&&Z(null)}}),(0,t.jsx)("button",{onClick:()=>ez(e,i),className:"text-pacific-500 hover:text-white",children:(0,t.jsx)(f.Check,{size:16})}),(0,t.jsx)("button",{onClick:()=>Z(null),className:"text-red-500 hover:text-white",children:(0,t.jsx)(c.X,{size:16})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>eC(e,i),type:"button",className:`h-4 w-4 flex-shrink-0 rounded border flex items-center justify-center transition-all ${a.done?"bg-pacific-500 border-pacific-500 text-white":"border-graphite-600 dark:border-graphite-400 hover:border-pacific-500"}`,children:a.done&&(0,t.jsx)(f.Check,{size:10})}),(0,t.jsx)("span",{className:`flex-1 transition-all ${a.done?"line-through opacity-50":""}`,onDoubleClick:()=>eD(e.id,i,a.name),children:a.name}),(0,t.jsxs)("div",{className:"opacity-0 group-hover/task:opacity-100 flex items-center gap-2 transition-opacity",children:[(0,t.jsx)("button",{onClick:()=>eD(e.id,i,a.name),className:"text-graphite-500 hover:text-pacific-400",children:(0,t.jsx)(u.Edit3,{size:12})}),(0,t.jsx)("button",{onClick:()=>eS(e,i),className:"text-graphite-500 hover:text-red-500",children:(0,t.jsx)(m.Trash2,{size:12})})]})]})]},i))}),et===e.id?(0,t.jsxs)("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-top-1",children:[(0,t.jsx)("input",{value:ei,onChange:e=>er(e.target.value),className:"flex-1 bg-graphite-900 dark:bg-white border border-graphite-600 dark:border-graphite-300 rounded px-2 py-1 text-white dark:text-graphite-900 text-sm focus:outline-none focus:border-pacific-500",placeholder:"New item...",autoFocus:!0,onKeyDown:t=>{"Enter"===t.key&&eT(e),"Escape"===t.key&&(ea(null),er(""))}}),(0,t.jsx)("button",{onClick:()=>eT(e),className:"p-1 bg-pacific-600 text-white rounded hover:bg-pacific-500",children:(0,t.jsx)(n.Plus,{size:14})}),(0,t.jsx)("button",{onClick:()=>{ea(null),er("")},className:"p-1 text-graphite-500 hover:text-white",children:(0,t.jsx)(c.X,{size:14})})]}):(0,t.jsxs)("button",{onClick:()=>ea(e.id),className:"text-[10px] font-bold text-graphite-500 hover:text-pacific-400 flex items-center gap-1 transition-colors mt-2",children:[(0,t.jsx)(n.Plus,{size:12})," ADD ITEM"]})]}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),ew(e.id)},className:"absolute bottom-4 right-4 text-graphite-600 dark:text-graphite-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-2",children:(0,t.jsx)(m.Trash2,{size:16})})]},e.id)})})]})]})]},a.id)}),!e.version&&0===eI.length&&(0,t.jsx)("div",{className:"text-center py-12 text-graphite-400 text-sm",children:"System Empty. Initialize a version to proceed."}),e.version&&!eA&&0===eI.length&&(0,t.jsx)("div",{className:"text-center py-12 text-graphite-400 text-sm",children:"No cycles found. Start by creating a new version or cycle."}),eA&&0===eI.length&&(0,t.jsx)("div",{className:"text-center py-12 text-graphite-400 text-sm",children:'All cycles are archived. Click "Show Archived" to view them.'})]}),H&&(0,t.jsx)(T.NewVersionModal,{onClose:()=>A(!1),onCreate:eb,suggestedNumber:(e.version?.number||0)+1}),I&&(0,t.jsx)(z.CycleEditorModal,{mode:"create",goals:[],habits:[],allHabits:B,suggestedSprintNumber:e.cycles.length+1,onClose:()=>$(!1),onCreate:em,onDeleteHabitFromDB:eE,maxCycles:ex,versionStartDate:e.version?.start_date,existingCycles:e.cycles}),L&&(0,t.jsx)(z.CycleEditorModal,{mode:"edit",cycle:L,goals:e.goals.filter(e=>e.cycle_id===L.id),habits:e.habits.filter(e=>e.cycle_id===L.id),allHabits:B,onClose:()=>P(null),onSaveCycle:ef,onManageGoal:eM,onManageHabit:e_,onRenameCategory:async(e,t)=>{for(let a of(await i.supabaseService.getAllHabits()).filter(t=>t.category===e))await i.supabaseService.updateHabit({...a,category:t});await eu()},onDeleteCategory:async e=>{for(let t of(await i.supabaseService.getAllHabits()).filter(t=>t.category===e))await i.supabaseService.updateHabit({...t,category:"Uncategorized"});await eu()},onDeleteHabitFromDB:eE,maxCycles:ex}),R&&(0,t.jsx)(M,{cycle:R,isActive:e.activeCycleId===R.id,onClose:()=>G(null),onSave:ev}),V&&(0,t.jsx)(D.GoalFormModal,{isOpen:V,onClose:()=>F(!1),onSave:ej,currentCycleHabits:e.habits.filter(e=>e.cycle_id===O),allHabits:B}),(0,t.jsx)(_,{isOpen:q,onClose:()=>Y(!1),onSelect:eN,currentCycleHabits:eH,allHabits:B})]})}],99232)}]);